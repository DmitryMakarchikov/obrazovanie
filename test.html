<!DOCTYPE html>
<html lang="ru" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C++ Visual Lab | Интерактивная образовательная платформа</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/cropperjs/dist/cropper.css">
    <style>
        /* ========== ГЛОБАЛЬНЫЕ СТИЛИ И ТЕМЫ ========== */
        :root {
            --primary-dark: #0a192f;
            --secondary-dark: #112240;
            --accent-blue: #64ffda;
            --accent-purple: #8892b0;
            --accent-red: #ff5555;
            --accent-green: #50fa7b;
            --accent-yellow: #f1fa8c;
            --accent-orange: #ffb86c;
            --accent-pink: #ff79c6;
            --text-primary: #e6f1ff;
            --text-secondary: #a8b2d1;
            --panel-bg: rgba(17, 34, 64, 0.95);
            --panel-border: rgba(100, 255, 218, 0.3);
            --glow-effect: 0 0 15px rgba(100, 255, 218, 0.5);
            --shadow-heavy: 0 10px 30px rgba(0, 0, 0, 0.3);
            --shadow-light: 0 5px 15px rgba(0, 0, 0, 0.2);
            --gradient-blue: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-green: linear-gradient(135deg, #64ffda 0%, #50fa7b 100%);
            --gradient-orange: linear-gradient(135deg, #ffb86c 0%, #ff79c6 100%);
            --gradient-purple: linear-gradient(135deg, #bd93f9 0%, #6272a4 100%);
            --gradient-red: linear-gradient(135deg, #ff5555 0%, #ffb86c 100%);
        }

        :root[data-theme="light"] {
            --primary-dark: #f0f2f5;
            --secondary-dark: #ffffff;
            --accent-blue: #1890ff;
            --accent-purple: #595959;
            --accent-red: #f5222d;
            --accent-green: #52c41a;
            --accent-yellow: #faad14;
            --accent-orange: #fa8c16;
            --accent-pink: #eb2f96;
            --text-primary: #262626;
            --text-secondary: #595959;
            --panel-bg: rgba(255, 255, 255, 0.95);
            --panel-border: rgba(24, 144, 255, 0.3);
            --glow-effect: 0 0 15px rgba(24, 144, 255, 0.2);
            --shadow-heavy: 0 10px 30px rgba(0, 0, 0, 0.08);
            --shadow-light: 0 5px 15px rgba(0, 0, 0, 0.05);
            --gradient-blue: linear-gradient(135deg, #1890ff 0%, #36cfc9 100%);
            --gradient-green: linear-gradient(135deg, #52c41a 0%, #73d13d 100%);
            --gradient-orange: linear-gradient(135deg, #fa8c16 0%, #ffa940 100%);
            --gradient-purple: linear-gradient(135deg, #722ed1 0%, #9254de 100%);
            --gradient-red: linear-gradient(135deg, #f5222d 0%, #ff7a45 100%);
        }

        :root[data-theme="blue"] {
            --primary-dark: #001529;
            --secondary-dark: #002140;
            --accent-blue: #1890ff;
            --accent-purple: #8c8c8c;
            --accent-red: #ff4d4f;
            --accent-green: #52c41a;
            --accent-yellow: #fadb14;
            --accent-orange: #fa8c16;
            --accent-pink: #eb2f96;
            --text-primary: #e6f7ff;
            --text-secondary: #bae7ff;
            --panel-bg: rgba(0, 33, 64, 0.95);
            --panel-border: rgba(24, 144, 255, 0.4);
            --glow-effect: 0 0 15px rgba(24, 144, 255, 0.3);
            --gradient-blue: linear-gradient(135deg, #1890ff 0%, #0050b3 100%);
            --gradient-green: linear-gradient(135deg, #52c41a 0%, #389e0d 100%);
        }

        :root[data-theme="green"] {
            --primary-dark: #0c1b15;
            --secondary-dark: #132721;
            --accent-blue: #36cfc9;
            --accent-purple: #8c8c8c;
            --accent-red: #ff4d4f;
            --accent-green: #52c41a;
            --accent-yellow: #fadb14;
            --accent-orange: #fa8c16;
            --accent-pink: #eb2f96;
            --text-primary: #f6ffed;
            --text-secondary: #d9f7be;
            --panel-bg: rgba(19, 39, 33, 0.95);
            --panel-border: rgba(82, 196, 26, 0.4);
            --glow-effect: 0 0 15px rgba(82, 196, 26, 0.3);
            --gradient-green: linear-gradient(135deg, #52c41a 0%, #237804 100%);
        }

        :root[data-theme="purple"] {
            --primary-dark: #120338;
            --secondary-dark: #1d0b52;
            --accent-blue: #9254de;
            --accent-purple: #ad8bff;
            --accent-red: #ff4d4f;
            --accent-green: #52c41a;
            --accent-yellow: #fadb14;
            --accent-orange: #fa8c16;
            --accent-pink: #eb2f96;
            --text-primary: #f9f0ff;
            --text-secondary: #efdbff;
            --panel-bg: rgba(29, 11, 82, 0.95);
            --panel-border: rgba(146, 84, 222, 0.4);
            --glow-effect: 0 0 15px rgba(146, 84, 222, 0.3);
            --gradient-purple: linear-gradient(135deg, #722ed1 0%, #391085 100%);
        }

        :root[data-theme="high-contrast"] {
            --primary-dark: #000000;
            --secondary-dark: #1a1a1a;
            --accent-blue: #00ffff;
            --accent-purple: #ffffff;
            --accent-red: #ff0000;
            --accent-green: #00ff00;
            --accent-yellow: #ffff00;
            --accent-orange: #ffa500;
            --accent-pink: #ff00ff;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --panel-bg: rgba(26, 26, 26, 0.98);
            --panel-border: #ffffff;
            --glow-effect: 0 0 10px #ffffff;
            --gradient-blue: linear-gradient(135deg, #00ffff 0%, #0000ff 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', sans-serif;
        }

        body {
            background: var(--primary-dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            transition: background 0.3s ease, color 0.3s ease;
        }

        body.theme-dark {
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(100, 255, 218, 0.07) 0%, transparent 25%),
                radial-gradient(circle at 90% 30%, rgba(86, 156, 214, 0.05) 0%, transparent 25%),
                radial-gradient(circle at 50% 85%, rgba(136, 146, 176, 0.03) 0%, transparent 25%),
                linear-gradient(45deg, rgba(10, 25, 47, 0.9), rgba(17, 34, 64, 0.9));
        }

        /* ========== ЛОАДЕР С АНИМАЦИЕЙ ========== */
        #loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--primary-dark);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .loader-logo {
            position: relative;
            width: 120px;
            height: 120px;
            margin-bottom: 30px;
        }

        .loader-logo-inner {
            width: 100%;
            height: 100%;
            border: 3px solid transparent;
            border-top: 3px solid var(--accent-blue);
            border-right: 3px solid var(--accent-green);
            border-bottom: 3px solid var(--accent-red);
            border-left: 3px solid var(--accent-yellow);
            border-radius: 50%;
            animation: rotate 1.5s linear infinite;
            position: relative;
        }

        .loader-logo-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-green), var(--accent-yellow));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .loader-progress-container {
            width: 300px;
            margin-top: 20px;
        }

        .loader-progress-bar {
            height: 6px;
            background: rgba(100, 255, 218, 0.1);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .loader-progress-fill {
            height: 100%;
            background: var(--gradient-green);
            width: 0%;
            transition: width 0.3s ease;
            position: relative;
        }

        .loader-progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shimmer 1.5s infinite;
        }

        .loader-status {
            font-size: 14px;
            color: var(--accent-purple);
            text-align: center;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* ========== ХЕДЕР И НАВИГАЦИЯ ========== */
        .header {
            background: rgba(10, 25, 47, 0.95);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid var(--panel-border);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow-heavy);
            transition: all 0.3s ease;
        }

        .header:hover {
            background: rgba(10, 25, 47, 0.98);
        }

        .header-container {
            padding: 15px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-wrapper {
            display: flex;
            align-items: center;
            gap: 15px;
            text-decoration: none;
        }

        .logo {
            width: 55px;
            height: 55px;
            background: var(--gradient-green);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: bold;
            color: var(--primary-dark);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .logo:hover {
            transform: rotate(15deg) scale(1.1);
        }

        .logo-glow {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: logoGlow 3s infinite;
        }

        @keyframes logoGlow {
            0%, 100% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
        }

        .logo-text {
            display: flex;
            flex-direction: column;
        }

        .logo-main {
            font-size: 26px;
            font-weight: 800;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-green));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            letter-spacing: 1.2px;
        }

        .logo-sub {
            font-size: 11px;
            color: var(--accent-purple);
            letter-spacing: 3px;
            text-transform: uppercase;
            margin-top: 2px;
        }

        /* Основная навигация */
        .main-nav {
            display: flex;
            gap: 5px;
            background: rgba(17, 34, 64, 0.8);
            border-radius: 15px;
            padding: 6px;
            border: 1px solid rgba(100, 255, 218, 0.2);
        }

        .nav-item {
            padding: 12px 25px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 12px;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(100, 255, 218, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .nav-item:hover::before {
            left: 100%;
        }

        .nav-item:hover {
            color: var(--text-primary);
            background: rgba(100, 255, 218, 0.1);
        }

        .nav-item.active {
            background: rgba(100, 255, 218, 0.15);
            color: var(--accent-blue);
            box-shadow: var(--glow-effect);
            border: 1px solid rgba(100, 255, 218, 0.3);
        }

        .nav-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--accent-red);
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
            font-weight: bold;
        }

        /* Блок пользователя */
        .user-block {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-stats {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 15px;
            background: rgba(17, 34, 64, 0.6);
            border-radius: 12px;
            border: 1px solid rgba(100, 255, 218, 0.1);
            min-width: 80px;
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            background: rgba(100, 255, 218, 0.1);
            transform: translateY(-2px);
        }

        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: var(--accent-green);
        }

        .stat-label {
            font-size: 11px;
            color: var(--accent-purple);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 15px;
            background: rgba(17, 34, 64, 0.8);
            border-radius: 50px;
            border: 1px solid rgba(100, 255, 218, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .user-profile:hover {
            background: rgba(100, 255, 218, 0.1);
            transform: translateY(-2px);
            box-shadow: var(--glow-effect);
        }

        .user-avatar {
            width: 42px;
            height: 42px;
            background: var(--gradient-blue);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: white;
            border: 2px solid var(--accent-blue);
            background-size: cover;
            background-position: center;
            position: relative;
            overflow: hidden;
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .user-rank {
            font-size: 11px;
            color: var(--accent-yellow);
            background: rgba(241, 250, 140, 0.1);
            padding: 2px 8px;
            border-radius: 10px;
            text-align: center;
            margin-top: 2px;
        }

        /* Хлебные крошки */
        .breadcrumbs {
            padding: 15px 40px;
            background: rgba(10, 25, 47, 0.8);
            border-bottom: 1px solid var(--panel-border);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            color: var(--accent-purple);
        }

        .breadcrumbs a {
            color: var(--accent-blue);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .breadcrumbs a:hover {
            color: var(--accent-green);
            text-decoration: underline;
        }

        .breadcrumbs span {
            color: var(--text-primary);
            font-weight: 600;
        }

        /* Поиск */
        .search-container {
            position: relative;
            margin: 0 20px;
            flex: 1;
            max-width: 400px;
        }

        .search-input {
            width: 100%;
            padding: 12px 45px 12px 20px;
            background: rgba(17, 34, 64, 0.8);
            border: 1px solid var(--panel-border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: var(--glow-effect);
            background: rgba(17, 34, 64, 0.95);
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--accent-purple);
            cursor: pointer;
        }

        /* ========== КАРТА ПРОГРЕССА (ИГРОВОЙ ЭЛЕМЕНТ) ========== */
        .progress-map-container {
            background: rgba(10, 25, 47, 0.9);
            border-bottom: 1px solid rgba(100, 255, 218, 0.2);
            padding: 20px 40px;
            overflow-x: auto;
            position: relative;
        }

        .toggle-map-btn {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(100, 255, 218, 0.1);
            border: 1px solid var(--accent-blue);
            color: var(--accent-blue);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-map-btn:hover {
            background: rgba(100, 255, 218, 0.2);
            transform: translateY(-50%) scale(1.1);
        }

        .progress-map {
            display: flex;
            align-items: center;
            gap: 30px;
            min-width: max-content;
            padding: 20px 0;
            transition: max-height 0.3s ease, opacity 0.3s ease;
        }

        .progress-map.collapsed {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            padding: 0;
        }

        .map-node {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .map-node.completed .node-icon {
            background: rgba(80, 250, 123, 0.2);
            border-color: var(--accent-green);
            box-shadow: 0 0 20px rgba(80, 250, 123, 0.3);
        }

        .map-node.current .node-icon {
            border-color: var(--accent-blue);
            box-shadow: 0 0 25px rgba(100, 255, 218, 0.5);
            animation: pulse 2s infinite;
        }

        .map-node.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .node-connector {
            width: 40px;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-green), var(--accent-blue));
            opacity: 0.3;
            transition: all 0.3s ease;
        }

        .map-node:hover:not(.locked) ~ .node-connector,
        .map-node:hover:not(.locked) + .node-connector {
            opacity: 0.8;
            transform: scaleX(1.2);
        }

        .node-icon {
            width: 60px;
            height: 60px;
            border-radius: 20px;
            border: 3px solid var(--panel-border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 10px;
            background: var(--panel-bg);
            transition: all 0.3s ease;
        }

        .map-node:hover:not(.locked) .node-icon {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .node-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-align: center;
            max-width: 100px;
        }

        .node-preview {
            position: absolute;
            top: -100px;
            background: var(--panel-bg);
            border: 1px solid var(--panel-border);
            border-radius: 12px;
            padding: 15px;
            width: 200px;
            box-shadow: var(--shadow-heavy);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .map-node:hover .node-preview {
            opacity: 1;
            visibility: visible;
            transform: translateY(-10px);
        }

        .node-progress {
            width: 60px;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            margin-top: 8px;
            overflow: hidden;
        }

        .node-progress-bar {
            height: 100%;
            background: var(--gradient-green);
            transition: width 0.5s ease;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* ========== ОСНОВНОЙ КОНТЕЙНЕР ========== */
        .main-container {
            display: grid;
            grid-template-columns: 280px 1fr 320px;
            gap: 25px;
            padding: 30px;
            min-height: calc(100vh - 180px);
        }

        /* ========== ЛЕВАЯ ПАНЕЛЬ - КУРСЫ И МОДУЛИ ========== */
        .sidebar-left {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .module-card {
            background: var(--panel-bg);
            border: 1px solid var(--panel-border);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow-heavy);
            transition: all 0.3s ease;
        }

        .module-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-blue);
            box-shadow: var(--glow-effect);
        }

        .module-header {
            padding: 20px;
            background: linear-gradient(135deg, rgba(17, 34, 64, 0.8), rgba(10, 25, 47, 0.9));
            border-bottom: 1px solid rgba(100, 255, 218, 0.2);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .module-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .module-info h3 {
            font-size: 16px;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .module-info .module-stats {
            font-size: 12px;
            color: var(--accent-purple);
            display: flex;
            gap: 10px;
        }

        .module-content {
            padding: 20px;
        }

        .module-topics {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .topic-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            background: rgba(10, 25, 47, 0.5);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
            position: relative;
        }

        .topic-item:hover {
            background: rgba(100, 255, 218, 0.1);
            border-color: rgba(100, 255, 218, 0.3);
            transform: translateX(5px);
        }

        .topic-item.active {
            background: rgba(100, 255, 218, 0.15);
            border-color: var(--accent-blue);
        }

        .topic-item.completed {
            border-color: var(--accent-green);
            background: rgba(80, 250, 123, 0.1);
        }

        .topic-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--accent-purple);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .topic-item.completed .topic-checkbox {
            background: var(--accent-green);
            border-color: var(--accent-green);
            color: var(--primary-dark);
        }

        .topic-text {
            flex: 1;
        }

        .topic-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .topic-meta {
            font-size: 11px;
            color: var(--accent-purple);
            display: flex;
            gap: 8px;
            margin-top: 2px;
        }

        .topic-tag {
            font-size: 10px;
            padding: 2px 6px;
            background: rgba(100, 255, 218, 0.1);
            border-radius: 10px;
            color: var(--accent-blue);
        }

        /* ========== ЦЕНТРАЛЬНАЯ ПАНЕЛЬ - КОНТЕНТ ========== */
        .content-main {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .content-section {
            display: none;
            animation: fadeInUp 0.5s ease;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .content-card {
            background: var(--panel-bg);
            border: 1px solid var(--panel-border);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow-heavy);
            position: relative;
            overflow: hidden;
        }

        .content-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-green);
            opacity: 0.8;
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(100, 255, 218, 0.2);
        }

        .content-title {
            font-size: 28px;
            color: var(--accent-blue);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .content-title-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: rgba(100, 255, 218, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--accent-blue);
        }

        .content-controls {
            display: flex;
            gap: 10px;
        }

        /* Теория */
        .theory-content {
            line-height: 1.8;
            font-size: 16px;
            color: var(--text-secondary);
        }

        .theory-content h3 {
            color: var(--accent-blue);
            margin: 25px 0 15px 0;
            font-size: 22px;
            border-left: 4px solid var(--accent-blue);
            padding-left: 15px;
        }

        .theory-content h4 {
            color: var(--accent-green);
            margin: 20px 0 12px 0;
            font-size: 18px;
        }

        .theory-content p {
            margin-bottom: 15px;
        }

        .theory-content ul, .theory-content ol {
            margin-left: 25px;
            margin-bottom: 20px;
        }

        .theory-content li {
            margin-bottom: 8px;
            position: relative;
        }

        .theory-content li::before {
            content: '▸';
            color: var(--accent-blue);
            position: absolute;
            left: -20px;
        }

        .code-example {
            background: #1e1e1e;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            border: 1px solid rgba(100, 255, 218, 0.2);
            position: relative;
            overflow: hidden;
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(100, 255, 218, 0.1);
        }

        .code-title {
            color: var(--accent-green);
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .code-actions {
            display: flex;
            gap: 8px;
        }

        .code-body {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            color: var(--text-primary);
            overflow-x: auto;
            white-space: pre;
            line-height: 1.5;
        }

        .code-comment {
            color: #6a9955;
        }

        .code-keyword {
            color: #569cd6;
        }

        .code-string {
            color: #ce9178;
        }

        .code-number {
            color: #b5cea8;
        }

        .code-function {
            color: #dcdcaa;
        }

        /* Интерактивные блоки */
        .interactive-block {
            background: linear-gradient(135deg, rgba(17, 34, 64, 0.8), rgba(10, 25, 47, 0.9));
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            border: 1px solid rgba(100, 255, 218, 0.2);
        }

        .interactive-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .interactive-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: rgba(100, 255, 218, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: var(--accent-blue);
        }

        /* Лабораторные работы */
        .labs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .lab-card {
            background: linear-gradient(135deg, rgba(17, 34, 64, 0.8), rgba(10, 25, 47, 0.9));
            border: 1px solid var(--panel-border);
            border-radius: 18px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .lab-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(100, 255, 218, 0.05) 50%, transparent 70%);
            transform: translateX(-100%);
            transition: transform 0.6s ease;
        }

        .lab-card:hover::before {
            transform: translateX(100%);
        }

        .lab-card:hover {
            transform: translateY(-8px);
            border-color: var(--accent-blue);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }

        .lab-card.completed {
            border-color: var(--accent-green);
            background: linear-gradient(135deg, rgba(80, 250, 123, 0.1), rgba(10, 25, 47, 0.9));
        }

        .lab-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .lab-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.4;
        }

        .lab-difficulty {
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .difficulty-beginner {
            background: rgba(80, 250, 123, 0.2);
            color: var(--accent-green);
        }

        .difficulty-intermediate {
            background: rgba(241, 250, 140, 0.2);
            color: var(--accent-yellow);
        }

        .difficulty-advanced {
            background: rgba(255, 85, 85, 0.2);
            color: var(--accent-red);
        }

        .difficulty-expert {
            background: rgba(255, 184, 108, 0.2);
            color: var(--accent-orange);
        }

        .lab-description {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 20px;
            min-height: 60px;
        }

        .lab-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 15px;
            border-top: 1px solid rgba(100, 255, 218, 0.1);
        }

        .lab-stats {
            display: flex;
            gap: 15px;
        }

        .lab-stat {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: var(--accent-purple);
        }

        .lab-status {
            font-size: 12px;
            font-weight: 600;
            padding: 5px 12px;
            border-radius: 12px;
            background: rgba(100, 255, 218, 0.1);
            color: var(--accent-blue);
        }

        .lab-status.completed {
            background: rgba(80, 250, 123, 0.2);
            color: var(--accent-green);
        }

        /* Тесты */
        .test-container {
            background: linear-gradient(135deg, rgba(17, 34, 64, 0.8), rgba(10, 25, 47, 0.9));
            border-radius: 18px;
            padding: 30px;
            margin-top: 20px;
        }

        .test-question {
            font-size: 20px;
            color: var(--text-primary);
            margin-bottom: 25px;
            line-height: 1.5;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(100, 255, 218, 0.2);
        }

        .test-question-number {
            color: var(--accent-blue);
            font-weight: bold;
        }

        .test-options {
            display: grid;
            gap: 12px;
            margin-bottom: 30px;
        }

        .test-option {
            padding: 18px 20px;
            background: rgba(10, 25, 47, 0.6);
            border: 1px solid rgba(100, 255, 218, 0.2);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .test-option:hover {
            background: rgba(100, 255, 218, 0.1);
            transform: translateX(5px);
        }

        .test-option.selected {
            background: rgba(100, 255, 218, 0.2);
            border-color: var(--accent-blue);
            box-shadow: 0 0 10px rgba(100, 255, 218, 0.3);
        }

        .test-option.correct {
            background: rgba(80, 250, 123, 0.2);
            border-color: var(--accent-green);
        }

        .test-option.incorrect {
            background: rgba(255, 85, 85, 0.2);
            border-color: var(--accent-red);
        }

        .option-letter {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            background: rgba(100, 255, 218, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--accent-blue);
            flex-shrink: 0;
        }

        .test-option.selected .option-letter {
            background: var(--accent-blue);
            color: var(--primary-dark);
        }

        .test-progress {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(100, 255, 218, 0.2);
        }

        .test-timer {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: rgba(255, 85, 85, 0.1);
            border-radius: 12px;
            color: var(--accent-red);
            font-weight: bold;
        }

        /* Практика - редактор */
        .practice-container {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .editor-wrapper {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: rgba(10, 25, 47, 0.8);
            border-radius: 15px;
            border: 1px solid rgba(100, 255, 218, 0.2);
        }

        .file-tabs {
            display: flex;
            gap: 5px;
            overflow-x: auto;
            max-width: 400px;
        }

        .file-tab {
            padding: 10px 20px;
            background: rgba(17, 34, 64, 0.6);
            border: 1px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .file-tab:hover {
            background: rgba(100, 255, 218, 0.1);
        }

        .file-tab.active {
            background: rgba(100, 255, 218, 0.2);
            border-color: var(--accent-blue);
            color: var(--accent-blue);
        }

        .editor-controls {
            display: flex;
            gap: 10px;
        }

        .code-editor-container {
            flex: 1;
            border: 1px solid rgba(100, 255, 218, 0.2);
            border-radius: 15px;
            overflow: hidden;
            background: #1e1e1e;
        }

        .CodeMirror {
            height: 500px !important;
            font-size: 15px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        }

        .editor-output {
            background: #1e1e1e;
            border: 1px solid rgba(100, 255, 218, 0.2);
            border-radius: 15px;
            padding: 20px;
            min-height: 200px;
            max-height: 300px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-top: 1px solid rgba(100, 255, 218, 0.2);
        }

        .output-line {
            padding: 8px 12px;
            border-radius: 6px;
            font-family: 'Consolas', monospace;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .output-line::before {
            content: '>';
            color: var(--accent-purple);
            font-weight: bold;
        }

        .output-line.success {
            background: rgba(80, 250, 123, 0.1);
            color: var(--accent-green);
        }

        .output-line.error {
            background: rgba(255, 85, 85, 0.1);
            color: var(--accent-red);
        }

        .output-line.info {
            background: rgba(100, 255, 218, 0.1);
            color: var(--accent-blue);
        }

        /* Симулятор памяти */
        .memory-simulator {
            background: linear-gradient(135deg, rgba(10, 25, 47, 0.9), rgba(17, 34, 64, 0.9));
            border-radius: 18px;
            padding: 25px;
            margin-top: 20px;
        }

        .memory-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .memory-visualization {
            display: grid;
            grid-template-columns: repeat(16, 1fr);
            gap: 8px;
            margin-top: 20px;
        }

        .memory-cell {
            aspect-ratio: 1;
            background: rgba(10, 25, 47, 0.8);
            border: 1px solid rgba(100, 255, 218, 0.1);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 10px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .memory-cell:hover {
            transform: scale(1.1);
            z-index: 2;
            box-shadow: 0 0 15px rgba(100, 255, 218, 0.3);
        }

        .memory-cell.stack {
            border-color: var(--accent-blue);
            background: rgba(100, 255, 218, 0.1);
        }

        .memory-cell.heap {
            border-color: var(--accent-green);
            background: rgba(80, 250, 123, 0.1);
        }

        .memory-cell.global {
            border-color: var(--accent-yellow);
            background: rgba(241, 250, 140, 0.1);
        }

        .memory-cell.code {
            border-color: var(--accent-red);
            background: rgba(255, 85, 85, 0.1);
        }

        .memory-address {
            font-size: 8px;
            color: var(--accent-purple);
            margin-bottom: 4px;
        }

        .memory-value {
            font-size: 10px;
            font-weight: bold;
            color: var(--text-primary);
        }

        /* ========== ПРАВАЯ ПАНЕЛЬ - ПРОФИЛЬ И СТАТИСТИКА ========== */
        .sidebar-right {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        /* Карточка профиля */
        .profile-card {
            background: var(--panel-bg);
            border: 1px solid var(--panel-border);
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--shadow-heavy);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .profile-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: var(--gradient-purple);
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            background: var(--gradient-blue);
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            font-weight: bold;
            color: white;
            border: 4px solid var(--accent-blue);
            position: relative;
            overflow: hidden;
            background-size: cover;
            background-position: center;
            cursor: pointer;
        }

        .avatar-level {
            position: absolute;
            bottom: -5px;
            right: -5px;
            background: var(--accent-red);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            border: 2px solid var(--primary-dark);
        }

        .profile-info h3 {
            font-size: 22px;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .profile-rank {
            display: inline-block;
            padding: 6px 15px;
            background: var(--gradient-orange);
            color: white;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            letter-spacing: 1px;
            margin-bottom: 20px;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: rgba(10, 25, 47, 0.6);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(100, 255, 218, 0.1);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            border-color: var(--accent-blue);
            background: rgba(100, 255, 218, 0.1);
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--accent-green);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 11px;
            color: var(--accent-purple);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Прогресс-бар опыта */
        .xp-progress {
            margin: 25px 0;
        }

        .xp-bar {
            height: 10px;
            background: rgba(100, 255, 218, 0.1);
            border-radius: 5px;
            margin-bottom: 10px;
            overflow: hidden;
        }

        .xp-fill {
            height: 100%;
            background: var(--gradient-green);
            width: 45%;
            transition: width 0.5s ease;
            position: relative;
        }

        .xp-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        .xp-info {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--accent-purple);
        }

        /* Достижения */
        .achievements-container {
            background: var(--panel-bg);
            border: 1px solid var(--panel-border);
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--shadow-heavy);
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .achievement-badge {
            aspect-ratio: 1;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(10, 25, 47, 0.6);
            border: 1px solid rgba(100, 255, 218, 0.1);
            position: relative;
            overflow: hidden;
        }

        .achievement-badge:hover {
            transform: scale(1.05);
            border-color: var(--accent-blue);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .achievement-badge.unlocked {
            background: rgba(80, 250, 123, 0.1);
            border-color: var(--accent-green);
        }

        .achievement-badge.unlocked:hover {
            box-shadow: 0 5px 15px rgba(80, 250, 123, 0.3);
        }

        .achievement-icon {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .achievement-badge.unlocked .achievement-icon {
            color: var(--accent-green);
        }

        .achievement-badge.locked .achievement-icon {
            color: var(--accent-purple);
            opacity: 0.5;
        }

        .achievement-title {
            font-size: 10px;
            text-align: center;
            color: var(--text-secondary);
            font-weight: 600;
            line-height: 1.3;
        }

        /* Активность */
        .activity-container {
            background: var(--panel-bg);
            border: 1px solid var(--panel-border);
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--shadow-heavy);
        }

        .activity-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(10, 25, 47, 0.6);
            border-radius: 12px;
            border: 1px solid transparent;
            transition: all 0.3s ease;
        }

        .activity-item:hover {
            border-color: var(--accent-blue);
            background: rgba(100, 255, 218, 0.1);
            transform: translateX(5px);
        }

        .activity-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            background: rgba(100, 255, 218, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-blue);
            flex-shrink: 0;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-size: 14px;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .activity-time {
            font-size: 11px;
            color: var(--accent-purple);
        }

        /* ========== КНОПКИ И КОНТРОЛЫ ========== */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: var(--gradient-green);
            color: var(--primary-dark);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(80, 250, 123, 0.3);
        }

        .btn-secondary {
            background: var(--gradient-blue);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(100, 255, 218, 0.3);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--accent-blue);
            color: var(--accent-blue);
        }

        .btn-outline:hover {
            background: rgba(100, 255, 218, 0.1);
            transform: translateY(-3px);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 12px;
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            padding: 0;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ========== МОДАЛЬНЫЕ ОКНА ========== */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 25, 47, 0.95);
            backdrop-filter: blur(10px);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-container {
            background: var(--panel-bg);
            border: 2px solid var(--accent-blue);
            border-radius: 25px;
            width: 90%;
            max-width: 1000px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 25px 30px;
            background: linear-gradient(135deg, rgba(10, 25, 47, 0.9), rgba(17, 34, 64, 0.9));
            border-bottom: 1px solid rgba(100, 255, 218, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            font-size: 28px;
            color: var(--accent-blue);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .modal-body {
            padding: 30px;
            overflow-y: auto;
            max-height: 70vh;
        }

        /* Модалка профиля */
        .profile-modal-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
        }

        .profile-sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .profile-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-large {
            background: rgba(10, 25, 47, 0.8);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(100, 255, 218, 0.2);
        }

        .stat-large-value {
            font-size: 36px;
            font-weight: bold;
            color: var(--accent-green);
            margin-bottom: 5px;
        }

        .stat-large-label {
            font-size: 12px;
            color: var(--accent-purple);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Модалка лабораторной */
        .lab-modal-content {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .lab-instructions {
            background: linear-gradient(135deg, rgba(17, 34, 64, 0.8), rgba(10, 25, 47, 0.9));
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(100, 255, 218, 0.2);
        }

        .lab-objectives {
            display: grid;
            gap: 12px;
            margin-top: 20px;
        }

        .lab-objective {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(10, 25, 47, 0.6);
            border-radius: 10px;
            border-left: 4px solid var(--accent-blue);
        }

        /* Модалка редактора аватара */
        .avatar-editor-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .avatar-preview-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 300px;
            background: rgba(10, 25, 47, 0.5);
            border-radius: 15px;
            border: 2px dashed var(--accent-blue);
        }

        .avatar-preview {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--accent-blue);
        }

        .avatar-controls {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .avatar-control {
            padding: 10px;
            background: rgba(10, 25, 47, 0.6);
            border: 1px solid var(--panel-border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .avatar-control:hover {
            background: rgba(100, 255, 218, 0.1);
            border-color: var(--accent-blue);
        }

        .avatar-history {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .history-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .history-avatar:hover {
            transform: scale(1.1);
            border-color: var(--accent-blue);
        }

        .history-avatar.active {
            border-color: var(--accent-green);
            box-shadow: 0 0 10px var(--accent-green);
        }

        /* Модалка сертификата */
        .certificate-container {
            width: 800px;
            height: 600px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border: 20px solid #1a237e;
            position: relative;
            padding: 60px;
            text-align: center;
            color: #1a237e;
        }

        .certificate-header {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 40px;
            text-transform: uppercase;
            letter-spacing: 4px;
        }

        .certificate-title {
            font-size: 32px;
            margin-bottom: 60px;
            font-weight: 600;
        }

        .certificate-name {
            font-size: 42px;
            font-weight: bold;
            margin-bottom: 40px;
            color: #0d47a1;
        }

        .certificate-details {
            font-size: 18px;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .certificate-date {
            font-size: 16px;
            margin-top: 60px;
        }

        .certificate-stamp {
            position: absolute;
            bottom: 60px;
            right: 60px;
            width: 120px;
            height: 120px;
            border: 3px solid #d32f2f;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            color: #d32f2f;
            transform: rotate(-15deg);
        }

        /* Модалка настроек */
        .settings-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 30px;
        }

        .settings-nav {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .settings-nav-item {
            padding: 15px 20px;
            background: rgba(10, 25, 47, 0.6);
            border: 1px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-secondary);
        }

        .settings-nav-item:hover {
            background: rgba(100, 255, 218, 0.1);
            color: var(--text-primary);
        }

        .settings-nav-item.active {
            background: rgba(100, 255, 218, 0.15);
            border-color: var(--accent-blue);
            color: var(--accent-blue);
        }

        .settings-section {
            display: none;
        }

        .settings-section.active {
            display: block;
        }

        .settings-group {
            margin-bottom: 30px;
        }

        .settings-group-title {
            font-size: 18px;
            color: var(--accent-blue);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(100, 255, 218, 0.2);
        }

        .theme-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .theme-option {
            padding: 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            border: 2px solid transparent;
        }

        .theme-option:hover {
            transform: translateY(-5px);
        }

        .theme-option.selected {
            border-color: var(--accent-blue);
            box-shadow: var(--glow-effect);
        }

        .theme-preview {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .theme-dark .theme-preview {
            background: #0a192f;
            color: #64ffda;
            border: 2px solid #64ffda;
        }

        .theme-light .theme-preview {
            background: #f0f2f5;
            color: #1890ff;
            border: 2px solid #1890ff;
        }

        .theme-blue .theme-preview {
            background: #001529;
            color: #1890ff;
            border: 2px solid #1890ff;
        }

        .theme-green .theme-preview {
            background: #0c1b15;
            color: #52c41a;
            border: 2px solid #52c41a;
        }

        .theme-purple .theme-preview {
            background: #120338;
            color: #9254de;
            border: 2px solid #9254de;
        }

        .theme-high-contrast .theme-preview {
            background: #000000;
            color: #00ffff;
            border: 2px solid #00ffff;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(10, 25, 47, 0.6);
            border-radius: 12px;
            margin-bottom: 10px;
        }

        .setting-label {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .setting-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .setting-description {
            font-size: 12px;
            color: var(--accent-purple);
        }

        .setting-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(100, 255, 218, 0.2);
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--accent-blue);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        /* Графики статистики */
        .stats-chart-container {
            background: var(--panel-bg);
            border: 1px solid var(--panel-border);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .chart-canvas {
            width: 100%;
            height: 300px;
        }

        /* Календарь активности */
        .activity-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 20px;
        }

        .calendar-day {
            aspect-ratio: 1;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: pointer;
            position: relative;
            background: rgba(10, 25, 47, 0.3);
        }

        .calendar-day.active {
            background: var(--accent-green);
            color: var(--primary-dark);
            font-weight: bold;
        }

        .calendar-day:hover::after {
            content: attr(data-count);
            position: absolute;
            top: -20px;
            background: var(--panel-bg);
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 10px;
            white-space: nowrap;
            border: 1px solid var(--panel-border);
        }

        /* Диаграмма навыков */
        .skills-chart {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .skill-item {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .skill-name {
            width: 120px;
            font-size: 14px;
            color: var(--text-primary);
        }

        .skill-bar {
            flex: 1;
            height: 10px;
            background: rgba(10, 25, 47, 0.3);
            border-radius: 5px;
            overflow: hidden;
        }

        .skill-progress {
            height: 100%;
            background: var(--gradient-green);
            transition: width 1s ease;
        }

        .skill-value {
            width: 40px;
            text-align: right;
            font-size: 14px;
            color: var(--accent-green);
        }

        /* Таблица лидеров */
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .leaderboard-table th {
            padding: 15px;
            text-align: left;
            background: rgba(100, 255, 218, 0.1);
            color: var(--accent-blue);
            font-weight: 600;
            border-bottom: 2px solid var(--accent-blue);
        }

        .leaderboard-table td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(100, 255, 218, 0.1);
        }

        .leaderboard-table tr:hover {
            background: rgba(100, 255, 218, 0.05);
        }

        .leaderboard-rank {
            width: 50px;
            text-align: center;
            font-weight: bold;
            color: var(--accent-green);
        }

        .leaderboard-rank-1 {
            color: #ffd700;
        }

        .leaderboard-rank-2 {
            color: #c0c0c0;
        }

        .leaderboard-rank-3 {
            color: #cd7f32;
        }

        /* ========== УВЕДОМЛЕНИЯ ========== */
        .notification-container {
            position: fixed;
            top: 120px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 1500;
            max-width: 400px;
        }

        .notification {
            background: var(--panel-bg);
            border: 1px solid var(--panel-border);
            border-radius: 15px;
            padding: 20px;
            transform: translateX(400px);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: var(--shadow-heavy);
            border-left: 4px solid var(--accent-blue);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left-color: var(--accent-green);
            background: rgba(80, 250, 123, 0.1);
        }

        .notification.warning {
            border-left-color: var(--accent-yellow);
            background: rgba(241, 250, 140, 0.1);
        }

        .notification.error {
            border-left-color: var(--accent-red);
            background: rgba(255, 85, 85, 0.1);
        }

        /* ========== АДАПТИВНОСТЬ ========== */
        @media (max-width: 1400px) {
            .main-container {
                grid-template-columns: 250px 1fr;
            }
            
            .sidebar-right {
                grid-column: 1 / span 2;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                display: grid;
                gap: 20px;
            }
        }

        @media (max-width: 1024px) {
            .main-container {
                grid-template-columns: 1fr;
                padding: 20px;
            }
            
            .sidebar-left, .sidebar-right {
                grid-column: 1;
            }
            
            .labs-grid {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            }
            
            .header-container {
                padding: 15px 20px;
                flex-direction: column;
                gap: 15px;
            }
            
            .main-nav {
                width: 100%;
                overflow-x: auto;
                justify-content: center;
            }
            
            .user-block {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 768px) {
            .content-title {
                font-size: 22px;
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .content-controls {
                flex-wrap: wrap;
                justify-content: flex-start;
            }
            
            .editor-header {
                flex-direction: column;
                gap: 15px;
            }
            
            .file-tabs {
                max-width: 100%;
            }
            
            .editor-controls {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .profile-modal-content {
                grid-template-columns: 1fr;
            }
        }

        /* ========== УТИЛИТЫ ========== */
        .scrollbar-hidden {
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .scrollbar-hidden::-webkit-scrollbar {
            display: none;
        }

        .text-gradient {
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-green));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-primary {
            background: rgba(100, 255, 218, 0.2);
            color: var(--accent-blue);
        }

        .badge-success {
            background: rgba(80, 250, 123, 0.2);
            color: var(--accent-green);
        }

        .badge-warning {
            background: rgba(241, 250, 140, 0.2);
            color: var(--accent-yellow);
        }

        .badge-danger {
            background: rgba(255, 85, 85, 0.2);
            color: var(--accent-red);
        }

        .tooltip {
            position: relative;
        }

        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary-dark);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            white-space: nowrap;
            border: 1px solid var(--panel-border);
            z-index: 1000;
        }

        /* Загрузка файлов */
        .file-upload-container {
            border: 2px dashed var(--accent-blue);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .file-upload-container:hover {
            background: rgba(100, 255, 218, 0.05);
            border-color: var(--accent-green);
        }

        .file-upload-container.dragover {
            background: rgba(100, 255, 218, 0.1);
            border-color: var(--accent-green);
            transform: scale(1.02);
        }

        .file-upload-icon {
            font-size: 48px;
            color: var(--accent-blue);
            margin-bottom: 15px;
        }

        /* Игры */
        .game-card {
            background: linear-gradient(135deg, rgba(17, 34, 64, 0.8), rgba(10, 25, 47, 0.9));
            border: 1px solid var(--panel-border);
            border-radius: 18px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .game-card:hover {
            transform: translateY(-8px);
            border-color: var(--accent-blue);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }

        .game-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        .game-description {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        /* Поиск и фильтры */
        .filters-container {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .filter-select {
            padding: 10px 15px;
            background: rgba(17, 34, 64, 0.8);
            border: 1px solid var(--panel-border);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: var(--glow-effect);
        }

        .filter-tag {
            padding: 6px 12px;
            background: rgba(100, 255, 218, 0.1);
            border: 1px solid var(--accent-blue);
            border-radius: 20px;
            color: var(--accent-blue);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-tag:hover {
            background: rgba(100, 255, 218, 0.2);
        }

        .filter-tag.active {
            background: var(--accent-blue);
            color: var(--primary-dark);
        }

        .tag-cloud {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }

        .tag-cloud-item {
            padding: 6px 12px;
            background: rgba(100, 255, 218, 0.1);
            border-radius: 15px;
            font-size: 12px;
            color: var(--accent-blue);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tag-cloud-item:hover {
            background: rgba(100, 255, 218, 0.2);
            transform: translateY(-2px);
        }

        .tag-cloud-item.active {
            background: var(--accent-blue);
            color: var(--primary-dark);
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Лоадер -->
    <div id="loader">
        <div class="loader-logo">
            <div class="loader-logo-inner"></div>
            <div class="loader-logo-text">C++</div>
        </div>
        <h2 style="color: var(--accent-blue); margin-bottom: 10px;">C++ Visual Lab</h2>
        <p style="color: var(--accent-purple); text-align: center; max-width: 400px;">
            Загрузка интерактивной образовательной платформы...
        </p>
        <div class="loader-progress-container">
            <div class="loader-progress-bar">
                <div class="loader-progress-fill" id="loaderProgress"></div>
            </div>
            <div class="loader-status" id="loaderStatus">Инициализация системы...</div>
        </div>
    </div>

    <!-- Хедер -->
    <header class="header">
        <div class="header-container">
            <!-- Логотип -->
            <a href="#" class="logo-wrapper" onclick="switchSection('theory'); return false;">
                <div class="logo">
                    <div class="logo-glow"></div>
                    C++
                </div>
                <div class="logo-text">
                    <div class="logo-main">C++ VISUAL LAB</div>
                    <div class="logo-sub">ИНТЕРАКТИВНОЕ ОБУЧЕНИЕ</div>
                </div>
            </a>

            <!-- Поиск -->
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Поиск по теме, задаче или коду..." 
                       id="globalSearch" oninput="performSearch(this.value)">
                <div class="search-icon">
                    <i class="fas fa-search"></i>
                </div>
            </div>

            <!-- Основная навигация -->
            <nav class="main-nav">
                <button class="nav-item active" data-section="theory" onclick="switchSection('theory')">
                    <i class="fas fa-book"></i> Теория
                    <span class="nav-badge" id="theoryBadge">3</span>
                </button>
                <button class="nav-item" data-section="labs" onclick="switchSection('labs')">
                    <i class="fas fa-flask"></i> Лабораторные
                    <span class="nav-badge" id="labsBadge">5</span>
                </button>
                <button class="nav-item" data-section="tests" onclick="switchSection('tests')">
                    <i class="fas fa-graduation-cap"></i> Тесты
                    <span class="nav-badge" id="testsBadge">2</span>
                </button>
                <button class="nav-item" data-section="practice" onclick="switchSection('practice')">
                    <i class="fas fa-code"></i> Практика
                </button>
                <button class="nav-item" data-section="games" onclick="switchSection('games')">
                    <i class="fas fa-gamepad"></i> Игры
                    <span class="nav-badge" id="gamesBadge">1</span>
                </button>
                <button class="nav-item" data-section="projects" onclick="switchSection('projects')">
                    <i class="fas fa-project-diagram"></i> Проекты
                </button>
            </nav>

            <!-- Блок пользователя -->
            <div class="user-block">
                <div class="user-stats">
                    <div class="stat-item" onclick="openProfileModal()" style="cursor: pointer;">
                        <div class="stat-value" id="userLevel">5</div>
                        <div class="stat-label">Уровень</div>
                    </div>
                    <div class="stat-item" onclick="openProfileModal()" style="cursor: pointer;">
                        <div class="stat-value" id="userXP">245</div>
                        <div class="stat-label">XP</div>
                    </div>
                    <div class="stat-item" onclick="openProfileModal()" style="cursor: pointer;">
                        <div class="stat-value" id="userStreak">7</div>
                        <div class="stat-label">Дней</div>
                    </div>
                </div>
                <div class="user-profile" onclick="openProfileModal()">
                    <div class="user-avatar" id="userAvatar">
                        <!-- Аватар загрузится динамически -->
                    </div>
                    <div class="user-info">
                        <div class="user-name" id="userName">Алексей</div>
                        <div class="user-rank" id="userRank">Знаток</div>
                    </div>
                    <i class="fas fa-chevron-down" style="color: var(--accent-purple);"></i>
                </div>
            </div>
        </div>

        <!-- Хлебные крошки -->
        <div class="breadcrumbs" id="breadcrumbs">
            <a href="#" onclick="switchSection('theory'); return false;">Главная</a> >
            <span>Теория</span> >
            <span>Введение в C++</span>
        </div>

        <!-- Карта прогресса -->
        <div class="progress-map-container scrollbar-hidden">
            <div class="progress-map" id="progressMap">
                <!-- Карта будет сгенерирована динамически -->
            </div>
            <button class="toggle-map-btn" id="toggleMapBtn" onclick="toggleProgressMap()">
                <i class="fas fa-chevron-up"></i>
            </button>
        </div>
    </header>

    <!-- Основной контейнер -->
    <main class="main-container">
        <!-- Левая панель - Курсы и модули -->
        <aside class="sidebar-left">
            <!-- Фильтры -->
            <div class="module-card">
                <div class="module-header">
                    <div class="module-icon" style="background: var(--gradient-red);">
                        <i class="fas fa-filter"></i>
                    </div>
                    <div class="module-info">
                        <h3>Фильтры</h3>
                        <div class="module-stats">
                            <span>Темы</span>
                        </div>
                    </div>
                </div>
                <div class="module-content">
                    <div class="filters-container">
                        <div class="filter-group">
                            <label style="font-size: 12px; color: var(--accent-purple);">Сложность:</label>
                            <select class="filter-select" onchange="filterTopics('difficulty', this.value)">
                                <option value="all">Все</option>
                                <option value="beginner">Начинающий</option>
                                <option value="intermediate">Средний</option>
                                <option value="advanced">Продвинутый</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label style="font-size: 12px; color: var(--accent-purple);">Статус:</label>
                            <select class="filter-select" onchange="filterTopics('status', this.value)">
                                <option value="all">Все</option>
                                <option value="completed">Завершено</option>
                                <option value="in-progress">В процессе</option>
                                <option value="locked">Заблокировано</option>
                            </select>
                        </div>
                    </div>
                    <div class="tag-cloud" id="topicTags">
                        <!-- Теги будут загружены динамически -->
                    </div>
                </div>
            </div>

            <!-- Модуль: Основы C++ -->
            <div class="module-card">
                <div class="module-header">
                    <div class="module-icon" style="background: var(--gradient-blue);">
                        <i class="fas fa-play-circle"></i>
                    </div>
                    <div class="module-info">
                        <h3>Основы C++</h3>
                        <div class="module-stats">
                            <span>12 тем</span>
                            <span>65%</span>
                        </div>
                    </div>
                </div>
                <div class="module-content">
                    <div class="module-topics" id="basicsTopics">
                        <!-- Темы будут загружены динамически -->
                    </div>
                </div>
            </div>

            <!-- Модуль: ООП -->
            <div class="module-card">
                <div class="module-header">
                    <div class="module-icon" style="background: var(--gradient-green);">
                        <i class="fas fa-cube"></i>
                    </div>
                    <div class="module-info">
                        <h3>Объектно-ориентированное программирование</h3>
                        <div class="module-stats">
                            <span>8 тем</span>
                            <span>20%</span>
                        </div>
                    </div>
                </div>
                <div class="module-content">
                    <div class="module-topics" id="oopTopics">
                        <!-- Темы будут загружены динамически -->
                    </div>
                </div>
            </div>

            <!-- Модуль: Алгоритмы -->
            <div class="module-card">
                <div class="module-header">
                    <div class="module-icon" style="background: var(--gradient-orange);">
                        <i class="fas fa-sort-amount-up"></i>
                    </div>
                    <div class="module-info">
                        <h3>Алгоритмы и структуры данных</h3>
                        <div class="module-stats">
                            <span>15 тем</span>
                            <span>0%</span>
                        </div>
                    </div>
                </div>
                <div class="module-content">
                    <div class="module-topics" id="algorithmsTopics">
                        <!-- Темы будут загружены динамически -->
                    </div>
                </div>
            </div>
        </aside>

        <!-- Центральная панель - Контент -->
        <section class="content-main">
            <!-- Теория -->
            <div id="theorySection" class="content-section active">
                <div class="content-card">
                    <div class="content-header">
                        <div class="content-title">
                            <div class="content-title-icon">
                                <i class="fas fa-book"></i>
                            </div>
                            <span id="currentTopicTitle">Введение в C++</span>
                        </div>
                        <div class="content-controls">
                            <button class="btn btn-outline" onclick="prevTopic()">
                                <i class="fas fa-chevron-left"></i> Назад
                            </button>
                            <button class="btn btn-primary" onclick="nextTopic()">
                                Далее <i class="fas fa-chevron-right"></i>
                            </button>
                            <button class="btn btn-outline" onclick="toggleBookmark()">
                                <i class="fas fa-bookmark"></i>
                            </button>
                            <button class="btn btn-outline" onclick="showHistory()">
                                <i class="fas fa-history"></i>
                            </button>
                        </div>
                    </div>
                    <div class="theory-content" id="theoryContent">
                        <!-- Контент теории будет загружен динамически -->
                    </div>
                </div>
            </div>

            <!-- Лабораторные работы -->
            <div id="labsSection" class="content-section">
                <div class="content-card">
                    <div class="content-header">
                        <div class="content-title">
                            <div class="content-title-icon" style="background: rgba(80, 250, 123, 0.1); color: var(--accent-green);">
                                <i class="fas fa-flask"></i>
                            </div>
                            <span>Лабораторные работы</span>
                        </div>
                        <div class="content-controls">
                            <button class="btn btn-outline" onclick="filterLabs('all')">
                                Все
                            </button>
                            <button class="btn btn-outline" onclick="filterLabs('completed')">
                                Завершенные
                            </button>
                            <button class="btn btn-primary" onclick="createNewLab()">
                                <i class="fas fa-plus"></i> Новая
                            </button>
                        </div>
                    </div>
                    
                    <!-- Фильтры лабораторных -->
                    <div class="filters-container">
                        <div class="filter-group">
                            <input type="text" class="search-input" placeholder="Поиск лабораторных..." 
                                   style="width: 200px;" oninput="searchLabs(this.value)">
                        </div>
                        <div class="filter-group">
                            <div class="filter-tag" onclick="filterLabsByTag('all')" id="tagAll">Все</div>
                            <div class="filter-tag" onclick="filterLabsByTag('beginner')" id="tagBeginner">Начинающий</div>
                            <div class="filter-tag" onclick="filterLabsByTag('intermediate')" id="tagIntermediate">Средний</div>
                            <div class="filter-tag" onclick="filterLabsByTag('advanced')" id="tagAdvanced">Продвинутый</div>
                        </div>
                    </div>
                    
                    <div class="labs-grid" id="labsGrid">
                        <!-- Лабораторные работы будут загружены динамически -->
                    </div>
                </div>
            </div>

            <!-- Тесты -->
            <div id="testsSection" class="content-section">
                <div class="content-card">
                    <div class="content-header">
                        <div class="content-title">
                            <div class="content-title-icon" style="background: rgba(241, 250, 140, 0.1); color: var(--accent-yellow);">
                                <i class="fas fa-graduation-cap"></i>
                            </div>
                            <span>Тестирование знаний</span>
                        </div>
                        <div class="content-controls">
                            <button class="btn btn-outline" onclick="resetTest()">
                                <i class="fas fa-redo"></i> Сброс
                            </button>
                            <button class="btn btn-primary" id="submitTestBtn" onclick="submitTest()" style="display: none;">
                                <i class="fas fa-paper-plane"></i> Завершить тест
                            </button>
                        </div>
                    </div>
                    <div id="testContainer">
                        <!-- Контейнер для тестов -->
                    </div>
                </div>
            </div>

            <!-- Практика -->
            <div id="practiceSection" class="content-section">
                <div class="content-card">
                    <div class="content-header">
                        <div class="content-title">
                            <div class="content-title-icon" style="background: rgba(100, 255, 218, 0.1);">
                                <i class="fas fa-code"></i>
                            </div>
                            <span>Практика программирования</span>
                        </div>
                        <div class="content-controls">
                            <button class="btn btn-outline" onclick="saveCode()">
                                <i class="fas fa-save"></i> Сохранить
                            </button>
                            <button class="btn btn-primary" onclick="runCode()">
                                <i class="fas fa-play"></i> Запуск
                            </button>
                            <button class="btn btn-outline" onclick="debugCode()">
                                <i class="fas fa-bug"></i> Отладка
                            </button>
                            <button class="btn btn-outline" onclick="exportProject()">
                                <i class="fas fa-download"></i> Экспорт
                            </button>
                        </div>
                    </div>
                    <div class="practice-container">
                        <!-- Файловый менеджер -->
                        <div class="editor-header">
                            <div class="file-tabs" id="fileTabs">
                                <!-- Вкладки файлов -->
                            </div>
                            <div class="editor-controls">
                                <button class="btn btn-small btn-outline" onclick="createNewFile()">
                                    <i class="fas fa-plus"></i> Файл
                                </button>
                                <button class="btn btn-small btn-outline" onclick="createNewFolder()">
                                    <i class="fas fa-folder-plus"></i> Папка
                                </button>
                                <button class="btn btn-small btn-outline" onclick="deleteFile()">
                                    <i class="fas fa-trash"></i> Удалить
                                </button>
                                <button class="btn btn-small btn-outline" onclick="renameFile()">
                                    <i class="fas fa-edit"></i> Переименовать
                                </button>
                            </div>
                        </div>

                        <!-- Редактор кода -->
                        <div class="code-editor-container">
                            <textarea id="codeEditor"></textarea>
                        </div>

                        <!-- Вывод программы -->
                        <div class="editor-output">
                            <div class="output-header">
                                <div style="color: var(--accent-blue); font-weight: 600;">
                                    <i class="fas fa-terminal"></i> Вывод программы:
                                </div>
                                <div>
                                    <button class="btn btn-small btn-outline" onclick="clearOutput()">
                                        <i class="fas fa-broom"></i> Очистить
                                    </button>
                                </div>
                            </div>
                            <div id="programOutput">
                                <!-- Вывод программы -->
                            </div>
                        </div>

                        <!-- Симулятор памяти -->
                        <div class="memory-simulator">
                            <div class="content-header" style="margin-bottom: 15px; padding-bottom: 15px;">
                                <div class="content-title" style="font-size: 20px;">
                                    <div class="content-title-icon" style="width: 40px; height: 40px; font-size: 20px;">
                                        <i class="fas fa-memory"></i>
                                    </div>
                                    <span>Симулятор памяти</span>
                                </div>
                                <div class="memory-controls">
                                    <button class="btn btn-small btn-outline" onclick="stepMemory()">
                                        <i class="fas fa-step-forward"></i> Шаг
                                    </button>
                                    <button class="btn btn-small btn-outline" onclick="resetMemory()">
                                        <i class="fas fa-redo"></i> Сброс
                                    </button>
                                    <button class="btn btn-small btn-outline" onclick="visualizeMemory()">
                                        <i class="fas fa-eye"></i> Визуализация
                                    </button>
                                    <button class="btn btn-small btn-outline" onclick="explainMemory()">
                                        <i class="fas fa-info-circle"></i> Объяснение
                                    </button>
                                </div>
                            </div>
                            <div class="memory-visualization" id="memoryVisualization">
                                <!-- Ячейки памяти -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Игры -->
            <div id="gamesSection" class="content-section">
                <div class="content-card">
                    <div class="content-header">
                        <div class="content-title">
                            <div class="content-title-icon" style="background: rgba(255, 184, 108, 0.1); color: var(--accent-orange);">
                                <i class="fas fa-gamepad"></i>
                            </div>
                            <span>Игровое обучение</span>
                        </div>
                        <div class="content-controls">
                            <button class="btn btn-outline" onclick="showAllGames()">
                                Все игры
                            </button>
                            <button class="btn btn-outline" onclick="showLeaderboard()">
                                <i class="fas fa-trophy"></i> Таблица лидеров
                            </button>
                        </div>
                    </div>
                    <div class="games-container" id="gamesContainer">
                        <!-- Игры будут загружены динамически -->
                    </div>
                </div>
            </div>

            <!-- Проекты -->
            <div id="projectsSection" class="content-section">
                <div class="content-card">
                    <div class="content-header">
                        <div class="content-title">
                            <div class="content-title-icon" style="background: rgba(189, 147, 249, 0.1); color: #bd93f9;">
                                <i class="fas fa-project-diagram"></i>
                            </div>
                            <span>Проекты</span>
                        </div>
                        <div class="content-controls">
                            <button class="btn btn-outline" onclick="showAllProjects()">
                                Все проекты
                            </button>
                            <button class="btn btn-primary" onclick="createNewProject()">
                                <i class="fas fa-plus"></i> Новый проект
                            </button>
                            <button class="btn btn-outline" onclick="importProject()">
                                <i class="fas fa-file-import"></i> Импорт
                            </button>
                        </div>
                    </div>
                    <div class="projects-grid" id="projectsGrid">
                        <!-- Проекты будут загружены динамически -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Правая панель - Профиль и статистика -->
        <aside class="sidebar-right">
            <!-- Карточка профиля -->
            <div class="profile-card">
                <div class="profile-avatar" id="profileAvatar" onclick="openAvatarEditor()">
                    <i class="fas fa-user"></i>
                    <div class="avatar-level" id="avatarLevel">5</div>
                </div>
                <div class="profile-info">
                    <h3 id="profileName">Алексей</h3>
                    <div class="profile-rank" id="profileRank">Знаток</div>
                </div>

                <div class="xp-progress">
                    <div class="xp-bar">
                        <div class="xp-fill" id="xpBarFill"></div>
                    </div>
                    <div class="xp-info">
                        <span>Уровень 5</span>
                        <span id="xpText">245/500 XP</span>
                    </div>
                </div>

                <div class="profile-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="completedTopics">8</div>
                        <div class="stat-label">Темы</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="completedLabs">5</div>
                        <div class="stat-label">Лабораторные</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="codeLines">1247</div>
                        <div class="stat-label">Строк кода</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="achievementCount">12</div>
                        <div class="stat-label">Достижения</div>
                    </div>
                </div>
                
                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button class="btn btn-small btn-outline" style="flex: 1;" onclick="openSettings()">
                        <i class="fas fa-cog"></i> Настройки
                    </button>
                    <button class="btn btn-small btn-outline" style="flex: 1;" onclick="generateCertificate()">
                        <i class="fas fa-award"></i> Сертификат
                    </button>
                </div>
            </div>

            <!-- Достижения -->
            <div class="achievements-container">
                <div class="content-header" style="padding: 0 0 15px 0; margin-bottom: 0;">
                    <div class="content-title" style="font-size: 18px;">
                        <i class="fas fa-trophy" style="color: var(--accent-yellow);"></i>
                        <span>Достижения</span>
                    </div>
                    <button class="btn btn-small btn-outline" onclick="showAllAchievements()">
                        Все
                    </button>
                </div>
                <div class="achievements-grid" id="achievementsGrid">
                    <!-- Достижения будут загружены динамически -->
                </div>
            </div>

            <!-- Активность -->
            <div class="activity-container">
                <div class="content-header" style="padding: 0 0 15px 0; margin-bottom: 0;">
                    <div class="content-title" style="font-size: 18px;">
                        <i class="fas fa-history"></i>
                        <span>Активность</span>
                    </div>
                    <button class="btn btn-small btn-outline" onclick="clearActivity()">
                        Очистить
                    </button>
                </div>
                <div class="activity-list" id="activityList">
                    <!-- Список активности будет загружен динамически -->
                </div>
            </div>

            <!-- Календарь активности -->
            <div class="activity-container">
                <div class="content-header" style="padding: 0 0 15px 0; margin-bottom: 0;">
                    <div class="content-title" style="font-size: 18px;">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Активность за неделю</span>
                    </div>
                </div>
                <div class="activity-calendar" id="activityCalendar">
                    <!-- Календарь будет загружен динамически -->
                </div>
            </div>
        </aside>
    </main>

    <!-- Модальные окна -->
    <div class="modal-overlay" id="labModal">
        <div class="modal-container">
            <div class="modal-header">
                <h2><i class="fas fa-flask"></i> Лабораторная работа</h2>
                <button class="btn btn-outline" onclick="closeModal()">
                    <i class="fas fa-times"></i> Закрыть
                </button>
            </div>
            <div class="modal-body">
                <div class="lab-modal-content" id="labModalContent">
                    <!-- Контент лабораторной -->
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="profileModal">
        <div class="modal-container">
            <div class="modal-header">
                <h2><i class="fas fa-user-circle"></i> Профиль и статистика</h2>
                <button class="btn btn-outline" onclick="closeModal()">
                    <i class="fas fa-times"></i> Закрыть
                </button>
            </div>
            <div class="modal-body">
                <div class="profile-modal-content">
                    <div class="profile-sidebar">
                        <div class="profile-card" style="padding: 20px;">
                            <div class="profile-avatar" style="width: 120px; height: 120px; font-size: 48px;" onclick="openAvatarEditor()">
                                <div class="avatar-level">5</div>
                            </div>
                            <h3 style="margin-top: 15px;" id="modalUserName">Алексей</h3>
                            <div class="profile-rank" style="margin-bottom: 20px;" id="modalUserRank">Знаток C++</div>
                            
                            <div class="profile-stats-grid">
                                <div class="stat-large">
                                    <div class="stat-large-value">245</div>
                                    <div class="stat-large-label">Текущий XP</div>
                                </div>
                                <div class="stat-large">
                                    <div class="stat-large-value">7</div>
                                    <div class="stat-large-label">Дней подряд</div>
                                </div>
                                <div class="stat-large">
                                    <div class="stat-large-value">87%</div>
                                    <div class="stat-large-label">Успеваемость</div>
                                </div>
                                <div class="stat-large">
                                    <div class="stat-large-value">24ч</div>
                                    <div class="stat-large-label">Время обучения</div>
                                </div>
                            </div>
                            
                            <div style="margin-top: 20px;">
                                <button class="btn btn-outline" style="width: 100%; margin-bottom: 10px;" onclick="openSettings()">
                                    <i class="fas fa-cog"></i> Настройки профиля
                                </button>
                                <button class="btn btn-outline" style="width: 100%; margin-bottom: 10px;" onclick="exportUserData()">
                                    <i class="fas fa-download"></i> Экспорт данных
                                </button>
                                <button class="btn btn-outline" style="width: 100%;" onclick="resetProgress()">
                                    <i class="fas fa-trash"></i> Сбросить прогресс
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 25px;">
                        <div class="stats-chart-container">
                            <h3 style="color: var(--accent-blue); margin-bottom: 20px;">Прогресс по темам</h3>
                            <canvas class="chart-canvas" id="progressChart"></canvas>
                        </div>
                        
                        <div class="skills-chart">
                            <h3 style="color: var(--accent-blue); margin-bottom: 20px;">Навыки C++</h3>
                            <div id="skillsChart">
                                <!-- Диаграмма навыков -->
                            </div>
                        </div>
                        
                        <div>
                            <h3 style="color: var(--accent-blue); margin-bottom: 20px;">Последние достижения</h3>
                            <div class="achievements-grid" style="grid-template-columns: repeat(4, 1fr);" id="modalAchievements">
                                <!-- Достижения -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="avatarModal">
        <div class="modal-container">
            <div class="modal-header">
                <h2><i class="fas fa-user-edit"></i> Редактор аватара</h2>
                <button class="btn btn-outline" onclick="closeModal()">
                    <i class="fas fa-times"></i> Закрыть
                </button>
            </div>
            <div class="modal-body">
                <div class="avatar-editor-container">
                    <div class="avatar-preview-container" id="avatarDropZone">
                        <img id="avatarPreview" class="avatar-preview" src="" alt="Предпросмотр аватара">
                        <div id="avatarPlaceholder" style="text-align: center;">
                            <div class="file-upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <p style="color: var(--accent-blue); margin-bottom: 10px;">
                                Перетащите изображение сюда или кликните для загрузки
                            </p>
                            <p style="font-size: 12px; color: var(--accent-purple);">
                                Поддерживаемые форматы: JPG, PNG, WEBP<br>
                                Максимальный размер: 5MB
                            </p>
                        </div>
                    </div>
                    
                    <input type="file" id="avatarUpload" accept="image/*" style="display: none;" onchange="handleAvatarUpload(event)">
                    
                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <button class="btn btn-outline" style="flex: 1;" onclick="document.getElementById('avatarUpload').click()">
                            <i class="fas fa-upload"></i> Загрузить фото
                        </button>
                        <button class="btn btn-outline" style="flex: 1;" onclick="generateAvatar()">
                            <i class="fas fa-robot"></i> Сгенерировать
                        </button>
                    </div>
                    
                    <div class="avatar-controls">
                        <div class="avatar-control" onclick="applyFilter('brightness')">
                            <i class="fas fa-sun"></i>
                            <div>Яркость</div>
                        </div>
                        <div class="avatar-control" onclick="applyFilter('contrast')">
                            <i class="fas fa-adjust"></i>
                            <div>Контраст</div>
                        </div>
                        <div class="avatar-control" onclick="applyFilter('grayscale')">
                            <i class="fas fa-tint-slash"></i>
                            <div>Ч/Б</div>
                        </div>
                        <div class="avatar-control" onclick="applyFilter('sepia')">
                            <i class="fas fa-image"></i>
                            <div>Сепия</div>
                        </div>
                        <div class="avatar-control" onclick="addFrame()">
                            <i class="fas fa-square"></i>
                            <div>Рамка</div>
                        </div>
                        <div class="avatar-control" onclick="addSticker()">
                            <i class="fas fa-sticky-note"></i>
                            <div>Стикер</div>
                        </div>
                        <div class="avatar-control" onclick="cropAvatar()">
                            <i class="fas fa-crop"></i>
                            <div>Обрезать</div>
                        </div>
                        <div class="avatar-control" onclick="resetAvatar()">
                            <i class="fas fa-undo"></i>
                            <div>Сброс</div>
                        </div>
                    </div>
                    
                    <div>
                        <h4 style="color: var(--accent-blue); margin: 20px 0 10px 0;">История аватарок</h4>
                        <div class="avatar-history" id="avatarHistory">
                            <!-- История аватарок -->
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 30px;">
                        <button class="btn btn-primary" style="flex: 1;" onclick="saveAvatar()">
                            <i class="fas fa-save"></i> Сохранить аватар
                        </button>
                        <button class="btn btn-outline" style="flex: 1;" onclick="exportAvatar()">
                            <i class="fas fa-download"></i> Экспорт PNG
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="settingsModal">
        <div class="modal-container">
            <div class="modal-header">
                <h2><i class="fas fa-cog"></i> Настройки</h2>
                <button class="btn btn-outline" onclick="closeModal()">
                    <i class="fas fa-times"></i> Закрыть
                </button>
            </div>
            <div class="modal-body">
                <div class="settings-container">
                    <div class="settings-nav">
                        <div class="settings-nav-item active" onclick="showSettingsSection('appearance')">
                            <i class="fas fa-palette"></i> Внешний вид
                        </div>
                        <div class="settings-nav-item" onclick="showSettingsSection('editor')">
                            <i class="fas fa-code"></i> Редактор
                        </div>
                        <div class="settings-nav-item" onclick="showSettingsSection('account')">
                            <i class="fas fa-user"></i> Аккаунт
                        </div>
                        <div class="settings-nav-item" onclick="showSettingsSection('notifications')">
                            <i class="fas fa-bell"></i> Уведомления
                        </div>
                        <div class="settings-nav-item" onclick="showSettingsSection('accessibility')">
                            <i class="fas fa-universal-access"></i> Доступность
                        </div>
                        <div class="settings-nav-item" onclick="showSettingsSection('data')">
                            <i class="fas fa-database"></i> Данные
                        </div>
                    </div>
                    
                    <div class="settings-content">
                        <div class="settings-section active" id="appearanceSection">
                            <div class="settings-group">
                                <h3 class="settings-group-title">Тема оформления</h3>
                                <div class="theme-selector">
                                    <div class="theme-option theme-dark selected" onclick="changeTheme('dark')">
                                        <div class="theme-preview">
                                            <i class="fas fa-moon"></i>
                                        </div>
                                        <div>Темная</div>
                                    </div>
                                    <div class="theme-option theme-light" onclick="changeTheme('light')">
                                        <div class="theme-preview">
                                            <i class="fas fa-sun"></i>
                                        </div>
                                        <div>Светлая</div>
                                    </div>
                                    <div class="theme-option theme-blue" onclick="changeTheme('blue')">
                                        <div class="theme-preview">
                                            <i class="fas fa-palette"></i>
                                        </div>
                                        <div>Синяя</div>
                                    </div>
                                    <div class="theme-option theme-green" onclick="changeTheme('green')">
                                        <div class="theme-preview">
                                            <i class="fas fa-leaf"></i>
                                        </div>
                                        <div>Зеленая</div>
                                    </div>
                                    <div class="theme-option theme-purple" onclick="changeTheme('purple')">
                                        <div class="theme-preview">
                                            <i class="fas fa-gem"></i>
                                        </div>
                                        <div>Фиолетовая</div>
                                    </div>
                                    <div class="theme-option theme-high-contrast" onclick="changeTheme('high-contrast')">
                                        <div class="theme-preview">
                                            <i class="fas fa-eye"></i>
                                        </div>
                                        <div>Высокий контраст</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="settings-group">
                                <h3 class="settings-group-title">Настройки интерфейса</h3>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <div class="setting-name">Язык интерфейса</div>
                                        <div class="setting-description">Выберите язык платформы</div>
                                    </div>
                                    <div class="setting-control">
                                        <select class="filter-select" onchange="changeLanguage(this.value)">
                                            <option value="ru">Русский</option>
                                            <option value="en">English</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <div class="setting-name">Анимации</div>
                                        <div class="setting-description">Включить/выключить анимации интерфейса</div>
                                    </div>
                                    <div class="setting-control">
                                        <label class="toggle-switch">
                                            <input type="checkbox" checked onchange="toggleAnimations(this.checked)">
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <div class="setting-name">Компактный режим</div>
                                        <div class="setting-description">Уменьшить отступы и размеры элементов</div>
                                    </div>
                                    <div class="setting-control">
                                        <label class="toggle-switch">
                                            <input type="checkbox" onchange="toggleCompactMode(this.checked)">
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="settings-section" id="editorSection">
                            <div class="settings-group">
                                <h3 class="settings-group-title">Редактор кода</h3>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <div class="setting-name">Размер шрифта</div>
                                        <div class="setting-description">Размер текста в редакторе</div>
                                    </div>
                                    <div class="setting-control">
                                        <select class="filter-select" onchange="changeEditorFontSize(this.value)">
                                            <option value="12">12px</option>
                                            <option value="14" selected>14px</option>
                                            <option value="16">16px</option>
                                            <option value="18">18px</option>
                                            <option value="20">20px</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <div class="setting-name">Автодополнение</div>
                                        <div class="setting-description">Подсказки при наборе кода</div>
                                    </div>
                                    <div class="setting-control">
                                        <label class="toggle-switch">
                                            <input type="checkbox" checked onchange="toggleAutocomplete(this.checked)">
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <div class="setting-name">Автосохранение</div>
                                        <div class="setting-description">Автоматически сохранять изменения</div>
                                    </div>
                                    <div class="setting-control">
                                        <label class="toggle-switch">
                                            <input type="checkbox" checked onchange="toggleAutosave(this.checked)">
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <div class="setting-name">Подсветка синтаксиса</div>
                                        <div class="setting-description">Цветовое выделение кода</div>
                                    </div>
                                    <div class="setting-control">
                                        <label class="toggle-switch">
                                            <input type="checkbox" checked onchange="toggleSyntaxHighlighting(this.checked)">
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <div class="setting-name">Отступы</div>
                                        <div class="setting-description">Размер отступа (пробелов)</div>
                                    </div>
                                    <div class="setting-control">
                                        <select class="filter-select" onchange="changeTabSize(this.value)">
                                            <option value="2">2 пробела</option>
                                            <option value="4" selected>4 пробела</option>
                                            <option value="8">8 пробелов</option>
                                            <option value="tab">Tab</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="settings-section" id="accountSection">
                            <div class="settings-group">
                                <h3 class="settings-group-title">Персональные данные</h3>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <div class="setting-name">Имя</div>
                                        <div class="setting-description">Ваше имя и фамилия</div>
                                    </div>
                                    <div class="setting-control">
                                        <input type="text" class="search-input" value="Алексей" style="width: 200px;" 
                                               onchange="updateUserName(this.value)">
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <div class="setting-name">Никнейм</div>
                                        <div class="setting-description">Уникальное имя пользователя</div>
                                    </div>
                                    <div class="setting-control">
                                        <input type="text" class="search-input" value="coder_alex" style="width: 200px;"
                                               onchange="updateUserNickname(this.value)">
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <div class="setting-name">Email</div>
                                        <div class="setting-description">Электронная почта</div>
                                    </div>
                                    <div class="setting-control">
                                        <input type="email" class="search-input" value="alex@example.com" style="width: 200px;"
                                               onchange="updateUserEmail(this.value)">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="settings-section" id="dataSection">
                            <div class="settings-group">
                                <h3 class="settings-group-title">Управление данными</h3>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <div class="setting-name">Автосохранение</div>
                                        <div class="setting-description">Автоматическое сохранение прогресса</div>
                                    </div>
                                    <div class="setting-control">
                                        <label class="toggle-switch">
                                            <input type="checkbox" checked onchange="toggleAutoSaveData(this.checked)">
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-label">
                                        <div class="setting-name">Резервные копии</div>
                                        <div class="setting-description">Создавать резервные копии каждые 30 минут</div>
                                    </div>
                                    <div class="setting-control">
                                        <label class="toggle-switch">
                                            <input type="checkbox" checked onchange="toggleBackups(this.checked)">
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div style="margin-top: 30px;">
                                    <button class="btn btn-outline" onclick="exportAllData()" style="width: 100%; margin-bottom: 10px;">
                                        <i class="fas fa-download"></i> Экспорт всех данных
                                    </button>
                                    <button class="btn btn-outline" onclick="importData()" style="width: 100%; margin-bottom: 10px;">
                                        <i class="fas fa-file-import"></i> Импорт данных
                                    </button>
                                    <button class="btn btn-outline" onclick="clearAllData()" style="width: 100%;">
                                        <i class="fas fa-trash"></i> Очистить все данные
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="certificateModal">
        <div class="modal-container" style="max-width: 900px;">
            <div class="modal-header">
                <h2><i class="fas fa-award"></i> Сертификат об обучении</h2>
                <button class="btn btn-outline" onclick="closeModal()">
                    <i class="fas fa-times"></i> Закрыть
                </button>
            </div>
            <div class="modal-body">
                <div class="certificate-container" id="certificateCanvas">
                    <div class="certificate-header">
                        C++ Visual Lab
                    </div>
                    <div class="certificate-title">
                        СЕРТИФИКАТ ОБ ОБУЧЕНИИ
                    </div>
                    <div class="certificate-name" id="certificateName">
                        Алексей
                    </div>
                    <div class="certificate-details">
                        Настоящим удостоверяется, что <strong id="certificateStudentName">Алексей</strong><br>
                        успешно завершил(а) курс <strong>"Основы C++"</strong><br>
                        и достиг(ла) уровня <strong id="certificateLevel">Знаток</strong><br>
                        с результатом <strong id="certificateScore">87%</strong>
                    </div>
                    <div class="certificate-date">
                        Дата выдачи: <span id="certificateDate">15 марта 2024</span>
                    </div>
                    <div class="certificate-stamp">
                        УДОСТОВЕРЕНО<br>C++ Visual Lab
                    </div>
                </div>
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-primary" onclick="downloadCertificate()">
                        <i class="fas fa-download"></i> Скачать сертификат (PNG)
                    </button>
                    <button class="btn btn-outline" onclick="shareCertificate()">
                        <i class="fas fa-share-alt"></i> Поделиться
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="leaderboardModal">
        <div class="modal-container">
            <div class="modal-header">
                <h2><i class="fas fa-trophy"></i> Таблица лидеров</h2>
                <button class="btn btn-outline" onclick="closeModal()">
                    <i class="fas fa-times"></i> Закрыть
                </button>
            </div>
            <div class="modal-body">
                <div class="filters-container" style="margin-bottom: 20px;">
                    <div class="filter-group">
                        <div class="filter-tag active" onclick="changeLeaderboardPeriod('all')">Все время</div>
                        <div class="filter-tag" onclick="changeLeaderboardPeriod('week')">Неделя</div>
                        <div class="filter-tag" onclick="changeLeaderboardPeriod('month')">Месяц</div>
                    </div>
                </div>
                
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>Место</th>
                            <th>Имя</th>
                            <th>Уровень</th>
                            <th>XP</th>
                            <th>Темы</th>
                            <th>Лабы</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboardBody">
                        <!-- Таблица лидеров будет загружена динамически -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Уведомления -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/clike/clike.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closebrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/comment/comment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldgutter.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/selection/active-line.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/search.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/searchcursor.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/show-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/anyword-hint.min.js"></script>
    <script src="https://unpkg.com/cropperjs/dist/cropper.min.js"></script>

    <script>
        // ================ КОНСТАНТЫ И КОНФИГУРАЦИЯ ================
        const CONFIG = {
            APP_NAME: "C++ Visual Lab",
            VERSION: "3.0.0",
            MAX_LEVEL: 100,
            BASE_XP: 100,
            XP_MULTIPLIER: 1.2,
            ACHIEVEMENTS_COUNT: 24,
            DAILY_STREAK_XP: 25,
            COMPLETION_XP: 50,
            TEST_XP_PER_QUESTION: 10,
            MAX_AVATAR_SIZE: 5 * 1024 * 1024, // 5MB
            AVATAR_HISTORY_LIMIT: 5,
            AUTO_SAVE_INTERVAL: 30000, // 30 секунд
            BACKUP_INTERVAL: 1800000 // 30 минут
        };

        // ================ СТРУКТУРА КУРСА ================
        const COURSE_STRUCTURE = {
            modules: [
                {
                    id: "basics",
                    name: "Основы C++",
                    icon: "fa-play-circle",
                    color: "gradient-blue",
                    totalPoints: 1000,
                    topics: [
                        {
                            id: "intro",
                            title: "Введение в C++",
                            type: "theory",
                            duration: 15,
                            difficulty: "beginner",
                            points: 100,
                            completed: true,
                            tags: ["базовый", "введение", "синтаксис"],
                            content: `
                                <h3>🎯 Что такое C++?</h3>
                                <p>C++ — это мощный язык программирования общего назначения, который поддерживает различные парадигмы программирования: процедурное, объектно-ориентированное и обобщенное программирование.</p>
                                
                                <div class="interactive-block">
                                    <div class="interactive-header">
                                        <div class="interactive-icon">
                                            <i class="fas fa-lightbulb"></i>
                                        </div>
                                        <h4>Ключевые особенности C++</h4>
                                    </div>
                                    <div class="lab-objectives">
                                        <div class="lab-objective">
                                            <i class="fas fa-bolt" style="color: var(--accent-green);"></i>
                                            <span><strong>Высокая производительность</strong> — компилируемый язык, близкий к железу</span>
                                        </div>
                                        <div class="lab-objective">
                                            <i class="fas fa-cube" style="color: var(--accent-blue);"></i>
                                            <span><strong>Объектно-ориентированный</strong> — классы, наследование, полиморфизм</span>
                                        </div>
                                        <div class="lab-objective">
                                            <i class="fas fa-layer-group" style="color: var(--accent-yellow);"></i>
                                            <span><strong>Шаблоны</strong> — обобщенное программирование</span>
                                        </div>
                                        <div class="lab-objective">
                                            <i class="fas fa-microchip" style="color: var(--accent-red);"></i>
                                            <span><strong>Прямой доступ к памяти</strong> — указатели и ссылки</span>
                                        </div>
                                        <div class="lab-objective">
                                            <i class="fas fa-book" style="color: var(--accent-purple);"></i>
                                            <span><strong>Богатая стандартная библиотека (STL)</strong></span>
                                        </div>
                                    </div>
                                </div>
                                
                                <h3>🚀 Первая программа</h3>
                                <p>Традиционно первая программа на любом языке программирования выводит приветствие "Hello, World!".</p>
                                
                                <div class="code-example">
                                    <div class="code-header">
                                        <div class="code-title">
                                            <i class="fas fa-code"></i>
                                            <span>hello.cpp</span>
                                        </div>
                                        <div class="code-actions">
                                            <button class="btn btn-small btn-outline" onclick="copyCode('code1')">
                                                <i class="fas fa-copy"></i> Копировать
                                            </button>
                                            <button class="btn btn-small btn-primary" onclick="runExample('code1')">
                                                <i class="fas fa-play"></i> Запустить
                                            </button>
                                        </div>
                                    </div>
                                    <div class="code-body" id="code1">#include <iostream>

using namespace std;

int main() {
    cout << "Hello, C++ World!" << endl;
    cout << "Добро пожаловать в C++ Visual Lab!" << endl;
    return 0;
}</div>
                                </div>
                                
                                <h3>📊 Области применения</h3>
                                <div class="lab-objectives">
                                    <div class="lab-objective">
                                        <i class="fas fa-gamepad"></i>
                                        <span><strong>Разработка игр</strong> — Unreal Engine, CryEngine</span>
                                    </div>
                                    <div class="lab-objective">
                                        <i class="fas fa-desktop"></i>
                                        <span><strong>Системное программирование</strong> — операционные системы, драйверы</span>
                                    </div>
                                    <div class="lab-objective">
                                        <i class="fas fa-chart-line"></i>
                                        <span><strong>Высокопроизводительные вычисления</strong> — научные расчеты, симуляции</span>
                                    </div>
                                    <div class="lab-objective">
                                        <i class="fas fa-mobile-alt"></i>
                                        <span><strong>Встраиваемые системы</strong> — IoT, микроконтроллеры</span>
                                    </div>
                                    <div class="lab-objective">
                                        <i class="fas fa-database"></i>
                                        <span><strong>Базы данных</strong> — MySQL, PostgreSQL</span>
                                    </div>
                                </div>
                                
                                <div class="interactive-block" style="background: rgba(100, 255, 218, 0.05);">
                                    <div class="interactive-header">
                                        <div class="interactive-icon">
                                            <i class="fas fa-question-circle"></i>
                                        </div>
                                        <h4>Проверьте свои знания</h4>
                                    </div>
                                    <p>Какой заголовочный файл необходим для ввода-вывода в C++?</p>
                                    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 15px;">
                                        <button class="btn btn-small btn-outline" onclick="checkAnswer(this, 'iostream', true)">iostream</button>
                                        <button class="btn btn-small btn-outline" onclick="checkAnswer(this, 'stdio.h', false)">stdio.h</button>
                                        <button class="btn btn-small btn-outline" onclick="checkAnswer(this, 'input', false)">input</button>
                                        <button class="btn btn-small btn-outline" onclick="checkAnswer(this, 'stream', false)">stream</button>
                                    </div>
                                </div>
                            `
                        },
                        {
                            id: "variables",
                            title: "Переменные и типы данных",
                            type: "theory",
                            duration: 20,
                            difficulty: "beginner",
                            points: 150,
                            completed: true,
                            tags: ["переменные", "типы", "базовый"],
                            content: `
                                <h3>📦 Переменные в C++</h3>
                                <p>Переменная — это именованная область памяти для хранения данных. В C++ переменные должны быть объявлены перед использованием.</p>
                                
                                <div class="code-example">
                                    <div class="code-header">
                                        <div class="code-title">
                                            <i class="fas fa-code"></i>
                                            <span>Объявление переменных</span>
                                        </div>
                                    </div>
                                    <div class="code-body">// Разные способы объявления переменных
int age = 25;                    // Целое число
double price = 99.99;           // Число с плавающей точкой
char grade = 'A';               // Символ
bool is_valid = true;           // Логическое значение
string name = "Иван";           // Строка (требует #include <string>)

// Современные способы инициализации (C++11 и выше)
int count{10};                  // Uniform инициализация
auto score = 95.5;              // Автовывод типа
const double PI = 3.14159;      // Константа
constexpr int MAX_SIZE = 100;   // Константа времени компиляции</div>
                                </div>
                                
                                <h3>📊 Основные типы данных</h3>
                                <div style="overflow-x: auto; margin: 20px 0;">
                                    <table style="width: 100%; border-collapse: collapse;">
                                        <thead>
                                            <tr style="background: rgba(100, 255, 218, 0.1);">
                                                <th style="padding: 12px; text-align: left;">Тип</th>
                                                <th style="padding: 12px; text-align: left;">Размер</th>
                                                <th style="padding: 12px; text-align: left;">Диапазон</th>
                                                <th style="padding: 12px; text-align: left;">Пример</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr style="background: rgba(17, 34, 64, 0.3);">
                                                <td style="padding: 10px;">int</td>
                                                <td style="padding: 10px;">4 байта</td>
                                                <td style="padding: 10px;">-2³¹ до 2³¹-1</td>
                                                <td style="padding: 10px;">42, -10, 1000</td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 10px;">float</td>
                                                <td style="padding: 10px;">4 байта</td>
                                                <td style="padding: 10px;">~6-7 цифр</td>
                                                <td style="padding: 10px;">3.14f, 2.5f</td>
                                            </tr>
                                            <tr style="background: rgba(17, 34, 64, 0.3);">
                                                <td style="padding: 10px;">double</td>
                                                <td style="padding: 10px;">8 байт</td>
                                                <td style="padding: 10px;">~15-16 цифр</td>
                                                <td style="padding: 10px;">3.14159, 2.71828</td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 10px;">char</td>
                                                <td style="padding: 10px;">1 байт</td>
                                                <td style="padding: 10px;">-128 до 127</td>
                                                <td style="padding: 10px;">'A', '5', '$'</td>
                                            </tr>
                                            <tr style="background: rgba(17, 34, 64, 0.3);">
                                                <td style="padding: 10px;">bool</td>
                                                <td style="padding: 10px;">1 байт</td>
                                                <td style="padding: 10px;">true/false</td>
                                                <td style="padding: 10px;">true, false</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div class="interactive-block">
                                    <div class="interactive-header">
                                        <div class="interactive-icon">
                                            <i class="fas fa-flask"></i>
                                        </div>
                                        <h4>Практическое задание</h4>
                                    </div>
                                    <p>Создайте программу, которая объявляет переменные разных типов и выводит их значения.</p>
                                    
                                    <div class="code-example" style="margin: 15px 0;">
                                        <div class="code-header">
                                            <div class="code-title">
                                                <i class="fas fa-tasks"></i>
                                                <span>Задание</span>
                                            </div>
                                        </div>
                                        <div class="code-body">Задачи:
1. Объявите переменную типа int со значением 100
2. Объявите переменную типа double со значением 3.14159
3. Объявите строку с вашим именем
4. Выведите все переменные на экран
5. Выполните простое вычисление (умножение, деление)</div>
                                    </div>
                                    
                                    <button class="btn btn-primary" onclick="startPracticeLab('variables')">
                                        <i class="fas fa-play"></i> Начать выполнение
                                    </button>
                                </div>
                                
                                <h3>🎯 Ключевые моменты</h3>
                                <ul>
                                    <li>Все переменные должны быть объявлены перед использованием</li>
                                    <li>C++ — язык со статической типизацией (тип переменной определяется при компиляции)</li>
                                    <li>Используйте <code>const</code> для значений, которые не должны меняться</li>
                                    <li><code>auto</code> позволяет компилятору самому определить тип (C++11)</li>
                                    <li>Имена переменных должны быть описательными и начинаться с буквы</li>
                                </ul>
                            `
                        },
                        {
                            id: "operators",
                            title: "Операторы",
                            type: "theory",
                            duration: 25,
                            difficulty: "beginner",
                            points: 200,
                            completed: false,
                            tags: ["операторы", "базовый", "математика"]
                        },
                        {
                            id: "lab1",
                            title: "Лабораторная: Калькулятор",
                            type: "lab",
                            duration: 30,
                            difficulty: "beginner",
                            points: 300,
                            completed: true,
                            tags: ["лабораторная", "калькулятор", "практика"]
                        },
                        {
                            id: "test1",
                            title: "Тест: Основы C++",
                            type: "test",
                            duration: 20,
                            difficulty: "beginner",
                            points: 250,
                            completed: false,
                            tags: ["тест", "проверка", "базовый"]
                        }
                    ]
                },
                {
                    id: "oop",
                    name: "ООП",
                    icon: "fa-cube",
                    color: "gradient-green",
                    totalPoints: 1500,
                    topics: [
                        {
                            id: "classes",
                            title: "Классы и объекты",
                            type: "theory",
                            duration: 35,
                            difficulty: "intermediate",
                            points: 400,
                            completed: false,
                            tags: ["ООП", "классы", "объекты"]
                        },
                        {
                            id: "lab2",
                            title: "Лабораторная: Банковская система",
                            type: "lab",
                            duration: 45,
                            difficulty: "intermediate",
                            points: 600,
                            completed: false,
                            tags: ["лабораторная", "ООП", "проект"]
                        }
                    ]
                },
                {
                    id: "algorithms",
                    name: "Алгоритмы",
                    icon: "fa-sort-amount-up",
                    color: "gradient-orange",
                    totalPoints: 2000,
                    topics: [
                        {
                            id: "sorting",
                            title: "Алгоритмы сортировки",
                            type: "theory",
                            duration: 40,
                            difficulty: "advanced",
                            points: 800,
                            completed: false,
                            tags: ["алгоритмы", "сортировка", "продвинутый"]
                        }
                    ]
                }
            ]
        };

        // ================ ДАННЫЕ ЛАБОРАТОРНЫХ ================
        const LABS_DATA = [
            {
                id: "lab1",
                title: "Первый калькулятор",
                description: "Создайте простой калькулятор для основных арифметических операций",
                difficulty: "beginner",
                duration: 30,
                points: 300,
                status: "completed",
                tags: ["калькулятор", "арифметика", "базовый"],
                objectives: [
                    "Реализовать сложение двух чисел",
                    "Добавить вычитание, умножение и деление",
                    "Обработать деление на ноль",
                    "Добавить выбор операции через меню"
                ],
                hints: [
                    "Используйте switch для выбора операции",
                    "Для вывода меню используйте cout",
                    "Не забудьте про обработку ошибок"
                ],
                starterCode: `#include <iostream>
using namespace std;

int main() {
    double num1, num2;
    char operation;
    
    cout << "=== ПРОСТОЙ КАЛЬКУЛЯТОР ===" << endl;
    cout << "Введите первое число: ";
    cin >> num1;
    cout << "Введите операцию (+, -, *, /): ";
    cin >> operation;
    cout << "Введите второе число: ";
    cin >> num2;
    
    // Ваш код здесь
    
    return 0;
}`,
                solution: `#include <iostream>
#include <iomanip>
using namespace std;

int main() {
    double num1, num2;
    char operation;
    double result;
    
    cout << "=== ПРОСТОЙ КАЛЬКУЛЯТОР ===" << endl;
    cout << "Введите первое число: ";
    cin >> num1;
    cout << "Введите операцию (+, -, *, /): ";
    cin >> operation;
    cout << "Введите второе число: ";
    cin >> num2;
    
    bool error = false;
    
    switch(operation) {
        case '+':
            result = num1 + num2;
            break;
        case '-':
            result = num1 - num2;
            break;
        case '*':
            result = num1 * num2;
            break;
        case '/':
            if (num2 != 0) {
                result = num1 / num2;
            } else {
                cout << "ОШИБКА: Деление на ноль!" << endl;
                error = true;
            }
            break;
        default:
            cout << "ОШИБКА: Неизвестная операция!" << endl;
            error = true;
    }
    
    if (!error) {
        cout << fixed << setprecision(2);
        cout << "Результат: " << num1 << " " << operation << " " << num2 << " = " << result << endl;
    }
    
    return 0;
}`
            },
            {
                id: "lab2",
                title: "Работа с массивами",
                description: "Создайте программу для анализа данных в массиве",
                difficulty: "intermediate",
                duration: 45,
                points: 500,
                status: "in-progress",
                tags: ["массивы", "анализ", "алгоритмы"],
                objectives: [
                    "Заполнить массив случайными числами",
                    "Найти максимальный и минимальный элементы",
                    "Вычислить среднее значение",
                    "Отсортировать массив"
                ],
                starterCode: `#include <iostream>
#include <cstdlib>
#include <ctime>
using namespace std;

int main() {
    const int SIZE = 10;
    int arr[SIZE];
    
    srand(time(0));
    
    // Заполнение массива случайными числами
    for(int i = 0; i < SIZE; i++) {
        arr[i] = rand() % 100 + 1;
    }
    
    // Ваш код для анализа массива
    
    return 0;
}`
            },
            {
                id: "lab3",
                title: "Банковская система",
                description: "Реализуйте систему управления банковским счетом",
                difficulty: "intermediate",
                duration: 60,
                points: 750,
                status: "locked",
                tags: ["ООП", "система", "проект"],
                objectives: [
                    "Создать класс BankAccount",
                    "Реализовать операции пополнения и снятия",
                    "Добавить начисление процентов",
                    "Создать систему истории операций"
                ]
            },
            {
                id: "lab4",
                title: "Игра 'Угадай число'",
                description: "Разработайте интерактивную игру с компьютером",
                difficulty: "beginner",
                duration: 35,
                points: 350,
                status: "completed",
                tags: ["игра", "интерактив", "базовый"]
            },
            {
                id: "lab5",
                title: "Симулятор файловой системы",
                description: "Создайте упрощенную файловую систему",
                difficulty: "advanced",
                duration: 90,
                points: 1000,
                status: "locked",
                tags: ["файлы", "система", "продвинутый"]
            }
        ];

        // ================ ДАННЫЕ ТЕСТОВ ================
        const TESTS_DATA = [
            {
                id: "test1",        
                title: "Основы C++",
                description: "Проверка знаний базовых концепций языка",
                difficulty: "beginner",
                timeLimit: 600, //10 минут
                questions: [
                    {
                        id: "q1",
                        question: "Какой заголовочный файл используется для ввода-вывода в C++?",
                        options: ["<iostream>", "<stdio.h>", "<input>", "<stream>"],
                        correct: 0,
                        explanation: "В C++ используется <iostream> для операций ввода-вывода"
                    },
                    {
                        id: "q2",
                        question: "Какой оператор используется для вывода в консоль?",
                        options: ["cout", "print", "printf", "echo"],
                        correct: 0,
                        explanation: "cout — стандартный оператор вывода в C++"
                    },
                    {
                        id: "q3",
                        question: "Как объявить константу в C++?",
                        options: ["const int MAX = 100;", "#define MAX 100", "final int MAX = 100;", "Все варианты верны"],
                        correct: 3,
                        explanation: "Все варианты могут использоваться для создания констант"
                    },
                    {
                        id: "q4",
                        question: "Какой тип данных занимает 1 байт?",
                        options: ["char", "int", "float", "double"],
                        correct: 0,
                        explanation: "char занимает 1 байт (8 бит)"
                    },
                    {
                        id: "q5",
                        question: "Что выведет программа: cout << 5 / 2; ?",
                        options: ["2", "2.5", "2.0", "Ошибка"],
                        correct: 0,
                        explanation: "При делении целых чисел дробная часть отбрасывается"
                    }
                ]
            },
            {
                id: "test2",
                title: "Управление потоком",
                description: "Условные операторы и циклы",
                difficulty: "beginner",
                questions: [
                    {
                        id: "q1",
                        question: "Какой оператор используется для условного выполнения?",
                        options: ["if", "switch", "for", "Все варианты"],
                        correct: 0,
                        explanation: "if — основной оператор условного выполнения"
                    }
                ]
            }
        ];

        // ================ ДОСТИЖЕНИЯ ================
        const ACHIEVEMENTS_DATA = [
            {
                id: "first_steps",
                name: "Первые шаги",
                description: "Завершить первую тему",
                icon: "🚀",
                xp: 50,
                unlocked: true,
                type: "progress"
            },
            {
                id: "code_writer",
                name: "Писатель кода",
                description: "Написать 100 строк кода",
                icon: "✍️",
                xp: 100,
                unlocked: true,
                type: "skill"
            },
            {
                id: "lab_master",
                name: "Мастер лабораторных",
                description: "Завершить 5 лабораторных",
                icon: "🔬",
                xp: 150,
                unlocked: false,
                type: "progress"
            },
            {
                id: "theory_expert",
                name: "Эксперт теории",
                description: "Изучить 10 тем",
                icon: "📚",
                xp: 200,
                unlocked: false,
                type: "progress"
            },
            {
                id: "test_champion",
                name: "Чемпион тестов",
                description: "Пройди тест на 100%",
                icon: "🏆",
                xp: 250,
                unlocked: false,
                type: "skill"
            },
            {
                id: "streak_7",
                name: "Неделя обучения",
                description: "Заниматься 7 дней подряд",
                icon: "🔥",
                xp: 300,
                unlocked: false,
                type: "time"
            },
            {
                id: "memory_guru",
                name: "Гуру памяти",
                description: "Использовать все типы памяти",
                icon: "🧠",
                xp: 350,
                unlocked: false,
                type: "skill"
            },
            {
                id: "project_builder",
                name: "Строитель проектов",
                description: "Создать 3 проекта",
                icon: "🏗️",
                xp: 500,
                unlocked: false,
                type: "progress"
            },
            {
                id: "bug_hunter",
                name: "Охотник за багами",
                description: "Найти и исправить 10 ошибок",
                icon: "🐛",
                xp: 400,
                unlocked: false,
                type: "skill"
            },
            {
                id: "speed_racer",
                name: "Гонщик кода",
                description: "Набрать 100 символов в минуту",
                icon: "🏎️",
                xp: 300,
                unlocked: false,
                type: "skill"
            },
            {
                id: "cpp_master",
                name: "Мастер C++",
                description: "Достигнуть 10 уровня",
                icon: "👑",
                xp: 1000,
                unlocked: false,
                type: "progress"
            },
            {
                id: "perfect_week",
                name: "Идеальная неделя",
                description: "Заниматься каждый день недели",
                icon: "⭐",
                xp: 400,
                unlocked: false,
                type: "time"
            }
        ];

        // ================ ИГРЫ ================
        const GAMES_DATA = [
            {
                id: "memory_game",
                title: "Мемори: Угадай оператор",
                description: "Тренируйте память и изучайте операторы C++",
                icon: "🎮",
                type: "memory",
                difficulty: "beginner",
                unlocked: true,
                highScore: 0
            },
            {
                id: "code_racer",
                title: "Гонки кода",
                description: "Соревнуйтесь в скорости набора кода",
                icon: "🏎️",
                type: "typing",
                difficulty: "intermediate",
                unlocked: false,
                highScore: 0
            },
            {
                id: "bug_fix",
                title: "Исправь баг",
                description: "Найдите и исправьте ошибки в коде",
                icon: "🔧",
                type: "puzzle",
                difficulty: "advanced",
                unlocked: false,
                highScore: 0
            },
            {
                id: "memory_simulator",
                title: "Симулятор памяти",
                description: "Управляйте памятью в программе",
                icon: "🧠",
                type: "simulation",
                difficulty: "advanced",
                unlocked: false,
                highScore: 0
            }
        ];

        // ================ ПРОЕКТЫ ================
        const PROJECTS_DATA = [
            {
                id: "project1",
                title: "Консольный планировщик",
                description: "Приложение для управления задачами",
                difficulty: "beginner",
                status: "planned",
                technologies: ["C++", "Файлы", "STL"],
                points: 500,
                progress: 0
            },
            {
                id: "project2",
                title: "Калькулятор выражений",
                description: "Вычисление математических выражений",
                difficulty: "intermediate",
                status: "in-progress",
                technologies: ["C++", "Алгоритмы", "ООП"],
                points: 750,
                progress: 40
            },
            {
                id: "project3",
                title: "Простая игра на SFML",
                description: "2D игра с графикой",
                difficulty: "advanced",
                status: "planned",
                technologies: ["C++", "SFML", "Геймдев"],
                points: 1000,
                progress: 0
            }
        ];

        // ================ ТАБЛИЦА ЛИДЕРОВ ================
        const LEADERBOARD_DATA = [
            {
                id: 1,
                name: "Алексей",
                level: 5,
                xp: 245,
                topics: 8,
                labs: 5,
                streak: 7,
                avatar: "A"
            },
            {
                id: 2,
                name: "Мария",
                level: 8,
                xp: 890,
                topics: 15,
                labs: 12,
                streak: 14,
                avatar: "M"
            },
            {
                id: 3,
                name: "Иван",
                level: 6,
                xp: 420,
                topics: 10,
                labs: 8,
                streak: 3,
                avatar: "И"
            },
            {
                id: 4,
                name: "Дмитрий",
                level: 12,
                xp: 2150,
                topics: 25,
                labs: 20,
                streak: 21,
                avatar: "Д"
            },
            {
                id: 5,
                name: "Екатерина",
                level: 4,
                xp: 180,
                topics: 6,
                labs: 4,
                streak: 5,
                avatar: "Е"
            },
            {
                id: 6,
                name: "Сергей",
                level: 9,
                xp: 1100,
                topics: 18,
                labs: 15,
                streak: 9,
                avatar: "С"
            },
            {
                id: 7,
                name: "Анна",
                level: 7,
                xp: 650,
                topics: 12,
                labs: 9,
                streak: 12,
                avatar: "А"
            },
            {
                id: 8,
                name: "Максим",
                level: 3,
                xp: 120,
                topics: 4,
                labs: 3,
                streak: 2,
                avatar: "М"
            },
            {
                id: 9,
                name: "Ольга",
                level: 10,
                xp: 1450,
                topics: 22,
                labs: 18,
                streak: 18,
                avatar: "О"
            },
            {
                id: 10,
                name: "Павел",
                level: 11,
                xp: 1800,
                topics: 24,
                labs: 22,
                streak: 25,
                avatar: "П"
            }
        ];

        // ================ СОСТОЯНИЕ ПРИЛОЖЕНИЯ ================
        let appState = {
            version: "3.0.0",
            user: {
                id: 1,
                name: "Алексей",
                nickname: "coder_alex",
                email: "alex@example.com",
                phone: "",
                startDate: new Date().toISOString(),
                level: 5,
                xp: 245,
                maxXp: 500,
                rank: "Знаток",
                streak: 7,
                completedTopics: ["intro", "variables", "lab1", "lab4"],
                completedLabs: 2,
                completedTests: 0,
                codeLines: 1247,
                achievements: ["first_steps", "code_writer"],
                activity: [],
                dailyGoals: {
                    lastCompleted: null,
                    streak: 0,
                    today: {
                        topics: 0,
                        labs: 0,
                        code: 0,
                        tests: 0
                    }
                },
                settings: {
                    theme: "dark",
                    language: "ru",
                    animations: true,
                    compactMode: false,
                    editor: {
                        fontSize: 14,
                        autocomplete: true,
                        autosave: true,
                        syntaxHighlighting: true,
                        tabSize: 4
                    },
                    notifications: true,
                    autoSaveData: true,
                    backups: true
                },
                avatar: {
                    current: null,
                    history: [],
                    customizations: []
                },
                certificates: [],
                games: {
                    highScores: {},
                    unlocked: ["memory_game"]
                }
            },
            current: {
                section: "theory",
                module: "basics",
                topic: "intro",
                test: null,
                lab: null,
                file: "main.cpp",
                editor: {
                    files: {
                        "main.cpp": `#include <iostream>
#include <vector>
#include <string>
#include <algorithm>

using namespace std;

// ====== ДЕМОНСТРАЦИОННАЯ ПРОГРАММА ======
// C++ Visual Lab - Практическая площадка

// Структура для хранения данных студента
struct Student {
    string name;
    int age;
    double grade;
    
    // Конструктор
    Student(string n, int a, double g) : name(n), age(a), grade(g) {}
    
    // Метод для вывода информации
    void display() const {
        cout << "Имя: " << name << endl;
        cout << "Возраст: " << age << endl;
        cout << "Оценка: " << grade << endl;
        cout << "-------------------" << endl;
    }
};

// Функция для вычисления среднего значения
double calculateAverage(const vector<double>& grades) {
    if (grades.empty()) return 0.0;
    
    double sum = 0;
    for (double grade : grades) {
        sum += grade;
    }
    return sum / grades.size();
}

// Функция для поиска максимальной оценки
double findMaxGrade(const vector<double>& grades) {
    if (grades.empty()) return 0.0;
    
    double maxGrade = grades[0];
    for (double grade : grades) {
        if (grade > maxGrade) {
            maxGrade = grade;
        }
    }
    return maxGrade;
}

int main() {
    cout << "=== ДЕМОНСТРАЦИЯ ВОЗМОЖНОСТЕЙ C++ ===" << endl;
    cout << "C++ Visual Lab - Образовательная платформа" << endl << endl;
    
    // Демонстрация работы с переменными
    cout << "1. РАБОТА С ПЕРЕМЕННЫМИ:" << endl;
    int number = 42;
    double pi = 3.1415926535;
    string message = "Hello, C++ Developer!";
    bool isActive = true;
    
    cout << "Целое число: " << number << endl;
    cout << "Число Пи: " << pi << endl;
    cout << "Сообщение: " << message << endl;
    cout << "Статус: " << (isActive ? "Активен" : "Неактивен") << endl << endl;
    
    // Демонстрация работы с массивами
    cout << "2. РАБОТА С МАССИВАМИ:" << endl;
    const int ARRAY_SIZE = 5;
    int numbers[ARRAY_SIZE] = {10, 20, 30, 40, 50};
    
    cout << "Элементы массива: ";
    for (int i = 0; i < ARRAY_SIZE; i++) {
        cout << numbers[i] << " ";
    }
    cout << endl << endl;
    
    // Демонстрация работы с векторами
    cout << "3. РАБОТА С ВЕКТОРАМИ (STL):" << endl;
    vector<double> grades = {4.5, 3.8, 4.2, 5.0, 4.7};
    
    cout << "Оценки студентов: ";
    for (double grade : grades) {
        cout << grade << " ";
    }
    cout << endl;
    
    cout << "Средняя оценка: " << calculateAverage(grades) << endl;
    cout << "Максимальная оценка: " << findMaxGrade(grades) << endl << endl;
    
    // Демонстрация работы с объектами
    cout << "4. ОБЪЕКТНО-ОРИЕНТИРОВАННОЕ ПРОГРАММИРОВАНИЕ:" << endl;
    
    vector<Student> students;
    students.push_back(Student("Алексей", 20, 4.5));
    students.push_back(Student("Мария", 21, 4.8));
    students.push_back(Student("Иван", 22, 4.2));
    
    cout << "Список студентов:" << endl;
    for (const Student& student : students) {
        student.display();
    }
    
    // Демонстрация работы с алгоритмами STL
    cout << "5. АЛГОРИТМЫ STL:" << endl;
    
    vector<int> data = {5, 2, 8, 1, 9, 3, 7, 4, 6};
    
    cout << "Исходный массив: ";
    for (int num : data) {
        cout << num << " ";
    }
    cout << endl;
    
    sort(data.begin(), data.end());
    
    cout << "Отсортированный массив: ";
    for (int num : data) {
        cout << num << " ";
    }
    cout << endl;
    
    auto maxElement = max_element(data.begin(), data.end());
    auto minElement = min_element(data.begin(), data.end());
    
    cout << "Максимальный элемент: " << *maxElement << endl;
    cout << "Минимальный элемент: " << *minElement << endl << endl;
    
    cout << "=== ПРОГРАММА ЗАВЕРШЕНА УСПЕШНО ===" << endl;
    cout << "Всего строк кода: " << __LINE__ << endl;
    
    return 0;
}`,
                        "functions.cpp": `#include <iostream>
#include <cmath>

using namespace std;

// ====== БИБЛИОТЕКА ПОЛЕЗНЫХ ФУНКЦИЙ ======

// Функция для вычисления факториала
unsigned long long factorial(int n) {
    if (n < 0) return 0;
    if (n <= 1) return 1;
    
    unsigned long long result = 1;
    for (int i = 2; i <= n; i++) {
        result *= i;
    }
    return result;
}

// Функция для проверки простого числа
bool isPrime(int number) {
    if (number <= 1) return false;
    if (number <= 3) return true;
    if (number % 2 == 0 || number % 3 == 0) return false;
    
    for (int i = 5; i * i <= number; i += 6) {
        if (number % i == 0 || number % (i + 2) == 0) {
            return false;
        }
    }
    return true;
}

// Функция для вычисления НОД (алгоритм Евклида)
int gcd(int a, int b) {
    while (b != 0) {
        int temp = b;
        b = a % b;
        a = temp;
    }
    return a;
}

// Функция для вычисления чисел Фибоначчи
int fibonacci(int n) {
    if (n <= 0) return 0;
    if (n == 1) return 1;
    
    int a = 0, b = 1;
    for (int i = 2; i <= n; i++) {
        int temp = a + b;
        a = b;
        b = temp;
    }
    return b;
}

// Функция для вычисления степени числа
double power(double base, int exponent) {
    if (exponent == 0) return 1;
    if (exponent < 0) return 1 / power(base, -exponent);
    
    double result = 1;
    for (int i = 0; i < exponent; i++) {
        result *= base;
    }
    return result;
}

// Функция для вычисления корня n-й степени
double nthRoot(double number, int n) {
    if (n == 0) return 0;
    if (number < 0 && n % 2 == 0) return NAN; // Корень четной степени из отрицательного числа
    
    double x0 = number / n;
    double x1;
    
    for (int i = 0; i < 100; i++) {
        x1 = ((n - 1) * x0 + number / power(x0, n - 1)) / n;
        if (abs(x1 - x0) < 1e-10) break;
        x0 = x1;
    }
    
    return x1;
}

// Функция для проверки числа на палиндром
bool isPalindrome(int number) {
    if (number < 0) return false;
    
    int original = number;
    int reversed = 0;
    
    while (number > 0) {
        reversed = reversed * 10 + number % 10;
        number /= 10;
    }
    
    return original == reversed;
}

// Демонстрационная функция
void demonstrateFunctions() {
    cout << "=== ДЕМОНСТРАЦИЯ РАБОТЫ ФУНКЦИЙ ===" << endl;
    
    cout << "Факториал 5: " << factorial(5) << endl;
    cout << "Число 17 простое? " << (isPrime(17) ? "Да" : "Нет") << endl;
    cout << "НОД(48, 18): " << gcd(48, 18) << endl;
    cout << "10-е число Фибоначчи: " << fibonacci(10) << endl;
    cout << "2^10: " << power(2, 10) << endl;
    cout << "Корень 3-й степени из 27: " << nthRoot(27, 3) << endl;
    cout << "Число 12321 палиндром? " << (isPalindrome(12321) ? "Да" : "Нет") << endl;
}

int main() {
    demonstrateFunctions();
    return 0;
}`,
                        "algorithms.cpp": `#include <iostream>
#include <vector>
#include <algorithm>
#include <chrono>

using namespace std;
using namespace chrono;

// ====== РЕАЛИЗАЦИЯ АЛГОРИТМОВ СОРТИРОВКИ ======

// Пузырьковая сортировка
void bubbleSort(vector<int>& arr) {
    int n = arr.size();
    for (int i = 0; i < n - 1; i++) {
        for (int j = 0; j < n - i - 1; j++) {
            if (arr[j] > arr[j + 1]) {
                swap(arr[j], arr[j + 1]);
            }
        }
    }
}

// Сортировка выбором
void selectionSort(vector<int>& arr) {
    int n = arr.size();
    for (int i = 0; i < n - 1; i++) {
        int minIdx = i;
        for (int j = i + 1; j < n; j++) {
            if (arr[j] < arr[minIdx]) {
                minIdx = j;
            }
        }
        swap(arr[i], arr[minIdx]);
    }
}

// Сортировка вставками
void insertionSort(vector<int>& arr) {
    int n = arr.size();
    for (int i = 1; i < n; i++) {
        int key = arr[i];
        int j = i - 1;
        
        while (j >= 0 && arr[j] > key) {
            arr[j + 1] = arr[j];
            j--;
        }
        arr[j + 1] = key;
    }
}

// Быстрая сортировка (Quick Sort)
int partition(vector<int>& arr, int low, int high) {
    int pivot = arr[high];
    int i = low - 1;
    
    for (int j = low; j < high; j++) {
        if (arr[j] <= pivot) {
            i++;
            swap(arr[i], arr[j]);
        }
    }
    swap(arr[i + 1], arr[high]);
    return i + 1;
}

void quickSort(vector<int>& arr, int low, int high) {
    if (low < high) {
        int pi = partition(arr, low, high);
        quickSort(arr, low, pi - 1);
        quickSort(arr, pi + 1, high);
    }
}

void quickSort(vector<int>& arr) {
    quickSort(arr, 0, arr.size() - 1);
}

// Функция для генерации случайного массива
vector<int> generateRandomArray(int size, int minVal = 1, int maxVal = 1000) {
    vector<int> arr(size);
    srand(time(0));
    
    for (int i = 0; i < size; i++) {
        arr[i] = minVal + rand() % (maxVal - minVal + 1);
    }
    return arr;
}

// Функция для измерения времени выполнения
template<typename Func>
long long measureTime(Func sortFunction, vector<int> arr) {
    auto start = high_resolution_clock::now();
    sortFunction(arr);
    auto stop = high_resolution_clock::now();
    return duration_cast<microseconds>(stop - start).count();
}

// Демонстрация работы алгоритмов
void demonstrateAlgorithms() {
    cout << "=== СРАВНЕНИЕ АЛГОРИТМОВ СОРТИРОВКИ ===" << endl;
    
    vector<int> sizes = {100, 1000, 5000};
    
    for (int size : sizes) {
        cout << endl << "Размер массива: " << size << " элементов" << endl;
        cout << "-----------------------------------" << endl;
        
        vector<int> original = generateRandomArray(size);
        
        // Пузырьковая сортировка
        vector<int> arr1 = original;
        long long time1 = measureTime(bubbleSort, arr1);
        cout << "Пузырьковая сортировка: " << time1 << " мкс" << endl;
        
        // Сортировка выбором
        vector<int> arr2 = original;
        long long time2 = measureTime(selectionSort, arr2);
        cout << "Сортировка выбором: " << time2 << " мкс" << endl;
        
        // Сортировка вставками
        vector<int> arr3 = original;
        long long time3 = measureTime(insertionSort, arr3);
        cout << "Сортировка вставками: " << time3 << " мкс" << endl;
        
        // Быстрая сортировка
        vector<int> arr4 = original;
        long long time4 = measureTime(quickSort, arr4);
        cout << "Быстрая сортировка: " << time4 << " мкс" << endl;
        
        // Стандартная сортировка STL
        vector<int> arr5 = original;
        long long time5 = measureTime([](vector<int>& arr) {
            sort(arr.begin(), arr.end());
        }, arr5);
        cout << "STL sort(): " << time5 << " мкс" << endl;
    }
    
    cout << endl << "=== АНАЛИЗ РЕЗУЛЬТАТОВ ===" << endl;
    cout << "Быстрая сортировка и STL sort() показывают лучшую производительность" << endl;
    cout << "на больших объемах данных благодаря сложности O(n log n)" << endl;
}

int main() {
    demonstrateAlgorithms();
    return 0;
}`,
                        "headers/utils.h": `#ifndef UTILS_H
#define UTILS_H

#include <string>
#include <vector>

namespace utils {
    
    // Функция для форматирования строки
    std::string formatString(const std::string& str, const std::vector<std::string>& args);
    
    // Функция для проверки валидности email
    bool isValidEmail(const std::string& email);
    
    // Функция для генерации случайного числа в диапазоне
    int randomInt(int min, int max);
    
    // Функция для вычисления факториала
    long long factorial(int n);
    
    // Функция для проверки на палиндром
    bool isPalindrome(const std::string& str);
    
} // namespace utils

#endif // UTILS_H`
                    },
                    folders: {
                        "headers": ["utils.h"]
                    }
                }
            },
            memory: {
                cells: [],
                step: 0,
                variables: []
            },
            progress: {
                basics: { completed: 650, total: 1000, percentage: 65 },
                oop: { completed: 300, total: 1500, percentage: 20 },
                algorithms: { completed: 0, total: 2000, percentage: 0 }
            },
            projects: {
                active: "project2",
                templates: [
                    {
                        id: "console_app",
                        name: "Консольное приложение",
                        files: {
                            "main.cpp": `#include <iostream>
#include <string>

using namespace std;

int main() {
    cout << "Добро пожаловать в консольное приложение!" << endl;
    cout << "Это шаблон для создания ваших проектов." << endl;
    return 0;
}`
                        }
                    },
                    {
                        id: "sfml_game",
                        name: "Игра на SFML",
                        files: {
                            "main.cpp": `#include <SFML/Graphics.hpp>

int main() {
    sf::RenderWindow window(sf::VideoMode(800, 600), "SFML Game");
    
    while (window.isOpen()) {
        sf::Event event;
        while (window.pollEvent(event)) {
            if (event.type == sf::Event::Closed)
                window.close();
        }
        
        window.clear();
        window.display();
    }
    
    return 0;
}`
                        }
                    }
                ]
            },
            backups: [],
            searchIndex: []
        };

        // ================ ГЛОБАЛЬНЫЕ ПЕРЕМЕННЫЕ ================
        let codeEditor;
        let currentTest = null;
        let testAnswers = {};
        let testTimer = null;
        let testTimeLeft = 0;
        let avatarEditor = null;
        let avatarCanvas = null;
        let autoSaveInterval = null;
        let backupInterval = null;
        let searchResults = [];

        // ================ ИНИЦИАЛИЗАЦИЯ ================
        document.addEventListener('DOMContentLoaded', function() {
            initLoader();
            initApp();
            
            setTimeout(() => {
                showNotification("🎉 Добро пожаловать в C++ Visual Lab!", "success");
                logActivity("Пользователь вошел в систему");
                checkDailyGoals();
            }, 1000);
        });

        // ================ ЛОАДЕР ================
        function initLoader() {
            const loader = document.getElementById('loader');
            const progressBar = document.getElementById('loaderProgress');
            const statusText = document.getElementById('loaderStatus');
            
            const steps = [
                "Загрузка ядра системы...",
                "Инициализация редактора кода...",
                "Загрузка учебных материалов...",
                "Подготовка симулятора памяти...",
                "Настройка игрового движка...",
                "Проверка профиля пользователя...",
                "Запуск образовательной платформы..."
            ];
            
            let currentStep = 0;
            let progress = 0;
            
            const interval = setInterval(() => {
                progress += 2 + Math.random() * 3;
                
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                    
                    setTimeout(() => {
                        loader.style.opacity = '0';
                        setTimeout(() => {
                            loader.style.display = 'none';
                        }, 500);
                    }, 500);
                }
                
                progressBar.style.width = `${progress}%`;
                
                // Обновляем статус каждые 15%
                if (progress >= (currentStep + 1) * (100 / steps.length)) {
                    if (currentStep < steps.length) {
                        statusText.textContent = steps[currentStep];
                        currentStep++;
                    }
                }
            }, 50);
        }

        // ================ ИНИЦИАЛИЗАЦИЯ ПРИЛОЖЕНИЯ ================
        function initApp() {
            loadUserState();
            initProgressMap();
            initNavigation();
            initCodeEditor();
            initMemorySimulator();
            initModules();
            initLabs();
            initAchievements();
            initActivity();
            initSearchIndex();
            initAvatar();
            updateUI();
            initHotkeys();
            initAutoSave();
            
            // Применяем тему
            applyTheme(appState.user.settings.theme);
            
            // Показываем контент по умолчанию
            loadTopic(appState.current.module, appState.current.topic);
        }

        // ================ ИНИЦИАЛИЗАЦИЯ ПОИСКОВОГО ИНДЕКСА ================
        function initSearchIndex() {
            appState.searchIndex = [];
            
            // Индексируем темы
            COURSE_STRUCTURE.modules.forEach(module => {
                module.topics.forEach(topic => {
                    appState.searchIndex.push({
                        id: topic.id,
                        type: topic.type === 'theory' ? 'theory' : topic.type === 'lab' ? 'lab' : 'test',
                        title: topic.title,
                        content: topic.content || '',
                        module: module.name,
                        difficulty: topic.difficulty,
                        url: `#${module.id}/${topic.id}`
                    });
                });
            });
            
            // Индексируем лабораторные
            LABS_DATA.forEach(lab => {
                appState.searchIndex.push({
                    id: lab.id,
                    type: 'lab',
                    title: lab.title,
                    content: lab.description + ' ' + (lab.objectives ? lab.objectives.join(' ') : ''),
                    difficulty: lab.difficulty,
                    url: `#lab/${lab.id}`
                });
            });
            
            // Индексируем тесты
            TESTS_DATA.forEach(test => {
                appState.searchIndex.push({
                    id: test.id,
                    type: 'test',
                    title: test.title,
                    content: test.description,
                    difficulty: test.difficulty,
                    url: `#test/${test.id}`
                });
            });
        }

        // ================ КАРТА ПРОГРЕССА ================
        function initProgressMap() {
            const map = document.getElementById('progressMap');
            map.innerHTML = '';
            
            const nodes = [
                { id: "basics", name: "Основы", icon: "🏁", completed: true, current: true, progress: 65 },
                { id: "control", name: "Управление", icon: "🔄", completed: false, current: false, progress: 0 },
                { id: "functions", name: "Функции", icon: "⚙️", completed: false, current: false, progress: 0 },
                { id: "arrays", name: "Массивы", icon: "📊", completed: false, current: false, progress: 0 },
                { id: "pointers", name: "Указатели", icon: "📍", completed: false, current: false, progress: 0 },
                { id: "oop", name: "ООП", icon: "🏗️", completed: false, current: false, progress: 0 },
                { id: "stl", name: "STL", icon: "📚", completed: false, current: false, progress: 0 },
                { id: "projects", name: "Проекты", icon: "🚀", completed: false, current: false, progress: 0 }
            ];
            
            nodes.forEach((node, index) => {
                const nodeEl = document.createElement('div');
                nodeEl.className = `map-node ${node.completed ? 'completed' : ''} ${node.current ? 'current' : ''} ${index > 1 ? 'locked' : ''}`;
                nodeEl.onclick = () => {
                    if (index <= 1) {
                        goToModule(node.id);
                    }
                };
                
                // Создаем превью для узла
                const previewContent = `
                    <div style="padding: 10px;">
                        <div style="font-weight: bold; color: var(--accent-blue); margin-bottom: 5px;">${node.name}</div>
                        <div style="font-size: 11px; color: var(--text-secondary);">
                            ${node.completed ? '✅ Завершено' : '🔒 Заблокировано'}
                        </div>
                        ${node.progress > 0 ? `
                            <div style="margin-top: 8px;">
                                <div style="height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; overflow: hidden;">
                                    <div style="height: 100%; width: ${node.progress}%; background: var(--gradient-green);"></div>
                                </div>
                                <div style="font-size: 10px; text-align: center; margin-top: 3px;">${node.progress}%</div>
                            </div>
                        ` : ''}
                    </div>
                `;
                
                nodeEl.innerHTML = `
                    <div class="node-icon" style="${node.completed ? 'background: rgba(80, 250, 123, 0.1);' : ''}">
                        ${node.icon}
                    </div>
                    <div class="node-label">${node.name}</div>
                    <div class="node-preview">${previewContent}</div>
                    ${node.completed ? `
                        <div class="node-progress">
                            <div class="node-progress-bar" style="width: ${node.progress}%"></div>
                        </div>
                    ` : ''}
                `;
                
                map.appendChild(nodeEl);
                
                // Добавляем соединитель (кроме последнего узла)
                if (index < nodes.length - 1) {
                    const connector = document.createElement('div');
                    connector.className = 'node-connector';
                    map.appendChild(connector);
                }
            });
        }

        function toggleProgressMap() {
            const map = document.getElementById('progressMap');
            const btn = document.getElementById('toggleMapBtn');
            const icon = btn.querySelector('i');
            
            if (map.classList.contains('collapsed')) {
                map.classList.remove('collapsed');
                icon.className = 'fas fa-chevron-up';
            } else {
                map.classList.add('collapsed');
                icon.className = 'fas fa-chevron-down';
            }
        }

        // ================ НАВИГАЦИЯ ================
        function initNavigation() {
            // Обновляем бейджи
            updateBadges();
            
            // Добавляем обработчики событий для навигации
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    const section = this.getAttribute('data-section');
                    switchSection(section);
                });
            });
            
            // Инициализируем хлебные крошки
            updateBreadcrumbs();
        }

        function switchSection(sectionId) {
            // Обновляем активную вкладку в навигации
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-section') === sectionId) {
                    item.classList.add('active');
                }
            });
            
            // Скрываем все секции
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Показываем выбранную секцию
            document.getElementById(`${sectionId}Section`).classList.add('active');
            appState.current.section = sectionId;
            
            // Обновляем хлебные крошки
            updateBreadcrumbs();
            
            // Инициализируем контент секции
            switch(sectionId) {
                case 'theory':
                    loadTopic(appState.current.module, appState.current.topic);
                    break;
                case 'labs':
                    loadLabsGrid();
                    break;
                case 'tests':
                    showTestsList();
                    break;
                case 'practice':
                    focusEditor();
                    break;
                case 'games':
                    loadGames();
                    break;
                case 'projects':
                    loadProjects();
                    break;
            }
            
            saveUserState();
            logActivity(`Переключение на раздел: ${sectionId}`);
        }

        function updateBadges() {
            // Обновляем бейджи с уведомлениями
            const theoryBadge = document.getElementById('theoryBadge');
            const labsBadge = document.getElementById('labsBadge');
            const testsBadge = document.getElementById('testsBadge');
            const gamesBadge = document.getElementById('gamesBadge');
            
            // Примерные значения (можно сделать динамическими)
            theoryBadge.textContent = '3';
            labsBadge.textContent = '5';
            testsBadge.textContent = '2';
            gamesBadge.textContent = '1';
        }

        function updateBreadcrumbs() {
            const breadcrumbs = document.getElementById('breadcrumbs');
            const section = appState.current.section;
            let crumbs = `<a href="#" onclick="switchSection('theory'); return false;">Главная</a> > `;
            
            switch(section) {
                case 'theory':
                    const module = COURSE_STRUCTURE.modules.find(m => m.id === appState.current.module);
                    const topic = module ? module.topics.find(t => t.id === appState.current.topic) : null;
                    crumbs += `<span>Теория</span> > `;
                    if (module) crumbs += `<span>${module.name}</span> > `;
                    if (topic) crumbs += `<span>${topic.title}</span>`;
                    break;
                case 'labs':
                    crumbs += `<span>Лабораторные работы</span>`;
                    break;
                case 'tests':
                    crumbs += `<span>Тестирование</span>`;
                    break;
                case 'practice':
                    crumbs += `<span>Практика программирования</span>`;
                    break;
                case 'games':
                    crumbs += `<span>Игровое обучение</span>`;
                    break;
                case 'projects':
                    crumbs += `<span>Проекты</span>`;
                    break;
            }
            
            breadcrumbs.innerHTML = crumbs;
        }

        // ================ ПОИСК ================
        function performSearch(query) {
            if (!query || query.length < 2) {
                searchResults = [];
                return;
            }
            
            const normalizedQuery = query.toLowerCase();
            searchResults = appState.searchIndex.filter(item => {
                return item.title.toLowerCase().includes(normalizedQuery) ||
                       item.content.toLowerCase().includes(normalizedQuery) ||
                       item.module.toLowerCase().includes(normalizedQuery);
            });
            
            // Показываем результаты поиска
            if (searchResults.length > 0) {
                showSearchResults();
            }
        }

        function showSearchResults() {
            const container = document.getElementById('searchResults');
            if (!container) {
                const searchContainer = document.querySelector('.search-container');
                const resultsDiv = document.createElement('div');
                resultsDiv.id = 'searchResults';
                resultsDiv.style.cssText = `
                    position: absolute;
                    top: 100%;
                    left: 0;
                    right: 0;
                    background: var(--panel-bg);
                    border: 1px solid var(--panel-border);
                    border-radius: 12px;
                    margin-top: 5px;
                    max-height: 400px;
                    overflow-y: auto;
                    z-index: 1000;
                    box-shadow: var(--shadow-heavy);
                `;
                searchContainer.style.position = 'relative';
                searchContainer.appendChild(resultsDiv);
                container = resultsDiv;
            }
            
            container.innerHTML = `
                <div style="padding: 15px; border-bottom: 1px solid var(--panel-border);">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="color: var(--accent-blue); font-weight: 600;">
                            <i class="fas fa-search"></i> Результаты поиска: ${searchResults.length}
                        </div>
                        <button class="btn btn-small btn-outline" onclick="clearSearch()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                ${searchResults.map(result => `
                    <div style="padding: 12px 15px; border-bottom: 1px solid rgba(100, 255, 218, 0.1); 
                         cursor: pointer; transition: background 0.3s ease;"
                         onmouseenter="this.style.background='rgba(100, 255, 218, 0.05)'"
                         onmouseleave="this.style.background='transparent'"
                         onclick="goToSearchResult('${result.id}', '${result.type}')">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                            <div style="width: 24px; height: 24px; border-radius: 6px; 
                                 background: ${result.type === 'theory' ? 'rgba(100, 255, 218, 0.1)' : 
                                            result.type === 'lab' ? 'rgba(80, 250, 123, 0.1)' : 
                                            'rgba(241, 250, 140, 0.1)'};
                                 display: flex; align-items: center; justify-content: center;
                                 color: ${result.type === 'theory' ? 'var(--accent-blue)' : 
                                        result.type === 'lab' ? 'var(--accent-green)' : 
                                        'var(--accent-yellow)'};">
                                <i class="fas ${result.type === 'theory' ? 'fa-book' : 
                                               result.type === 'lab' ? 'fa-flask' : 
                                               'fa-graduation-cap'}"></i>
                            </div>
                            <div style="font-weight: 600; color: var(--text-primary);">${result.title}</div>
                        </div>
                        <div style="font-size: 12px; color: var(--accent-purple); margin-bottom: 5px;">
                            ${result.module || ''} • ${result.difficulty === 'beginner' ? 'Начинающий' : 
                                                      result.difficulty === 'intermediate' ? 'Средний' : 
                                                      'Продвинутый'}
                        </div>
                        <div style="font-size: 12px; color: var(--text-secondary); line-height: 1.4;">
                            ${result.content.substring(0, 100)}...
                        </div>
                    </div>
                `).join('')}
            `;
        }

        function clearSearch() {
            const searchInput = document.getElementById('globalSearch');
            const results = document.getElementById('searchResults');
            
            if (searchInput) searchInput.value = '';
            if (results) results.remove();
            searchResults = [];
        }

        function goToSearchResult(id, type) {
            clearSearch();
            
            switch(type) {
                case 'theory':
                    // Находим тему в структуре курса
                    for (const module of COURSE_STRUCTURE.modules) {
                        const topic = module.topics.find(t => t.id === id);
                        if (topic) {
                            loadTopic(module.id, topic.id);
                            switchSection('theory');
                            return;
                        }
                    }
                    break;
                case 'lab':
                    openLabModal(id);
                    break;
                case 'test':
                    startTest(id);
                    switchSection('tests');
                    break;
            }
        }

        // ================ ФИЛЬТРАЦИЯ ТЕМ ================
        function filterTopics(filterType, value) {
            const allTopics = document.querySelectorAll('.topic-item');
            
            allTopics.forEach(topic => {
                let show = true;
                
                if (filterType === 'difficulty' && value !== 'all') {
                    const difficulty = topic.querySelector('.topic-meta .badge').textContent.toLowerCase();
                    if (difficulty !== value) show = false;
                }
                
                if (filterType === 'status' && value !== 'all') {
                    const isCompleted = topic.classList.contains('completed');
                    const isLocked = topic.style.opacity === '0.5';
                    
                    if (value === 'completed' && !isCompleted) show = false;
                    if (value === 'in-progress' && isCompleted) show = false;
                    if (value === 'locked' && !isLocked) show = false;
                }
                
                topic.style.display = show ? 'flex' : 'none';
            });
        }

        function initTopicTags() {
            const tagsContainer = document.getElementById('topicTags');
            if (!tagsContainer) return;
            
            // Собираем все теги из тем
            const allTags = new Set();
            COURSE_STRUCTURE.modules.forEach(module => {
                module.topics.forEach(topic => {
                    if (topic.tags) {
                        topic.tags.forEach(tag => allTags.add(tag));
                    }
                });
            });
            
            // Создаем теги
            tagsContainer.innerHTML = '';
            Array.from(allTags).forEach(tag => {
                const tagElement = document.createElement('div');
                tagElement.className = 'tag-cloud-item';
                tagElement.textContent = tag;
                tagElement.onclick = () => filterByTag(tag);
                tagsContainer.appendChild(tagElement);
            });
        }

        function filterByTag(tag) {
            const allTopics = document.querySelectorAll('.topic-item');
            const tagElements = document.querySelectorAll('.tag-cloud-item');
            
            // Снимаем активность со всех тегов
            tagElements.forEach(el => el.classList.remove('active'));
            
            // Активируем выбранный тег
            const activeTag = Array.from(tagElements).find(el => el.textContent === tag);
            if (activeTag) activeTag.classList.add('active');
            
            // Фильтруем темы
            allTopics.forEach(topic => {
                const topicTitle = topic.querySelector('.topic-title').textContent.toLowerCase();
                const topicMeta = topic.querySelector('.topic-meta').textContent.toLowerCase();
                const topicText = topicTitle + ' ' + topicMeta;
                
                if (tag === 'all' || topicText.includes(tag)) {
                    topic.style.display = 'flex';
                } else {
                    topic.style.display = 'none';
                }
            });
        }

        // ================ МОДУЛИ И ТЕМЫ ================
        function initModules() {
            initModuleTopics('basics');
            initModuleTopics('oop');
            initModuleTopics('algorithms');
            initTopicTags();
        }

        function initModuleTopics(moduleId) {
            const container = document.getElementById(`${moduleId}Topics`);
            if (!container) return;
            
            const module = COURSE_STRUCTURE.modules.find(m => m.id === moduleId);
            if (!module) return;
            
            container.innerHTML = '';
            
            module.topics.forEach(topic => {
                const topicEl = document.createElement('div');
                topicEl.className = `topic-item ${topic.completed ? 'completed' : ''} ${appState.current.topic === topic.id ? 'active' : ''}`;
                topicEl.onclick = () => {
                    if (moduleId === 'basics' || appState.user.level >= 2) {
                        loadTopic(moduleId, topic.id);
                    } else {
                        showNotification(`Разблокируется на уровне 2`, "warning");
                    }
                };
                
                topicEl.innerHTML = `
                    <div class="topic-checkbox">
                        ${topic.completed ? '<i class="fas fa-check"></i>' : ''}
                    </div>
                    <div class="topic-text">
                        <div class="topic-title">${topic.title}</div>
                        <div class="topic-meta">
                            <span>${topic.duration} мин</span>
                            <span class="badge ${topic.difficulty === 'beginner' ? 'badge-primary' : topic.difficulty === 'intermediate' ? 'badge-warning' : 'badge-danger'}">
                                ${topic.difficulty === 'beginner' ? 'Начинающий' : topic.difficulty === 'intermediate' ? 'Средний' : 'Продвинутый'}
                            </span>
                            ${topic.points ? `<span>${topic.points} баллов</span>` : ''}
                        </div>
                        ${topic.tags ? `
                            <div style="display: flex; gap: 4px; margin-top: 5px; flex-wrap: wrap;">
                                ${topic.tags.map(tag => `<div class="topic-tag">${tag}</div>`).join('')}
                            </div>
                        ` : ''}
                    </div>
                `;
                
                container.appendChild(topicEl);
            });
        }

        function loadTopic(moduleId, topicId) {
            const module = COURSE_STRUCTURE.modules.find(m => m.id === moduleId);
            if (!module) return;
            
            const topic = module.topics.find(t => t.id === topicId);
            if (!topic) return;
            
            appState.current.module = moduleId;
            appState.current.topic = topicId;
            
            // Обновляем UI
            document.getElementById('currentTopicTitle').textContent = topic.title;
            
            if (topic.type === 'theory' && topic.content) {
                document.getElementById('theoryContent').innerHTML = topic.content;
                
                // Добавляем обработчики для интерактивных элементов
                document.querySelectorAll('.btn-outline').forEach(btn => {
                    if (btn.textContent.includes('Копировать')) {
                        const codeId = btn.getAttribute('onclick')?.match(/'([^']+)'/)?.[1];
                        if (codeId) {
                            btn.onclick = () => copyCode(codeId);
                        }
                    }
                });
            }
            
            // Переключаемся на вкладку теории
            switchSection('theory');
            
            // Обновляем модули
            initModuleTopics(moduleId);
            
            // Обновляем хлебные крошки
            updateBreadcrumbs();
            
            // Добавляем в историю
            addToHistory(topic);
            
            saveUserState();
            logActivity(`Изучение темы: ${topic.title}`);
        }

        function addToHistory(topic) {
            const historyItem = {
                id: topic.id,
                title: topic.title,
                module: appState.current.module,
                timestamp: new Date().toISOString()
            };
            
            // Добавляем в начало истории
            appState.user.activity.unshift({
                icon: 'fa-book',
                title: `Изучил тему: ${topic.title}`,
                time: 'Только что'
            });
            
            // Ограничиваем размер истории
            if (appState.user.activity.length > 50) {
                appState.user.activity.pop();
            }
            
            updateActivityList();
        }

        function nextTopic() {
            const module = COURSE_STRUCTURE.modules.find(m => m.id === appState.current.module);
            if (!module) return;
            
            const topics = module.topics;
            const currentIndex = topics.findIndex(t => t.id === appState.current.topic);
            
            if (currentIndex < topics.length - 1) {
                loadTopic(appState.current.module, topics[currentIndex + 1].id);
            } else {
                // Переход к следующему модулю
                const moduleIndex = COURSE_STRUCTURE.modules.findIndex(m => m.id === appState.current.module);
                if (moduleIndex < COURSE_STRUCTURE.modules.length - 1) {
                    const nextModule = COURSE_STRUCTURE.modules[moduleIndex + 1];
                    loadTopic(nextModule.id, nextModule.topics[0].id);
                }
            }
        }

        function prevTopic() {
            const module = COURSE_STRUCTURE.modules.find(m => m.id === appState.current.module);
            if (!module) return;
            
            const topics = module.topics;
            const currentIndex = topics.findIndex(t => t.id === appState.current.topic);
            
            if (currentIndex > 0) {
                loadTopic(appState.current.module, topics[currentIndex - 1].id);
            }
        }

        function goToModule(moduleId) {
            const module = COURSE_STRUCTURE.modules.find(m => m.id === moduleId);
            if (module) {
                loadTopic(moduleId, module.topics[0].id);
            }
        }

        function showHistory() {
            const history = appState.user.activity
                .filter(a => a.icon === 'fa-book')
                .slice(0, 10);
            
            if (history.length === 0) {
                showNotification("История просмотра пуста", "info");
                return;
            }
            
            let historyHTML = `<div style="padding: 15px; max-height: 300px; overflow-y: auto;">`;
            historyHTML += `<h4 style="color: var(--accent-blue); margin-bottom: 15px;">История просмотра:</h4>`;
            
            history.forEach((item, index) => {
                historyHTML += `
                    <div style="padding: 10px; border-bottom: 1px solid rgba(100, 255, 218, 0.1); 
                         ${index === 0 ? 'background: rgba(100, 255, 218, 0.05);' : ''}">
                        <div style="font-weight: 600; color: var(--text-primary);">${item.title}</div>
                        <div style="font-size: 11px; color: var(--accent-purple);">${item.time}</div>
                    </div>
                `;
            });
            
            historyHTML += `</div>`;
            
            showNotification(historyHTML, "info");
        }

        // ================ ЛАБОРАТОРНЫЕ РАБОТЫ ================
        function initLabs() {
            loadLabsGrid();
        }

        function loadLabsGrid() {
            const grid = document.getElementById('labsGrid');
            grid.innerHTML = '';
            
            LABS_DATA.forEach(lab => {
                const labEl = document.createElement('div');
                labEl.className = `lab-card ${lab.status === 'completed' ? 'completed' : ''}`;
                labEl.onclick = () => openLabModal(lab.id);
                
                labEl.innerHTML = `
                    <div class="lab-card-header">
                        <div class="lab-title">${lab.title}</div>
                        <div class="lab-difficulty difficulty-${lab.difficulty}">
                            ${lab.difficulty === 'beginner' ? 'Начинающий' : 
                              lab.difficulty === 'intermediate' ? 'Средний' : 'Продвинутый'}
                        </div>
                    </div>
                    <div class="lab-description">
                        ${lab.description}
                    </div>
                    ${lab.tags ? `
                        <div style="display: flex; gap: 6px; margin: 10px 0; flex-wrap: wrap;">
                            ${lab.tags.map(tag => `
                                <span style="padding: 3px 8px; background: rgba(100, 255, 218, 0.1); 
                                      border-radius: 10px; font-size: 10px; color: var(--accent-blue);">
                                    ${tag}
                                </span>
                            `).join('')}
                        </div>
                    ` : ''}
                    <div class="lab-meta">
                        <div class="lab-stats">
                            <div class="lab-stat">
                                <i class="fas fa-clock"></i>
                                <span>${lab.duration} мин</span>
                            </div>
                            <div class="lab-stat">
                                <i class="fas fa-star"></i>
                                <span>${lab.points || 0} баллов</span>
                            </div>
                        </div>
                        <div class="lab-status ${lab.status}">
                            ${lab.status === 'completed' ? '✅ Завершено' : 
                              lab.status === 'in-progress' ? '🔄 В процессе' : 
                              lab.status === 'locked' ? '🔒 Заблокировано' : 'Доступно'}
                        </div>
                    </div>
                `;
                
                grid.appendChild(labEl);
            });
        }

        function searchLabs(query) {
            const labs = document.querySelectorAll('.lab-card');
            const normalizedQuery = query.toLowerCase();
            
            labs.forEach(lab => {
                const title = lab.querySelector('.lab-title').textContent.toLowerCase();
                const description = lab.querySelector('.lab-description').textContent.toLowerCase();
                const tags = lab.querySelectorAll('span[style*="background: rgba(100, 255, 218, 0.1)"]');
                let tagText = '';
                tags.forEach(tag => tagText += tag.textContent.toLowerCase() + ' ');
                
                if (title.includes(normalizedQuery) || 
                    description.includes(normalizedQuery) || 
                    tagText.includes(normalizedQuery)) {
                    lab.style.display = 'block';
                } else {
                    lab.style.display = 'none';
                }
            });
        }

        function filterLabsByTag(tag) {
            const tags = document.querySelectorAll('.filter-tag');
            tags.forEach(t => t.classList.remove('active'));
            
            const activeTag = document.getElementById(`tag${tag.charAt(0).toUpperCase() + tag.slice(1)}`);
            if (activeTag) activeTag.classList.add('active');
            
            const labs = document.querySelectorAll('.lab-card');
            labs.forEach(lab => {
                if (tag === 'all') {
                    lab.style.display = 'block';
                } else {
                    const difficulty = lab.querySelector('.lab-difficulty').className.includes(tag);
                    lab.style.display = difficulty ? 'block' : 'none';
                }
            });
        }

        function openLabModal(labId) {
            const lab = LABS_DATA.find(l => l.id === labId);
            if (!lab) return;
            
            if (lab.status === 'locked') {
                showNotification("Эта лабораторная работа пока недоступна", "warning");
                return;
            }
            
            appState.current.lab = labId;
            
            const modal = document.getElementById('labModal');
            const content = document.getElementById('labModalContent');
            
            content.innerHTML = `
                <div style="margin-bottom: 25px;">
                    <h3 style="color: var(--accent-blue); margin-bottom: 10px;">${lab.title}</h3>
                    <p style="color: var(--text-secondary); line-height: 1.6;">${lab.description}</p>
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <div class="badge ${lab.difficulty === 'beginner' ? 'badge-primary' : 
                                          lab.difficulty === 'intermediate' ? 'badge-warning' : 
                                          'badge-danger'}">
                            ${lab.difficulty === 'beginner' ? 'Начинающий' : 
                              lab.difficulty === 'intermediate' ? 'Средний' : 'Продвинутый'}
                        </div>
                        <div class="badge badge-success">
                            ${lab.points || 0} баллов
                        </div>
                    </div>
                </div>
                
                <div style="margin-bottom: 25px;">
                    <h4 style="color: var(--accent-green); margin-bottom: 15px;">Цели работы:</h4>
                    <div class="lab-objectives">
                        ${(lab.objectives || []).map((obj, i) => `
                            <div class="lab-objective">
                                <div style="width: 24px; height: 24px; border-radius: 6px; background: rgba(100, 255, 218, 0.1); 
                                     display: flex; align-items: center; justify-content: center; color: var(--accent-blue);">
                                    ${i + 1}
                                </div>
                                <span>${obj}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                ${lab.hints ? `
                <div style="margin-bottom: 25px; padding: 20px; background: rgba(241, 250, 140, 0.05); 
                     border-radius: 12px; border: 1px solid rgba(241, 250, 140, 0.2);">
                    <h4 style="color: var(--accent-yellow); margin-bottom: 10px;">
                        <i class="fas fa-lightbulb"></i> Подсказки
                    </h4>
                    <ul style="color: var(--accent-yellow); padding-left: 20px;">
                        ${lab.hints.map(hint => `<li>${hint}</li>`).join('')}
                    </ul>
                </div>
                ` : ''}
                
                ${lab.starterCode ? `
                <div style="margin-bottom: 25px;">
                    <h4 style="color: var(--accent-blue); margin-bottom: 15px;">Стартовый код:</h4>
                    <div class="code-example">
                        <div class="code-header">
                            <div class="code-title">
                                <i class="fas fa-code"></i>
                                <span>${labId}.cpp</span>
                            </div>
                            <div class="code-actions">
                                <button class="btn btn-small btn-outline" onclick="copyLabCode()">
                                    <i class="fas fa-copy"></i> Копировать
                                </button>
                            </div>
                        </div>
                        <div class="code-body" id="labStarterCode">${lab.starterCode}</div>
                    </div>
                </div>
                ` : ''}
                
                <div style="display: flex; gap: 15px; margin-top: 30px; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="startLab()">
                        <i class="fas fa-play"></i> Начать выполнение
                    </button>
                    ${lab.solution ? `
                    <button class="btn btn-outline" onclick="showLabSolution()">
                        <i class="fas fa-eye"></i> Посмотреть решение
                    </button>
                    ` : ''}
                    <button class="btn btn-outline" onclick="closeModal()">
                        <i class="fas fa-times"></i> Закрыть
                    </button>
                </div>
            `;
            
            modal.classList.add('active');
        }

        function startLab() {
            const labId = appState.current.lab;
            const lab = LABS_DATA.find(l => l.id === labId);
            
            if (!lab || !lab.starterCode) return;
            
            // Загружаем код в редактор
            codeEditor.setValue(lab.starterCode);
            
            // Создаем новый файл для лабораторной
            const fileName = `lab_${labId}.cpp`;
            appState.current.editor.files[fileName] = lab.starterCode;
            appState.current.file = fileName;
            
            // Обновляем вкладки файлов
            updateFileTabs();
            
            // Переключаемся на практику
            switchSection('practice');
            
            // Закрываем модальное окно
            closeModal();
            
            showNotification(`🚀 Начата лабораторная работа: ${lab.title}`, "success");
            logActivity(`Начал лабораторную работу: ${lab.title}`);
            
            // Обновляем ежедневные цели
            updateDailyGoal('labs');
        }

        function copyLabCode() {
            const code = document.getElementById('labStarterCode')?.textContent;
            if (code) {
                navigator.clipboard.writeText(code);
                showNotification("Код скопирован в буфер обмена", "success");
            }
        }

        function showLabSolution() {
            const labId = appState.current.lab;
            const lab = LABS_DATA.find(l => l.id === labId);
            
            if (!lab || !lab.solution) return;
            
            const content = document.getElementById('labModalContent');
            content.innerHTML += `
                <div style="margin-top: 30px; padding-top: 25px; border-top: 1px solid rgba(100, 255, 218, 0.2);">
                    <h4 style="color: var(--accent-green); margin-bottom: 15px;">
                        <i class="fas fa-check-circle"></i> Решение
                    </h4>
                    <div class="code-example">
                        <div class="code-header">
                            <div class="code-title">
                                <i class="fas fa-code"></i>
                                <span>Решение ${labId}.cpp</span>
                            </div>
                        </div>
                        <div class="code-body">${lab.solution}</div>
                    </div>
                </div>
            `;
        }

        function filterLabs(filter) {
            const labs = document.querySelectorAll('.lab-card');
            
            labs.forEach(lab => {
                const isCompleted = lab.classList.contains('completed');
                
                if (filter === 'all') {
                    lab.style.display = 'block';
                } else if (filter === 'completed') {
                    lab.style.display = isCompleted ? 'block' : 'none';
                }
            });
            
            showNotification(`Показаны лабораторные: ${filter === 'all' ? 'Все' : 'Завершенные'}`, "info");
        }

        function createNewLab() {
            showNotification("Создание новой лабораторной работы...", "info");
            // Реализация создания новой лабораторной
        }

        // ================ ТЕСТЫ ================
        function showTestsList() {
            const container = document.getElementById('testContainer');
            
            container.innerHTML = `
                <div style="display: grid; gap: 20px; margin-top: 20px;">
                    ${TESTS_DATA.map(test => `
                        <div class="lab-card" onclick="startTest('${test.id}')" style="cursor: pointer;">
                            <div class="lab-card-header">
                                <div class="lab-title">${test.title}</div>
                                <div class="lab-difficulty difficulty-${test.difficulty}">
                                    ${test.difficulty === 'beginner' ? 'Начинающий' : 'Средний'}
                                </div>
                            </div>
                            <div class="lab-description">
                                ${test.description}
                            </div>
                            <div class="lab-meta">
                                <div class="lab-stats">
                                    <div class="lab-stat">
                                        <i class="fas fa-question-circle"></i>
                                        <span>${test.questions.length} вопросов</span>
                                    </div>
                                    <div class="lab-stat">
                                        <i class="fas fa-clock"></i>
                                        <span>${test.timeLimit ? `${test.timeLimit / 60} мин` : 'Без ограничения'}</span>
                                    </div>
                                    <div class="lab-stat">
                                        <i class="fas fa-star"></i>
                                        <span>${test.questions.length * CONFIG.TEST_XP_PER_QUESTION} XP</span>
                                    </div>
                                </div>
                                <div class="lab-status">
                                    Пройти тест
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function startTest(testId) {
            currentTest = TESTS_DATA.find(t => t.id === testId);
            if (!currentTest) return;
            
            testAnswers = {};
            
            const container = document.getElementById('testContainer');
            const submitBtn = document.getElementById('submitTestBtn');
            
            container.innerHTML = `
                <div class="test-container">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                        <h3 style="color: var(--accent-blue);">
                            <i class="fas fa-graduation-cap"></i> ${currentTest.title}
                        </h3>
                        ${currentTest.timeLimit ? `
                            <div class="test-timer" id="testTimer">
                                <i class="fas fa-clock"></i>
                                <span id="timeLeft">${Math.floor(currentTest.timeLimit / 60)}:${(currentTest.timeLimit % 60).toString().padStart(2, '0')}</span>
                            </div>
                        ` : ''}
                    </div>
                    
                    <div style="color: var(--text-secondary); margin-bottom: 30px;">
                        ${currentTest.description}
                    </div>
                    
                    <div id="testQuestionsContainer">
                        <!-- Вопросы будут загружены динамически -->
                    </div>
                    
                    <div class="test-progress">
                        <div style="color: var(--accent-purple); font-size: 14px;">
                            Ответов: <span id="answeredCount">0</span> из ${currentTest.questions.length}
                        </div>
                        <div>
                            <button class="btn btn-outline" onclick="resetTest()">
                                <i class="fas fa-redo"></i> Начать заново
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            submitBtn.style.display = 'block';
            loadTestQuestions();
            
            // Запускаем таймер, если есть ограничение по времени
            if (currentTest.timeLimit) {
                testTimeLeft = currentTest.timeLimit;
                updateTimer();
                testTimer = setInterval(() => {
                    testTimeLeft--;
                    updateTimer();
                    
                    if (testTimeLeft <= 0) {
                        clearInterval(testTimer);
                        submitTest();
                    }
                }, 1000);
            }
            
            logActivity(`Начал тест: ${currentTest.title}`);
            updateDailyGoal('tests');
        }

        function loadTestQuestions() {
            if (!currentTest) return;
            
            const container = document.getElementById('testQuestionsContainer');
            container.innerHTML = '';
            
            currentTest.questions.forEach((question, index) => {
                const questionEl = document.createElement('div');
                questionEl.style.marginBottom = '30px';
                
                questionEl.innerHTML = `
                    <div class="test-question">
                        <span class="test-question-number">${index + 1}.</span> ${question.question}
                    </div>
                    <div class="test-options">
                        ${question.options.map((option, i) => `
                            <div class="test-option ${testAnswers[question.id] === i ? 'selected' : ''}" 
                                 onclick="selectTestAnswer('${question.id}', ${i})">
                                <div class="option-letter">${String.fromCharCode(65 + i)}</div>
                                <div>${option}</div>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                container.appendChild(questionEl);
            });
            
            updateAnsweredCount();
        }

        function selectTestAnswer(questionId, answerIndex) {
            testAnswers[questionId] = answerIndex;
            loadTestQuestions();
        }

        function updateAnsweredCount() {
            const count = Object.keys(testAnswers).length;
            document.getElementById('answeredCount').textContent = count;
        }

        function updateTimer() {
            const minutes = Math.floor(testTimeLeft / 60);
            const seconds = testTimeLeft % 60;
            document.getElementById('timeLeft').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            // Меняем цвет при малом времени
            if (testTimeLeft <= 60) {
                document.getElementById('testTimer').style.background = 'rgba(255, 85, 85, 0.2)';
                document.getElementById('testTimer').style.color = 'var(--accent-red)';
            }
        }

        function submitTest() {
            if (!currentTest) return;
            
            if (testTimer) {
                clearInterval(testTimer);
            }
            
            let correct = 0;
            const results = [];
            
            currentTest.questions.forEach(question => {
                const userAnswer = testAnswers[question.id];
                const isCorrect = userAnswer === question.correct;
                
                if (isCorrect) correct++;
                
                results.push({
                    question: question.question,
                    userAnswer: question.options[userAnswer],
                    correctAnswer: question.options[question.correct],
                    isCorrect: isCorrect,
                    explanation: question.explanation
                });
            });
            
            const score = Math.round((correct / currentTest.questions.length) * 100);
            const xpEarned = correct * CONFIG.TEST_XP_PER_QUESTION;
            
            const container = document.getElementById('testContainer');
            const submitBtn = document.getElementById('submitTestBtn');
            
            container.innerHTML = `
                <div class="test-container">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <div style="font-size: 48px; color: ${score >= 70 ? 'var(--accent-green)' : 'var(--accent-red)'}; 
                                   font-weight: bold; margin-bottom: 10px;">
                            ${score}%
                        </div>
                        <div style="color: var(--accent-purple); font-size: 18px;">
                            ${correct} из ${currentTest.questions.length} правильных ответов
                        </div>
                        <div style="color: var(--accent-green); font-size: 16px; margin-top: 10px;">
                            +${xpEarned} XP
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <h4 style="color: var(--accent-blue); margin-bottom: 20px;">Результаты по вопросам:</h4>
                        ${results.map((r, i) => `
                            <div style="margin-bottom: 15px; padding: 20px; background: rgba(10, 25, 47, 0.5); 
                                 border-radius: 12px; border-left: 4px solid ${r.isCorrect ? 'var(--accent-green)' : 'var(--accent-red)'};">
                                <div style="font-weight: 600; margin-bottom: 8px; color: var(--text-primary);">
                                    ${i + 1}. ${r.question}
                                </div>
                                <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 5px;">
                                    Ваш ответ: <span style="color: ${r.isCorrect ? 'var(--accent-green)' : 'var(--accent-red)'}">
                                    ${r.userAnswer || 'Нет ответа'}</span>
                                </div>
                                ${!r.isCorrect ? `
                                    <div style="font-size: 14px; color: var(--accent-blue); margin-bottom: 5px;">
                                        Правильный ответ: ${r.correctAnswer}
                                    </div>
                                ` : ''}
                                <div style="font-size: 13px; color: var(--accent-purple); margin-top: 10px;">
                                    <i class="fas fa-info-circle"></i> ${r.explanation}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="display: flex; justify-content: center; gap: 15px; margin-top: 30px;">
                        <button class="btn btn-outline" onclick="startTest('${currentTest.id}')">
                            <i class="fas fa-redo"></i> Пройти еще раз
                        </button>
                        <button class="btn btn-primary" onclick="showTestsList()">
                            <i class="fas fa-list"></i> К списку тестов
                        </button>
                    </div>
                </div>
            `;
            
            submitBtn.style.display = 'none';
            
            // Награждаем пользователя
            if (score >= 70) {
                addXP(xpEarned);
                showNotification(`Тест пройден! Получено ${xpEarned} XP`, "success");
                
                if (score === 100) {
                    unlockAchievement("test_champion");
                }
            }
            
            logActivity(`Завершил тест: ${currentTest.title} с результатом ${score}%`);
        }

        function resetTest() {
            if (testTimer) {
                clearInterval(testTimer);
            }
            startTest(currentTest.id);
        }

        // ================ РЕДАКТОР КОДА ================
        function initCodeEditor() {
            codeEditor = CodeMirror.fromTextArea(document.getElementById('codeEditor'), {
                mode: "text/x-c++src",
                theme: "monokai",
                lineNumbers: true,
                indentUnit: 4,
                lineWrapping: true,
                matchBrackets: true,
                autoCloseBrackets: true,
                foldGutter: true,
                gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter", "CodeMirror-lint-markers"],
                extraKeys: {
                    "Ctrl-Space": "autocomplete",
                    "Ctrl-Enter": runCode,
                    "F5": runCode,
                    "F9": debugCode,
                    "Ctrl-S": saveCode,
                    "Ctrl-/": function(cm) { cm.toggleComment(); },
                    "Ctrl-F": "findPersistent",
                    "Ctrl-H": "replace",
                    "Ctrl-G": "jumpToLine"
                },
                lint: true,
                autocomplete: true,
                styleActiveLine: true,
                showCursorWhenSelecting: true,
                cursorBlinkRate: 530
            });
            
            // Загружаем текущий файл
            loadFile(appState.current.file);
            updateFileTabs();
            
            // Настраиваем размер шрифта
            updateEditorSettings();
        }

        function updateEditorSettings() {
            const settings = appState.user.settings.editor;
            
            // Размер шрифта
            codeEditor.getWrapperElement().style.fontSize = settings.fontSize + 'px';
            
            // Автодополнение
            if (settings.autocomplete) {
                codeEditor.setOption('extraKeys', {
                    ...codeEditor.getOption('extraKeys'),
                    "Ctrl-Space": "autocomplete"
                });
            } else {
                const keys = { ...codeEditor.getOption('extraKeys') };
                delete keys["Ctrl-Space"];
                codeEditor.setOption('extraKeys', keys);
            }
            
            // Размер табуляции
            codeEditor.setOption('indentUnit', settings.tabSize);
        }

        function updateFileTabs() {
            const tabs = document.getElementById('fileTabs');
            tabs.innerHTML = '';
            
            // Добавляем файлы
            Object.keys(appState.current.editor.files).forEach(filename => {
                const isActive = filename === appState.current.file;
                const tab = document.createElement('button');
                tab.className = `file-tab ${isActive ? 'active' : ''}`;
                tab.onclick = () => switchFile(filename);
                
                const extension = filename.split('.').pop();
                const icon = extension === 'cpp' ? 'fa-file-code' : 
                            extension === 'h' ? 'fa-file-alt' : 'fa-file';
                
                tab.innerHTML = `
                    <i class="fas ${icon}"></i>
                    <span>${filename}</span>
                    ${isActive ? '<i class="fas fa-times" onclick="closeFile(event, \'' + filename + '\')"></i>' : ''}
                `;
                
                tabs.appendChild(tab);
            });
        }

        function switchFile(filename) {
            if (!appState.current.editor.files[filename]) return;
            
            // Сохраняем текущий файл
            appState.current.editor.files[appState.current.file] = codeEditor.getValue();
            
            // Переключаемся на новый файл
            appState.current.file = filename;
            loadFile(filename);
            updateFileTabs();
        }

        function loadFile(filename) {
            const content = appState.current.editor.files[filename] || '';
            codeEditor.setValue(content);
            codeEditor.clearHistory();
        }

        function createNewFile() {
            const filename = prompt("Введите имя нового файла (например: program.cpp):", `program_${Date.now()}.cpp`);
            if (!filename) return;
            
            // Проверяем расширение
            if (!filename.match(/\.(cpp|c|cc|cxx|h|hpp|hxx)$/)) {
                showNotification("Используйте расширение .cpp, .c, .h или .hpp", "error");
                return;
            }
            
            if (appState.current.editor.files[filename]) {
                showNotification("Файл с таким именем уже существует", "error");
                return;
            }
            
            // Создаем шаблон файла
            let template = `// ${filename}\n// Создано в C++ Visual Lab\n// ${new Date().toLocaleDateString()}\n\n`;
            
            if (filename.endsWith('.cpp')) {
                template += `#include <iostream>\nusing namespace std;\n\nint main() {\n    cout << "Hello from ${filename}" << endl;\n    return 0;\n}`;
            } else if (filename.endsWith('.h')) {
                template += `#ifndef ${filename.replace(/[^a-zA-Z0-9]/g, '_').toUpperCase()}\n#define ${filename.replace(/[^a-zA-Z0-9]/g, '_').toUpperCase()}\n\n// Объявления функций и классов\n\n#endif // ${filename.replace(/[^a-zA-Z0-9]/g, '_').toUpperCase()}`;
            }
            
            appState.current.editor.files[filename] = template;
            switchFile(filename);
            
            showNotification(`Файл ${filename} создан`, "success");
            logActivity(`Создал файл: ${filename}`);
        }

        function createNewFolder() {
            const folderName = prompt("Введите имя новой папки:", `folder_${Date.now()}`);
            if (!folderName) return;
            
            if (appState.current.editor.folders[folderName]) {
                showNotification("Папка с таким именем уже существует", "error");
                return;
            }
            
            appState.current.editor.folders[folderName] = [];
            showNotification(`Папка ${folderName} создана`, "success");
            logActivity(`Создал папку: ${folderName}`);
        }

        function deleteFile() {
            const filename = appState.current.file;
            
            if (Object.keys(appState.current.editor.files).length <= 1) {
                showNotification("Нельзя удалить последний файл", "error");
                return;
            }
            
            if (confirm(`Удалить файл ${filename}?`)) {
                delete appState.current.editor.files[filename];
                
                // Переключаемся на первый доступный файл
                const newFile = Object.keys(appState.current.editor.files)[0];
                switchFile(newFile);
                
                showNotification(`Файл ${filename} удален`, "success");
                logActivity(`Удалил файл: ${filename}`);
            }
        }

        function renameFile() {
            const oldName = appState.current.file;
            const newName = prompt("Введите новое имя файла:", oldName);
            
            if (!newName || newName === oldName) return;
            
            if (appState.current.editor.files[newName]) {
                showNotification("Файл с таким именем уже существует", "error");
                return;
            }
            
            // Переименовываем файл
            appState.current.editor.files[newName] = appState.current.editor.files[oldName];
            delete appState.current.editor.files[oldName];
            appState.current.file = newName;
            
            updateFileTabs();
            showNotification(`Файл переименован: ${oldName} → ${newName}`, "success");
            logActivity(`Переименовал файл: ${oldName} → ${newName}`);
        }

        function closeFile(event, filename) {
            event.stopPropagation();
            
            if (Object.keys(appState.current.editor.files).length <= 1) {
                showNotification("Нельзя закрыть последний файл", "error");
                return;
            }
            
            delete appState.current.editor.files[filename];
            
            // Переключаемся на другой файл
            const newFile = Object.keys(appState.current.editor.files)[0];
            switchFile(newFile);
            
            showNotification(`Файл ${filename} закрыт`, "info");
        }

        function runCode() {
            const code = codeEditor.getValue();
            const output = document.getElementById('programOutput');
            
            output.innerHTML = '';
            addOutputLine("🔧 Компиляция программы...", "info");
            
            // Симуляция компиляции
            setTimeout(() => {
                const hasErrors = Math.random() < 0.1; // 10% шанс на ошибку
                
                if (hasErrors) {
                    addOutputLine("❌ Ошибки компиляции:", "error");
                    addOutputLine("error: expected ';' before '}' token on line 23", "error");
                    addOutputLine("error: 'cout' was not declared in this scope", "error");
                    addOutputLine("warning: unused variable 'x' [-Wunused-variable]", "error");
                    showNotification("Обнаружены ошибки компиляции", "error");
                } else {
                    addOutputLine("✅ Компиляция успешна", "success");
                    addOutputLine("🚀 Запуск программы...", "info");
                    
                    // Генерация реалистичного вывода
                    setTimeout(() => {
                        const lines = code.split('\n');
                        const isMainProgram = code.includes('int main()') || code.includes('void main()');
                        
                        if (isMainProgram) {
                            // Имитация выполнения программы
                            const mockOutputs = [
                                "=== ДЕМОНСТРАЦИЯ ВОЗМОЖНОСТЕЙ C++ ===",
                                "C++ Visual Lab - Образовательная платформа",
                                "",
                                "1. РАБОТА С ПЕРЕМЕННЫМИ:",
                                "Целое число: 42",
                                "Число Пи: 3.14159",
                                "Сообщение: Hello, C++ Developer!",
                                "Статус: Активен",
                                "",
                                "2. РАБОТА С МАССИВАМИ:",
                                "Элементы массива: 10 20 30 40 50",
                                "",
                                "3. РАБОТА С ВЕКТОРАМИ (STL):",
                                "Оценки студентов: 4.5 3.8 4.2 5 4.7",
                                "Средняя оценка: 4.44",
                                "Максимальная оценка: 5",
                                "",
                                "=== ПРОГРАММА ЗАВЕРШЕНА УСПЕШНО ===",
                                "Код возврата: 0",
                                "Время выполнения: 0.003 секунды",
                                "Использовано памяти: 2.1 MB"
                            ];
                            
                            mockOutputs.forEach(line => {
                                addOutputLine(line, "output");
                            });
                        } else {
                            addOutputLine("⚠️  Программа не содержит функцию main()", "warning");
                            addOutputLine("Добавьте int main() для запуска программы", "info");
                        }
                        
                        // Награда за выполнение
                        const linesCount = lines.length;
                        const xpEarned = Math.min(linesCount * 2, 50);
                        
                        addXP(xpEarned);
                        appState.user.codeLines += linesCount;
                        
                        showNotification(`Код выполнен! +${xpEarned} XP`, "success");
                        updateUI();
                        
                        // Обновляем визуализацию памяти
                        updateMemorySimulation();
                        
                        // Обновляем ежедневные цели
                        updateDailyGoal('code', linesCount);
                        
                    }, 800);
                }
            }, 1500);
            
            logActivity("Запустил программу");
        }

        function addOutputLine(text, type = "output") {
            const output = document.getElementById('programOutput');
            const line = document.createElement('div');
            line.className = `output-line ${type}`;
            line.textContent = text;
            output.appendChild(line);
            output.scrollTop = output.scrollHeight;
        }

        function clearOutput() {
            document.getElementById('programOutput').innerHTML = '';
        }

        function saveCode() {
            const filename = appState.current.file;
            appState.current.editor.files[filename] = codeEditor.getValue();
            
            showNotification(`Файл ${filename} сохранен`, "success");
            saveUserState();
            logActivity(`Сохранил файл: ${filename}`);
        }

        function debugCode() {
            addOutputLine("🔍 Запуск отладчика...", "info");
            
            setTimeout(() => {
                addOutputLine("✅ Отладчик подключен", "success");
                addOutputLine("Установлена точка останова на строке 15", "info");
                addOutputLine("Переменные в области видимости:", "info");
                addOutputLine("  - numbers[5] = {10, 20, 30, 40, 50}", "output");
                addOutputLine("  - sum = 150", "output");
                addOutputLine("  - average = 30", "output");
                
                showNotification("Отладчик запущен. Используйте F10 для шага", "info");
            }, 1000);
        }

        function exportProject() {
            const projectName = prompt("Введите имя проекта для экспорта:", "MyCppProject");
            if (!projectName) return;
            
            // Создаем структуру проекта
            const project = {
                name: projectName,
                files: appState.current.editor.files,
                folders: appState.current.editor.folders,
                date: new Date().toISOString(),
                version: CONFIG.VERSION
            };
            
            // Конвертируем в JSON
            const json = JSON.stringify(project, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            
            a.href = url;
            a.download = `${projectName}.cppproject`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification(`Проект ${projectName} экспортирован`, "success");
            logActivity(`Экспортировал проект: ${projectName}`);
        }

        function importProject() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.cppproject,application/json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const project = JSON.parse(event.target.result);
                        
                        if (!project.files || !project.name) {
                            throw new Error("Некорректный формат проекта");
                        }
                        
                        // Загружаем проект
                        appState.current.editor.files = project.files;
                        appState.current.editor.folders = project.folders || {};
                        appState.current.file = Object.keys(project.files)[0];
                        
                        updateFileTabs();
                        loadFile(appState.current.file);
                        
                        showNotification(`Проект ${project.name} успешно импортирован`, "success");
                        logActivity(`Импортировал проект: ${project.name}`);
                    } catch (error) {
                        showNotification(`Ошибка импорта: ${error.message}`, "error");
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        function focusEditor() {
            if (codeEditor) {
                codeEditor.focus();
            }
        }

        // ================ СИМУЛЯТОР ПАМЯТИ ================
        function initMemorySimulator() {
            updateMemorySimulation();
        }

        function updateMemorySimulation() {
            const grid = document.getElementById('memoryVisualization');
            if (!grid) return;
            
            grid.innerHTML = '';
            
            // Создаем 256 ячеек памяти
            for (let i = 0; i < 256; i++) {
                const address = (0x1000 + i * 4).toString(16).toUpperCase().padStart(8, '0');
                
                // Определяем тип памяти
                let type = '';
                let value = '';
                let title = `Адрес: 0x${address}`;
                
                if (i < 32) {
                    type = 'stack';
                    if (i === 0) {
                        value = 'main()';
                        title = 'main() - стековый фрейм функции main';
                    } else if (i < 8) {
                        value = `var${i}`;
                        title = `Локальная переменная ${i}`;
                    }
                } else if (i < 96) {
                    type = 'heap';
                    if (i === 32) {
                        value = 'arr[0]';
                        title = 'Динамический массив (куча)';
                    }
                } else if (i < 160) {
                    type = 'global';
                    if (i === 96) {
                        value = 'PI';
                        title = 'Глобальная константа PI = 3.14159';
                    }
                } else {
                    type = 'code';
                    if (i === 160) {
                        value = 'cout';
                        title = 'Код функции вывода cout';
                    }
                }
                
                const cell = document.createElement('div');
                cell.className = `memory-cell ${type}`;
                cell.title = title;
                cell.innerHTML = `
                    <div class="memory-address">0x${address}</div>
                    <div class="memory-value">${value || ' '}</div>
                `;
                
                // Анимация для некоторых ячеек
                if (i < 16 || i === 32 || i === 96) {
                    setTimeout(() => {
                        cell.style.transform = 'scale(1.1)';
                        cell.style.boxShadow = '0 0 10px var(--accent-blue)';
                        
                        setTimeout(() => {
                            cell.style.transform = 'scale(1)';
                            cell.style.boxShadow = 'none';
                        }, 300);
                    }, i * 20);
                }
                
                grid.appendChild(cell);
            }
        }

        function stepMemory() {
            appState.memory.step++;
            showNotification(`Шаг ${appState.memory.step}: выполнение инструкции`, "info");
            
            // Анимируем следующую ячейку памяти
            const cells = document.querySelectorAll('.memory-cell');
            if (cells[appState.memory.step % cells.length]) {
                const cell = cells[appState.memory.step % cells.length];
                cell.style.transform = 'scale(1.2)';
                cell.style.boxShadow = '0 0 15px var(--accent-green)';
                
                setTimeout(() => {
                    cell.style.transform = 'scale(1)';
                    cell.style.boxShadow = 'none';
                }, 500);
            }
        }

        function resetMemory() {
            appState.memory.step = 0;
            showNotification("Симулятор памяти сброшен", "success");
            updateMemorySimulation();
        }

        function visualizeMemory() {
            // Анимируем использование памяти
            const cells = document.querySelectorAll('.memory-cell');
            
            cells.forEach((cell, i) => {
                setTimeout(() => {
                    if (i < 128) {
                        cell.style.transform = 'scale(1.05)';
                        cell.style.boxShadow = '0 0 8px var(--accent-blue)';
                        
                        setTimeout(() => {
                            cell.style.transform = 'scale(1)';
                            cell.style.boxShadow = 'none';
                        }, 200);
                    }
                }, i * 10);
            });
            
            unlockAchievement("memory_guru");
        }

        function explainMemory() {
            showNotification("💡 Симулятор показывает распределение памяти в программе", "info");
            addOutputLine("=== ОБЪЯСНЕНИЕ РАБОТЫ ПАМЯТИ ===", "info");
            addOutputLine("🔵 СТЕК - локальные переменные, вызовы функций", "output");
            addOutputLine("🟢 КУЧА - динамическая память (new/delete)", "output");
            addOutputLine("🟡 ГЛОБАЛЬНЫЕ - статические переменные", "output");
            addOutputLine("🔴 КОД - исполняемые инструкции программы", "output");
        }

        // ================ АВАТАР И ПРОФИЛЬ ================
        function initAvatar() {
            const userAvatar = document.getElementById('userAvatar');
            const profileAvatar = document.getElementById('profileAvatar');
            
            if (appState.user.avatar.current) {
                userAvatar.style.backgroundImage = `url(${appState.user.avatar.current})`;
                userAvatar.innerHTML = '';
                profileAvatar.style.backgroundImage = `url(${appState.user.avatar.current})`;
                profileAvatar.innerHTML = '';
            } else {
                // Генерируем аватар по умолчанию
                generateDefaultAvatar();
            }
            
            // Обновляем историю аватарок
            updateAvatarHistory();
        }

        function generateDefaultAvatar() {
            const name = appState.user.name;
            const initials = name.charAt(0).toUpperCase();
            const colors = [
                'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
                'linear-gradient(135deg, #fa709a 0%, #fee140 100%)'
            ];
            
            const color = colors[initials.charCodeAt(0) % colors.length];
            
            const userAvatar = document.getElementById('userAvatar');
            const profileAvatar = document.getElementById('profileAvatar');
            
            userAvatar.style.background = color;
            userAvatar.innerHTML = initials;
            profileAvatar.style.background = color;
            profileAvatar.innerHTML = initials;
        }

        function openAvatarEditor() {
            const modal = document.getElementById('avatarModal');
            modal.classList.add('active');
            
            // Инициализируем зону перетаскивания
            initDropZone();
            
            // Загружаем текущий аватар
            const avatarPreview = document.getElementById('avatarPreview');
            const avatarPlaceholder = document.getElementById('avatarPlaceholder');
            
            if (appState.user.avatar.current) {
                avatarPreview.src = appState.user.avatar.current;
                avatarPreview.style.display = 'block';
                avatarPlaceholder.style.display = 'none';
            } else {
                avatarPreview.style.display = 'none';
                avatarPlaceholder.style.display = 'block';
            }
            
            // Обновляем историю
            updateAvatarHistory();
        }

        function initDropZone() {
            const dropZone = document.getElementById('avatarDropZone');
            
            dropZone.addEventListener('dragover', function(e) {
                e.preventDefault();
                e.stopPropagation();
                this.classList.add('dragover');
            });
            
            dropZone.addEventListener('dragleave', function(e) {
                e.preventDefault();
                e.stopPropagation();
                this.classList.remove('dragover');
            });
            
            dropZone.addEventListener('drop', function(e) {
                e.preventDefault();
                e.stopPropagation();
                this.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleImageFile(files[0]);
                }
            });
            
            dropZone.addEventListener('click', function() {
                document.getElementById('avatarUpload').click();
            });
        }

        function handleAvatarUpload(event) {
            const file = event.target.files[0];
            if (file) {
                handleImageFile(file);
            }
        }

        function handleImageFile(file) {
            // Проверяем размер файла
            if (file.size > CONFIG.MAX_AVATAR_SIZE) {
                showNotification(`Файл слишком большой. Максимальный размер: ${CONFIG.MAX_AVATAR_SIZE / 1024 / 1024}MB`, "error");
                return;
            }
            
            // Проверяем тип файла
            if (!file.type.match('image.*')) {
                showNotification("Пожалуйста, выберите изображение", "error");
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const avatarPreview = document.getElementById('avatarPreview');
                const avatarPlaceholder = document.getElementById('avatarPlaceholder');
                
                avatarPreview.src = e.target.result;
                avatarPreview.style.display = 'block';
                avatarPlaceholder.style.display = 'none';
                
                // Инициализируем редактор обрезки
                initCropper(avatarPreview);
            };
            
            reader.readAsDataURL(file);
        }

        function initCropper(imageElement) {
            if (avatarEditor) {
                avatarEditor.destroy();
            }
            
            avatarEditor = new Cropper(imageElement, {
                aspectRatio: 1,
                viewMode: 1,
                guides: true,
                center: true,
                highlight: false,
                background: false,
                autoCropArea: 0.8,
                responsive: true,
                restore: true,
                checkCrossOrigin: false
            });
        }

        function generateAvatar() {
            const canvas = document.createElement('canvas');
            canvas.width = 200;
            canvas.height = 200;
            const ctx = canvas.getContext('2d');
            
            // Генерируем случайный градиент
            const gradients = [
                ['#667eea', '#764ba2'],
                ['#f093fb', '#f5576c'],
                ['#4facfe', '#00f2fe'],
                ['#43e97b', '#38f9d7'],
                ['#fa709a', '#fee140']
            ];
            
            const gradient = gradients[Math.floor(Math.random() * gradients.length)];
            const grd = ctx.createLinearGradient(0, 0, 200, 200);
            grd.addColorStop(0, gradient[0]);
            grd.addColorStop(1, gradient[1]);
            
            // Рисуем фон
            ctx.fillStyle = grd;
            ctx.fillRect(0, 0, 200, 200);
            
            // Добавляем инициалы
            ctx.fillStyle = 'white';
            ctx.font = 'bold 80px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(appState.user.name.charAt(0).toUpperCase(), 100, 100);
            
            // Добавляем декоративные элементы
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(100, 100, 90, 0, Math.PI * 2);
            ctx.stroke();
            
            // Показываем превью
            const avatarPreview = document.getElementById('avatarPreview');
            const avatarPlaceholder = document.getElementById('avatarPlaceholder');
            
            avatarPreview.src = canvas.toDataURL();
            avatarPreview.style.display = 'block';
            avatarPlaceholder.style.display = 'none';
            
            // Сохраняем canvas для экспорта
            avatarCanvas = canvas;
        }

        function applyFilter(filterType) {
            const avatarPreview = document.getElementById('avatarPreview');
            if (!avatarPreview.src) return;
            
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            
            img.onload = function() {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
                
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                
                switch(filterType) {
                    case 'brightness':
                        // Увеличиваем яркость
                        for (let i = 0; i < data.length; i += 4) {
                            data[i] = Math.min(255, data[i] * 1.2);
                            data[i + 1] = Math.min(255, data[i + 1] * 1.2);
                            data[i + 2] = Math.min(255, data[i + 2] * 1.2);
                        }
                        break;
                    case 'contrast':
                        // Увеличиваем контраст
                        const factor = 1.5;
                        for (let i = 0; i < data.length; i += 4) {
                            data[i] = factor * (data[i] - 128) + 128;
                            data[i + 1] = factor * (data[i + 1] - 128) + 128;
                            data[i + 2] = factor * (data[i + 2] - 128) + 128;
                        }
                        break;
                    case 'grayscale':
                        // Черно-белый фильтр
                        for (let i = 0; i < data.length; i += 4) {
                            const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                            data[i] = avg;
                            data[i + 1] = avg;
                            data[i + 2] = avg;
                        }
                        break;
                    case 'sepia':
                        // Сепия фильтр
                        for (let i = 0; i < data.length; i += 4) {
                            const r = data[i];
                            const g = data[i + 1];
                            const b = data[i + 2];
                            
                            data[i] = Math.min(255, (r * 0.393) + (g * 0.769) + (b * 0.189));
                            data[i + 1] = Math.min(255, (r * 0.349) + (g * 0.686) + (b * 0.168));
                            data[i + 2] = Math.min(255, (r * 0.272) + (g * 0.534) + (b * 0.131));
                        }
                        break;
                }
                
                ctx.putImageData(imageData, 0, 0);
                avatarPreview.src = canvas.toDataURL();
                avatarCanvas = canvas;
            };
            
            img.src = avatarPreview.src;
        }

        function addFrame() {
            const avatarPreview = document.getElementById('avatarPreview');
            if (!avatarPreview.src) return;
            
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            
            img.onload = function() {
                canvas.width = img.width + 20;
                canvas.height = img.height + 20;
                
                // Рисуем рамку
                ctx.fillStyle = 'var(--accent-blue)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Рисуем изображение
                ctx.drawImage(img, 10, 10, img.width, img.height);
                
                avatarPreview.src = canvas.toDataURL();
                avatarCanvas = canvas;
            };
            
            img.src = avatarPreview.src;
        }

        function addSticker() {
            const stickers = ['⚙️', '🖥️', '🐛', '💻', '🚀', '🎯', '🏆', '⭐'];
            const sticker = stickers[Math.floor(Math.random() * stickers.length)];
            
            const avatarPreview = document.getElementById('avatarPreview');
            if (!avatarPreview.src) return;
            
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            
            img.onload = function() {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
                
                // Добавляем стикер
                ctx.font = '40px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(sticker, canvas.width - 30, 30);
                
                avatarPreview.src = canvas.toDataURL();
                avatarCanvas = canvas;
            };
            
            img.src = avatarPreview.src;
        }

        function cropAvatar() {
            if (avatarEditor) {
                const croppedCanvas = avatarEditor.getCroppedCanvas({
                    width: 200,
                    height: 200
                });
                
                const avatarPreview = document.getElementById('avatarPreview');
                avatarPreview.src = croppedCanvas.toDataURL();
                avatarCanvas = croppedCanvas;
                
                avatarEditor.destroy();
                avatarEditor = null;
            }
        }

        function resetAvatar() {
            const avatarPreview = document.getElementById('avatarPreview');
            const avatarPlaceholder = document.getElementById('avatarPlaceholder');
            
            if (appState.user.avatar.current) {
                avatarPreview.src = appState.user.avatar.current;
                avatarPreview.style.display = 'block';
                avatarPlaceholder.style.display = 'none';
            } else {
                avatarPreview.style.display = 'none';
                avatarPlaceholder.style.display = 'block';
            }
            
            if (avatarEditor) {
                avatarEditor.destroy();
                avatarEditor = null;
            }
            
            avatarCanvas = null;
        }

        function saveAvatar() {
            const avatarPreview = document.getElementById('avatarPreview');
            if (!avatarPreview.src || avatarPreview.src.startsWith('data:')) {
                const avatarData = avatarCanvas ? avatarCanvas.toDataURL() : avatarPreview.src;
                
                // Сохраняем в историю
                if (appState.user.avatar.current) {
                    appState.user.avatar.history.unshift(appState.user.avatar.current);
                    
                    // Ограничиваем размер истории
                    if (appState.user.avatar.history.length > CONFIG.AVATAR_HISTORY_LIMIT) {
                        appState.user.avatar.history.pop();
                    }
                }
                
                // Устанавливаем новый аватар
                appState.user.avatar.current = avatarData;
                
                // Обновляем аватары на странице
                initAvatar();
                
                showNotification("Аватар успешно сохранен", "success");
                logActivity("Обновил аватар профиля");
                saveUserState();
                
                closeModal();
            } else {
                showNotification("Сначала загрузите или сгенерируйте аватар", "warning");
            }
        }

        function exportAvatar() {
            if (!avatarCanvas) {
                showNotification("Сначала создайте или отредактируйте аватар", "warning");
                return;
            }
            
            const link = document.createElement('a');
            link.download = `avatar_${appState.user.name}_${Date.now()}.png`;
            link.href = avatarCanvas.toDataURL();
            link.click();
            
            showNotification("Аватар экспортирован как PNG", "success");
        }

        function updateAvatarHistory() {
            const historyContainer = document.getElementById('avatarHistory');
            if (!historyContainer) return;
            
            historyContainer.innerHTML = '';
            
            // Добавляем текущий аватар
            if (appState.user.avatar.current) {
                const currentAvatar = document.createElement('img');
                currentAvatar.className = 'history-avatar active';
                currentAvatar.src = appState.user.avatar.current;
                currentAvatar.onclick = function() {
                    const avatarPreview = document.getElementById('avatarPreview');
                    const avatarPlaceholder = document.getElementById('avatarPlaceholder');
                    
                    avatarPreview.src = this.src;
                    avatarPreview.style.display = 'block';
                    avatarPlaceholder.style.display = 'none';
                    
                    // Снимаем активность со всех аватарок
                    document.querySelectorAll('.history-avatar').forEach(avatar => {
                        avatar.classList.remove('active');
                    });
                    
                    // Активируем выбранный аватар
                    this.classList.add('active');
                    
                    // Сбрасываем редактор
                    if (avatarEditor) {
                        avatarEditor.destroy();
                        avatarEditor = null;
                    }
                };
                historyContainer.appendChild(currentAvatar);
            }
            
            // Добавляем историю аватарок
            appState.user.avatar.history.forEach((avatarData, index) => {
                const historyAvatar = document.createElement('img');
                historyAvatar.className = 'history-avatar';
                historyAvatar.src = avatarData;
                historyAvatar.onclick = function() {
                    const avatarPreview = document.getElementById('avatarPreview');
                    const avatarPlaceholder = document.getElementById('avatarPlaceholder');
                    
                    avatarPreview.src = this.src;
                    avatarPreview.style.display = 'block';
                    avatarPlaceholder.style.display = 'none';
                    
                    // Снимаем активность со всех аватарок
                    document.querySelectorAll('.history-avatar').forEach(avatar => {
                        avatar.classList.remove('active');
                    });
                    
                    // Активируем выбранный аватар
                    this.classList.add('active');
                    
                    // Сбрасываем редактор
                    if (avatarEditor) {
                        avatarEditor.destroy();
                        avatarEditor = null;
                    }
                };
                historyContainer.appendChild(historyAvatar);
            });
        }

        // ================ ИГРЫ ================
        function loadGames() {
            const container = document.getElementById('gamesContainer');
            
            container.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px; margin-top: 20px;">
                    ${GAMES_DATA.map(game => `
                        <div class="game-card ${game.unlocked ? '' : 'locked'}" 
                             onclick="${game.unlocked ? `startGame('${game.id}')` : 'showLockedGame()'}">
                            <div class="game-title">${game.icon} ${game.title}</div>
                            <div class="game-description">
                                ${game.description}
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px;">
                                <div class="badge ${game.difficulty === 'beginner' ? 'badge-primary' : 
                                                  game.difficulty === 'intermediate' ? 'badge-warning' : 
                                                  'badge-danger'}">
                                    ${game.difficulty === 'beginner' ? 'Начинающий' : 
                                      game.difficulty === 'intermediate' ? 'Средний' : 'Продвинутый'}
                                </div>
                                ${game.highScore > 0 ? `
                                    <div style="font-size: 12px; color: var(--accent-yellow);">
                                        <i class="fas fa-trophy"></i> Рекорд: ${game.highScore}
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function startGame(gameId) {
            if (gameId === 'memory_game') {
                startMemoryGame();
            } else {
                showNotification("Игра в разработке...", "info");
            }
        }

        function startMemoryGame() {
            const container = document.getElementById('gamesContainer');
            
            const operators = [
                { symbol: '+', name: 'Сложение', description: 'Сумма двух значений' },
                { symbol: '-', name: 'Вычитание', description: 'Разность двух значений' },
                { symbol: '*', name: 'Умножение', description: 'Произведение двух значений' },
                { symbol: '/', name: 'Деление', description: 'Частное двух значений' },
                { symbol: '%', name: 'Остаток', description: 'Остаток от деления' },
                { symbol: '=', name: 'Присваивание', description: 'Присвоить значение' },
                { symbol: '==', name: 'Равенство', description: 'Сравнение на равенство' },
                { symbol: '++', name: 'Инкремент', description: 'Увеличение на 1' }
            ];
            
            // Создаем пары карточек
            const cards = [...operators, ...operators]
                .sort(() => Math.random() - 0.5)
                .map((op, i) => ({ ...op, id: i, flipped: false, matched: false }));
            
            container.innerHTML = `
                <div style="text-align: center;">
                    <h3 style="color: var(--accent-blue); margin-bottom: 20px;">🎮 Мемори: Угадай оператор</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 30px;">
                        Найдите пары операторов. Кликните на карточку, чтобы увидеть оператор, затем найдите его пару.
                    </p>
                    
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin: 30px 0;" id="memoryGameGrid">
                        ${cards.map(card => `
                            <div class="memory-game-card" data-id="${card.id}" 
                                 onclick="flipCard(this, '${card.symbol}', '${card.name}', '${card.description}')">
                                <div class="card-front">?</div>
                                <div class="card-back" style="display: none;">
                                    <div style="font-size: 24px; font-weight: bold;">${card.symbol}</div>
                                    <div style="font-size: 12px; margin-top: 5px;">${card.name}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <div style="display: inline-flex; gap: 20px; align-items: center;">
                            <div style="font-size: 18px; color: var(--accent-green);">
                                Ходов: <span id="movesCount">0</span>
                            </div>
                            <div style="font-size: 18px; color: var(--accent-blue);">
                                Время: <span id="gameTimer">00:00</span>
                            </div>
                            <button class="btn btn-outline" onclick="resetMemoryGame()">
                                <i class="fas fa-redo"></i> Начать заново
                            </button>
                            <button class="btn btn-outline" onclick="loadGames()">
                                <i class="fas fa-arrow-left"></i> К списку игр
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // Добавляем стили для игры
            const style = document.createElement('style');
            style.textContent = `
                .memory-game-card {
                    aspect-ratio: 1;
                    background: var(--panel-bg);
                    border: 2px solid var(--panel-border);
                    border-radius: 12px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 32px;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    position: relative;
                    overflow: hidden;
                }
                
                .memory-game-card:hover {
                    transform: translateY(-5px);
                    border-color: var(--accent-blue);
                }
                
                .memory-game-card.flipped {
                    background: rgba(100, 255, 218, 0.1);
                    border-color: var(--accent-blue);
                }
                
                .memory-game-card.matched {
                    background: rgba(80, 250, 123, 0.1);
                    border-color: var(--accent-green);
                    cursor: default;
                }
                
                .card-front, .card-back {
                    position: absolute;
                    width: 100%;
                    height: 100%;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    backface-visibility: hidden;
                    transition: transform 0.6s;
                }
            `;
            document.head.appendChild(style);
            
            window.memoryGameState = {
                cards: cards,
                flippedCards: [],
                moves: 0,
                matches: 0,
                startTime: Date.now(),
                timer: null
            };
            
            // Запускаем таймер
            startGameTimer();
        }

        function startGameTimer() {
            const timerElement = document.getElementById('gameTimer');
            window.memoryGameState.timer = setInterval(() => {
                const elapsed = Math.floor((Date.now() - window.memoryGameState.startTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        function flipCard(element, symbol, name, description) {
            const game = window.memoryGameState;
            const cardId = parseInt(element.getAttribute('data-id'));
            const card = game.cards.find(c => c.id === cardId);
            
            if (!card || card.flipped || card.matched || game.flippedCards.length >= 2) {
                return;
            }
            
            // Переворачиваем карточку
            card.flipped = true;
            element.classList.add('flipped');
            element.querySelector('.card-front').style.display = 'none';
            element.querySelector('.card-back').style.display = 'flex';
            
            game.flippedCards.push({ element, card, symbol });
            
            // Показываем описание оператора
            showNotification(`Оператор: ${name} (${symbol}) - ${description}`, "info");
            
            if (game.flippedCards.length === 2) {
                game.moves++;
                document.getElementById('movesCount').textContent = game.moves;
                
                const [card1, card2] = game.flippedCards;
                
                if (card1.symbol === card2.symbol) {
                    // Найдена пара
                    setTimeout(() => {
                        card1.element.classList.add('matched');
                        card2.element.classList.add('matched');
                        card1.card.matched = true;
                        card2.card.matched = true;
                        
                        game.matches++;
                        game.flippedCards = [];
                        
                        showNotification("🎉 Найдена пара!", "success");
                        
                        // Проверяем завершение игры
                        if (game.matches === 8) {
                            clearInterval(game.timer);
                            const elapsed = Math.floor((Date.now() - game.startTime) / 1000);
                            const score = Math.max(1000 - (game.moves * 10) - (elapsed * 5), 100);
                            
                            setTimeout(() => {
                                const xpEarned = Math.floor(score / 10);
                                addXP(xpEarned);
                                
                                // Обновляем рекорд
                                const gameData = GAMES_DATA.find(g => g.id === 'memory_game');
                                if (score > gameData.highScore) {
                                    gameData.highScore = score;
                                    showNotification(`🎮 Новый рекорд! ${score} очков! +${xpEarned} XP`, "success");
                                } else {
                                    showNotification(`🎮 Игра завершена! ${score} очков! +${xpEarned} XP`, "success");
                                }
                                
                                logActivity(`Завершил игру "Мемори" за ${game.moves} ходов и ${elapsed} секунд`);
                            }, 500);
                        }
                    }, 500);
                } else {
                    // Не совпали
                    setTimeout(() => {
                        card1.element.classList.remove('flipped');
                        card2.element.classList.remove('flipped');
                        card1.element.querySelector('.card-front').style.display = 'flex';
                        card1.element.querySelector('.card-back').style.display = 'none';
                        card2.element.querySelector('.card-front').style.display = 'flex';
                        card2.element.querySelector('.card-back').style.display = 'none';
                        
                        card1.card.flipped = false;
                        card2.card.flipped = false;
                        game.flippedCards = [];
                    }, 1000);
                }
            }
        }

        function resetMemoryGame() {
            startMemoryGame();
        }

        function showLockedGame() {
            showNotification("Игра будет разблокирована после достижения 3 уровня", "warning");
        }

        function showAllGames() {
            loadGames();
        }

        function showLeaderboard() {
            const modal = document.getElementById('leaderboardModal');
            modal.classList.add('active');
            
            loadLeaderboard('all');
        }

        function loadLeaderboard(period) {
            const tbody = document.getElementById('leaderboardBody');
            let data = [...LEADERBOARD_DATA];
            
            // Фильтрация по периоду (в реальном приложении)
            if (period === 'week') {
                // Фильтрация за неделю
            } else if (period === 'month') {
                // Фильтрация за месяц
            }
            
            // Сортировка по XP
            data.sort((a, b) => b.xp - a.xp);
            
            tbody.innerHTML = data.map((user, index) => `
                <tr ${user.id === appState.user.id ? 'style="background: rgba(100, 255, 218, 0.1);"' : ''}>
                    <td class="leaderboard-rank ${index === 0 ? 'leaderboard-rank-1' : index === 1 ? 'leaderboard-rank-2' : index === 2 ? 'leaderboard-rank-3' : ''}">
                        ${index + 1}
                    </td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 32px; height: 32px; border-radius: 50%; 
                                 background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                 display: flex; align-items: center; justify-content: center;
                                 color: white; font-weight: bold;">
                                ${user.avatar}
                            </div>
                            <div>
                                <div style="font-weight: 600;">${user.name}</div>
                                <div style="font-size: 11px; color: var(--accent-purple);">
                                    ${user.streak} дней подряд
                                </div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div style="font-weight: bold; color: var(--accent-green);">${user.level}</div>
                        <div style="font-size: 11px; color: var(--accent-purple);">уровень</div>
                    </td>
                    <td>
                        <div style="font-weight: bold; color: var(--accent-yellow);">${user.xp}</div>
                        <div style="font-size: 11px; color: var(--accent-purple);">XP</div>
                    </td>
                    <td>
                        <div style="font-weight: bold;">${user.topics}</div>
                        <div style="font-size: 11px; color: var(--accent-purple);">темы</div>
                    </td>
                    <td>
                        <div style="font-weight: bold;">${user.labs}</div>
                        <div style="font-size: 11px; color: var(--accent-purple);">лабы</div>
                    </td>
                </tr>
            `).join('');
        }

        function changeLeaderboardPeriod(period) {
            const tags = document.querySelectorAll('.filter-tag');
            tags.forEach(tag => tag.classList.remove('active'));
            
            document.querySelector(`.filter-tag[onclick*="${period}"]`).classList.add('active');
            loadLeaderboard(period);
        }

        // ================ ПРОЕКТЫ ================
        function loadProjects() {
            const grid = document.getElementById('projectsGrid');
            
            grid.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 25px; margin-top: 20px;">
                    ${PROJECTS_DATA.map(project => `
                        <div class="lab-card" onclick="openProject('${project.id}')">
                            <div class="lab-card-header">
                                <div class="lab-title">${project.title}</div>
                                <div class="lab-difficulty ${project.difficulty === 'beginner' ? 'difficulty-beginner' : 
                                                             project.difficulty === 'intermediate' ? 'difficulty-intermediate' : 
                                                             'difficulty-advanced'}">
                                    ${project.difficulty === 'beginner' ? 'Начинающий' : 
                                     project.difficulty === 'intermediate' ? 'Средний' : 'Продвинутый'}
                                </div>
                            </div>
                            <div class="lab-description">
                                ${project.description}
                            </div>
                            <div style="margin: 15px 0;">
                                <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                    ${project.technologies.map(tech => `
                                        <span style="padding: 4px 10px; background: rgba(100, 255, 218, 0.1); 
                                              border-radius: 12px; font-size: 11px; color: var(--accent-blue);">
                                            ${tech}
                                        </span>
                                    `).join('')}
                                </div>
                            </div>
                            <div class="lab-meta">
                                <div class="lab-stats">
                                    <div class="lab-stat">
                                        <i class="fas fa-chart-line"></i>
                                        <span>${project.points} баллов</span>
                                    </div>
                                    <div class="lab-stat">
                                        <i class="fas fa-percentage"></i>
                                        <span>${project.progress}% готово</span>
                                    </div>
                                </div>
                                <div class="lab-status ${project.status === 'in-progress' ? 'in-progress' : ''}">
                                    ${project.status === 'planned' ? '📅 Запланирован' : 
                                     project.status === 'in-progress' ? '🔄 В процессе' : '✅ Завершен'}
                                </div>
                            </div>
                            ${project.progress > 0 ? `
                                <div style="margin-top: 15px;">
                                    <div style="height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden;">
                                        <div style="height: 100%; width: ${project.progress}%; background: var(--gradient-green);"></div>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function openProject(projectId) {
            const project = PROJECTS_DATA.find(p => p.id === projectId);
            if (!project) return;
            
            showNotification(`Открытие проекта: ${project.title}`, "info");
            // В реальном приложении здесь была бы загрузка проекта в редактор
        }

        function showAllProjects() {
            loadProjects();
        }

        function createNewProject() {
            const projectName = prompt("Введите название нового проекта:", "Мой проект C++");
            if (!projectName) return;
            
            const difficulty = prompt("Выберите сложность (beginner, intermediate, advanced):", "beginner");
            if (!['beginner', 'intermediate', 'advanced'].includes(difficulty)) {
                showNotification("Некорректная сложность", "error");
                return;
            }
            
            const newProject = {
                id: `project_${Date.now()}`,
                title: projectName,
                description: "Новый проект C++",
                difficulty: difficulty,
                status: "planned",
                technologies: ["C++"],
                points: difficulty === 'beginner' ? 500 : difficulty === 'intermediate' ? 750 : 1000,
                progress: 0
            };
            
            PROJECTS_DATA.push(newProject);
            loadProjects();
            
            showNotification(`Проект "${projectName}" создан`, "success");
            logActivity(`Создал новый проект: ${projectName}`);
        }

        // ================ ДОСТИЖЕНИЯ ================
        function initAchievements() {
            updateAchievementsGrid();
        }

        function updateAchievementsGrid() {
            const grid = document.getElementById('achievementsGrid');
            grid.innerHTML = '';
            
            ACHIEVEMENTS_DATA.slice(0, 6).forEach(achievement => {
                const unlocked = appState.user.achievements.includes(achievement.id);
                
                const badge = document.createElement('div');
                badge.className = `achievement-badge ${unlocked ? 'unlocked' : 'locked'}`;
                badge.title = `${achievement.name}: ${achievement.description}`;
                badge.onclick = () => showAchievementDetails(achievement);
                
                badge.innerHTML = `
                    <div class="achievement-icon">${achievement.icon}</div>
                    <div class="achievement-title">${achievement.name}</div>
                `;
                
                grid.appendChild(badge);
            });
        }

        function showAchievementDetails(achievement) {
            const unlocked = appState.user.achievements.includes(achievement.id);
            
            let details = `
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 48px; margin-bottom: 15px;">${achievement.icon}</div>
                    <h3 style="color: var(--accent-blue); margin-bottom: 10px;">${achievement.name}</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">${achievement.description}</p>
                    <div style="color: var(--accent-yellow); font-weight: bold;">
                        Награда: ${achievement.xp} XP
                    </div>
                    <div style="margin-top: 20px; font-size: 14px; color: ${unlocked ? 'var(--accent-green)' : 'var(--accent-purple)'};">
                        ${unlocked ? '✅ Разблокировано' : '🔒 Заблокировано'}
                    </div>
                </div>
            `;
            
            showNotification(details, unlocked ? "success" : "info");
        }

        function unlockAchievement(achievementId) {
            if (!appState.user.achievements.includes(achievementId)) {
                appState.user.achievements.push(achievementId);
                const achievement = ACHIEVEMENTS_DATA.find(a => a.id === achievementId);
                
                if (achievement) {
                    addXP(achievement.xp);
                    showNotification(`🏆 Достижение разблокировано: ${achievement.name}! +${achievement.xp} XP`, "success");
                    updateAchievementsGrid();
                    updateUI();
                    saveUserState();
                    logActivity(`Разблокировал достижение: ${achievement.name}`);
                }
            }
        }

        function showAllAchievements() {
            const modal = document.getElementById('achievementsModal') || createAchievementsModal();
            modal.classList.add('active');
            loadAllAchievements();
        }

        function createAchievementsModal() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.id = 'achievementsModal';
            modal.innerHTML = `
                <div class="modal-container">
                    <div class="modal-header">
                        <h2><i class="fas fa-trophy"></i> Все достижения</h2>
                        <button class="btn btn-outline" onclick="closeModal()">
                            <i class="fas fa-times"></i> Закрыть
                        </button>
                    </div>
                    <div class="modal-body">
                        <div id="allAchievementsContainer" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; padding: 20px;">
                            <!-- Все достижения будут загружены здесь -->
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            return modal;
        }

        function loadAllAchievements() {
            const container = document.getElementById('allAchievementsContainer');
            if (!container) return;
            
            container.innerHTML = ACHIEVEMENTS_DATA.map(achievement => {
                const unlocked = appState.user.achievements.includes(achievement.id);
                
                return `
                    <div class="achievement-badge ${unlocked ? 'unlocked' : 'locked'}" 
                         style="height: 150px;"
                         title="${achievement.name}: ${achievement.description}">
                        <div class="achievement-icon" style="font-size: 36px;">${achievement.icon}</div>
                        <div class="achievement-title" style="font-size: 12px; margin-top: 10px;">${achievement.name}</div>
                        <div style="font-size: 10px; color: var(--accent-yellow); margin-top: 5px;">
                            ${achievement.xp} XP
                        </div>
                        <div style="font-size: 9px; color: ${unlocked ? 'var(--accent-green)' : 'var(--accent-purple)'}; margin-top: 5px;">
                            ${unlocked ? '✅' : '🔒'}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ================ АКТИВНОСТЬ И СТАТИСТИКА ================
        function initActivity() {
            updateActivityList();
            initActivityCalendar();
        }

        function updateActivityList() {
            const list = document.getElementById('activityList');
            list.innerHTML = '';
            
            const activities = appState.user.activity.slice(0, 10);
            
            activities.forEach(activity => {
                const item = document.createElement('div');
                item.className = 'activity-item';
                
                item.innerHTML = `
                    <div class="activity-icon">
                        <i class="fas ${activity.icon}"></i>
                    </div>
                    <div class="activity-content">
                        <div class="activity-title">${activity.title}</div>
                        <div class="activity-time">${activity.time}</div>
                    </div>
                `;
                
                list.appendChild(item);
            });
        }

        function initActivityCalendar() {
            const calendar = document.getElementById('activityCalendar');
            if (!calendar) return;
            
            calendar.innerHTML = '';
            
            // Создаем 7 дней (неделя)
            for (let i = 0; i < 7; i++) {
                const day = document.createElement('div');
                day.className = 'calendar-day';
                
                // Случайная активность для демонстрации
                const isActive = Math.random() > 0.3;
                const activityCount = isActive ? Math.floor(Math.random() * 5) + 1 : 0;
                
                if (isActive) {
                    day.classList.add('active');
                    day.setAttribute('data-count', `${activityCount} действий`);
                }
                
                day.textContent = ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'][i];
                calendar.appendChild(day);
            }
        }

        function logActivity(message) {
            const timestamp = new Date().toLocaleTimeString('ru-RU', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            const activity = {
                icon: 'fa-history',
                title: message,
                time: timestamp
            };
            
            appState.user.activity.unshift(activity);
            if (appState.user.activity.length > 50) {
                appState.user.activity.pop();
            }
            
            updateActivityList();
            saveUserState();
        }

        function clearActivity() {
            if (confirm("Очистить историю активности?")) {
                appState.user.activity = [];
                updateActivityList();
                showNotification("История активности очищена", "info");
            }
        }

        // ================ ЕЖЕДНЕВНЫЕ ЦЕЛИ ================
        function checkDailyGoals() {
            const today = new Date().toDateString();
            const lastCompleted = appState.user.dailyGoals.lastCompleted;
            
            // Проверяем, новый ли день
            if (lastCompleted !== today) {
                // Сбрасываем ежедневные цели
                appState.user.dailyGoals.today = {
                    topics: 0,
                    labs: 0,
                    code: 0,
                    tests: 0
                };
                
                // Проверяем стрик
                if (lastCompleted && new Date(lastCompleted).getTime() === new Date(today).getTime() - 86400000) {
                    appState.user.dailyGoals.streak++;
                } else {
                    appState.user.dailyGoals.streak = 1;
                }
                
                appState.user.dailyGoals.lastCompleted = today;
                saveUserState();
                
                // Показываем ежедневное уведомление
                showDailyNotification();
            }
        }

        function updateDailyGoal(type, value = 1) {
            appState.user.dailyGoals.today[type] += value;
            
            // Проверяем выполнение целей
            checkGoalCompletion();
            saveUserState();
        }

        function checkGoalCompletion() {
            const goals = appState.user.dailyGoals.today;
            const completedGoals = [];
            
            if (goals.topics >= 1) completedGoals.push("Изучить 1 тему");
            if (goals.labs >= 1) completedGoals.push("Завершить 1 лабораторную");
            if (goals.code >= 50) completedGoals.push("Написать 50 строк кода");
            if (goals.tests >= 1) completedGoals.push("Пройти 1 тест");
            
            if (completedGoals.length > 0) {
                const xpEarned = completedGoals.length * 25;
                addXP(xpEarned);
                
                showNotification(`🎯 Выполнены ежедневные цели! +${xpEarned} XP\n${completedGoals.join('\n')}`, "success");
                
                // Сбрасываем выполненные цели
                if (goals.topics >= 1) goals.topics = 0;
                if (goals.labs >= 1) goals.labs = 0;
                if (goals.code >= 50) goals.code = 0;
                if (goals.tests >= 1) goals.tests = 0;
            }
        }

        function showDailyNotification() {
            const streak = appState.user.dailyGoals.streak;
            const messages = [
                "🎯 Начните новый день обучения!",
                "💪 Сегодня отличный день для программирования!",
                "🚀 Продолжайте двигаться к своей цели!",
                "🌟 Каждая написанная строка кода делает вас лучше!",
                "📚 Знание — сила, особенно в программировании!"
            ];
            
            const randomMessage = messages[Math.floor(Math.random() * messages.length)];
            const notification = `${randomMessage}\nТекущий стрик: ${streak} дней`;
            
            showNotification(notification, "info");
        }

        // ================ ПРОФИЛЬ И НАСТРОЙКИ ================
        function openProfileModal() {
            const modal = document.getElementById('profileModal');
            modal.classList.add('active');
            
            // Обновляем данные в модальном окне
            document.getElementById('modalUserName').textContent = appState.user.name;
            document.getElementById('modalUserRank').textContent = appState.user.rank;
            
            // Обновляем достижения
            updateModalAchievements();
            
            // Обновляем графики
            updateProgressChart();
            updateSkillsChart();
        }

        function updateModalAchievements() {
            const container = document.getElementById('modalAchievements');
            if (!container) return;
            
            container.innerHTML = '';
            
            ACHIEVEMENTS_DATA.slice(0, 8).forEach(achievement => {
                const unlocked = appState.user.achievements.includes(achievement.id);
                
                const badge = document.createElement('div');
                badge.className = `achievement-badge ${unlocked ? 'unlocked' : 'locked'}`;
                badge.title = `${achievement.name}: ${achievement.description}`;
                
                badge.innerHTML = `
                    <div class="achievement-icon">${achievement.icon}</div>
                    <div class="achievement-title">${achievement.name}</div>
                `;
                
                container.appendChild(badge);
            });
        }

        function updateProgressChart() {
            const canvas = document.getElementById('progressChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const data = {
                labels: ['Основы C++', 'ООП', 'Алгоритмы'],
                datasets: [{
                    label: 'Прогресс (%)',
                    data: [
                        appState.progress.basics.percentage,
                        appState.progress.oop.percentage,
                        appState.progress.algorithms.percentage
                    ],
                    backgroundColor: [
                        'rgba(100, 255, 218, 0.5)',
                        'rgba(80, 250, 123, 0.5)',
                        'rgba(241, 250, 140, 0.5)'
                    ],
                    borderColor: [
                        'var(--accent-blue)',
                        'var(--accent-green)',
                        'var(--accent-yellow)'
                    ],
                    borderWidth: 2
                }]
            };
            
            // Очищаем canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Рисуем простую диаграмму (упрощенная версия)
            const barWidth = 60;
            const spacing = 40;
            const startX = 50;
            const maxHeight = 200;
            
            data.labels.forEach((label, index) => {
                const value = data.datasets[0].data[index];
                const height = (value / 100) * maxHeight;
                const x = startX + (barWidth + spacing) * index;
                const y = canvas.height - 50 - height;
                
                // Рисуем столбец
                ctx.fillStyle = data.datasets[0].backgroundColor[index];
                ctx.fillRect(x, y, barWidth, height);
                
                // Рисуем рамку
                ctx.strokeStyle = data.datasets[0].borderColor[index];
                ctx.lineWidth = 2;
                ctx.strokeRect(x, y, barWidth, height);
                
                // Подпись
                ctx.fillStyle = 'var(--text-primary)';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(label, x + barWidth / 2, canvas.height - 30);
                
                // Значение
                ctx.fillText(`${value}%`, x + barWidth / 2, y - 10);
            });
        }

        function updateSkillsChart() {
            const container = document.getElementById('skillsChart');
            if (!container) return;
            
            const skills = [
                { name: 'Синтаксис', value: 85 },
                { name: 'ООП', value: 60 },
                { name: 'STL', value: 45 },
                { name: 'Алгоритмы', value: 30 },
                { name: 'Память', value: 55 }
            ];
            
            container.innerHTML = skills.map(skill => `
                <div class="skill-item">
                    <div class="skill-name">${skill.name}</div>
                    <div class="skill-bar">
                        <div class="skill-progress" style="width: ${skill.value}%"></div>
                    </div>
                    <div class="skill-value">${skill.value}%</div>
                </div>
            `).join('');
        }

        function openSettings() {
            const modal = document.getElementById('settingsModal');
            modal.classList.add('active');
            
            // Устанавливаем активную секцию
            showSettingsSection('appearance');
            
            // Загружаем текущие настройки
            loadSettings();
        }

        function showSettingsSection(sectionId) {
            // Скрываем все секции
            document.querySelectorAll('.settings-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Убираем активность со всех пунктов меню
            document.querySelectorAll('.settings-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Показываем выбранную секцию
            document.getElementById(`${sectionId}Section`).classList.add('active');
            
            // Активируем пункт меню
            const navItem = Array.from(document.querySelectorAll('.settings-nav-item'))
                .find(item => item.getAttribute('onclick').includes(sectionId));
            if (navItem) navItem.classList.add('active');
        }

        function loadSettings() {
            const settings = appState.user.settings;
            
            // Тема
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.remove('selected');
                if (option.getAttribute('onclick').includes(settings.theme)) {
                    option.classList.add('selected');
                }
            });
            
            // Язык
            const languageSelect = document.querySelector('select[onchange*="changeLanguage"]');
            if (languageSelect) languageSelect.value = settings.language;
            
            // Анимации
            const animationsToggle = document.querySelector('input[onchange*="toggleAnimations"]');
            if (animationsToggle) animationsToggle.checked = settings.animations;
            
            // Компактный режим
            const compactToggle = document.querySelector('input[onchange*="toggleCompactMode"]');
            if (compactToggle) compactToggle.checked = settings.compactMode;
            
            // Настройки редактора
            const fontSizeSelect = document.querySelector('select[onchange*="changeEditorFontSize"]');
            if (fontSizeSelect) fontSizeSelect.value = settings.editor.fontSize;
            
            const autocompleteToggle = document.querySelector('input[onchange*="toggleAutocomplete"]');
            if (autocompleteToggle) autocompleteToggle.checked = settings.editor.autocomplete;
            
            const autosaveToggle = document.querySelector('input[onchange*="toggleAutosave"]');
            if (autosaveToggle) autosaveToggle.checked = settings.editor.autosave;
            
            const syntaxToggle = document.querySelector('input[onchange*="toggleSyntaxHighlighting"]');
            if (syntaxToggle) syntaxToggle.checked = settings.editor.syntaxHighlighting;
            
            const tabSizeSelect = document.querySelector('select[onchange*="changeTabSize"]');
            if (tabSizeSelect) tabSizeSelect.value = settings.editor.tabSize;
            
            // Данные пользователя
            const nameInput = document.querySelector('input[onchange*="updateUserName"]');
            if (nameInput) nameInput.value = appState.user.name;
            
            const nicknameInput = document.querySelector('input[onchange*="updateUserNickname"]');
            if (nicknameInput) nicknameInput.value = appState.user.nickname;
            
            const emailInput = document.querySelector('input[onchange*="updateUserEmail"]');
            if (emailInput) emailInput.value = appState.user.email;
            
            // Настройки данных
            const autoSaveDataToggle = document.querySelector('input[onchange*="toggleAutoSaveData"]');
            if (autoSaveDataToggle) autoSaveDataToggle.checked = settings.autoSaveData;
            
            const backupsToggle = document.querySelector('input[onchange*="toggleBackups"]');
            if (backupsToggle) backupsToggle.checked = settings.backups;
        }

        function changeTheme(theme) {
            appState.user.settings.theme = theme;
            applyTheme(theme);
            saveUserState();
        }

        function applyTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            
            // Обновляем выбранную тему в настройках
            const themeOptions = document.querySelectorAll('.theme-option');
            themeOptions.forEach(option => {
                option.classList.remove('selected');
                if (option.getAttribute('onclick').includes(theme)) {
                    option.classList.add('selected');
                }
            });
        }

        function changeLanguage(lang) {
            appState.user.settings.language = lang;
            showNotification(`Язык изменен на ${lang === 'ru' ? 'Русский' : 'English'}`, "success");
            saveUserState();
        }

        function toggleAnimations(enabled) {
            appState.user.settings.animations = enabled;
            showNotification(`Анимации ${enabled ? 'включены' : 'выключены'}`, "info");
            saveUserState();
        }

        function toggleCompactMode(enabled) {
            appState.user.settings.compactMode = enabled;
            
            if (enabled) {
                document.body.classList.add('compact-mode');
            } else {
                document.body.classList.remove('compact-mode');
            }
            
            showNotification(`Компактный режим ${enabled ? 'включен' : 'выключен'}`, "info");
            saveUserState();
        }

        function changeEditorFontSize(size) {
            appState.user.settings.editor.fontSize = parseInt(size);
            updateEditorSettings();
            showNotification(`Размер шрифта изменен на ${size}px`, "info");
            saveUserState();
        }

        function toggleAutocomplete(enabled) {
            appState.user.settings.editor.autocomplete = enabled;
            updateEditorSettings();
            showNotification(`Автодополнение ${enabled ? 'включено' : 'выключено'}`, "info");
            saveUserState();
        }

        function toggleAutosave(enabled) {
            appState.user.settings.editor.autosave = enabled;
            showNotification(`Автосохранение ${enabled ? 'включено' : 'выключено'}`, "info");
            saveUserState();
        }

        function toggleSyntaxHighlighting(enabled) {
            appState.user.settings.editor.syntaxHighlighting = enabled;
            
            if (codeEditor) {
                codeEditor.setOption('theme', enabled ? 'monokai' : 'default');
            }
            
            showNotification(`Подсветка синтаксиса ${enabled ? 'включена' : 'выключена'}`, "info");
            saveUserState();
        }

        function changeTabSize(size) {
            const tabSize = size === 'tab' ? '\t' : parseInt(size);
            appState.user.settings.editor.tabSize = tabSize;
            updateEditorSettings();
            showNotification(`Размер табуляции изменен на ${size}`, "info");
            saveUserState();
        }

        function updateUserName(name) {
            if (name && name.trim()) {
                appState.user.name = name.trim();
                updateUI();
                showNotification("Имя обновлено", "success");
                saveUserState();
            }
        }

        function updateUserNickname(nickname) {
            if (nickname && nickname.trim()) {
                appState.user.nickname = nickname.trim();
                showNotification("Никнейм обновлен", "success");
                saveUserState();
            }
        }

        function updateUserEmail(email) {
            if (email && email.trim()) {
                // Простая валидация email
                if (email.includes('@') && email.includes('.')) {
                    appState.user.email = email.trim();
                    showNotification("Email обновлен", "success");
                    saveUserState();
                } else {
                    showNotification("Введите корректный email", "error");
                }
            }
        }

        function toggleAutoSaveData(enabled) {
            appState.user.settings.autoSaveData = enabled;
            
            if (enabled) {
                initAutoSave();
            } else {
                clearInterval(autoSaveInterval);
                autoSaveInterval = null;
            }
            
            showNotification(`Автосохранение данных ${enabled ? 'включено' : 'выключено'}`, "info");
            saveUserState();
        }

        function toggleBackups(enabled) {
            appState.user.settings.backups = enabled;
            
            if (enabled) {
                initBackups();
            } else {
                clearInterval(backupInterval);
                backupInterval = null;
            }
            
            showNotification(`Резервные копии ${enabled ? 'включены' : 'выключены'}`, "info");
            saveUserState();
        }

        // ================ СЕРТИФИКАТЫ ================
        function generateCertificate() {
            const modal = document.getElementById('certificateModal');
            modal.classList.add('active');
            
            // Обновляем данные сертификата
            document.getElementById('certificateName').textContent = appState.user.name;
            document.getElementById('certificateStudentName').textContent = appState.user.name;
            document.getElementById('certificateLevel').textContent = appState.user.rank;
            
            // Вычисляем общий прогресс
            const totalPoints = Object.values(appState.progress).reduce((sum, module) => sum + module.completed, 0);
            const totalMaxPoints = Object.values(appState.progress).reduce((sum, module) => sum + module.total, 0);
            const progressPercentage = Math.round((totalPoints / totalMaxPoints) * 100);
            
            document.getElementById('certificateScore').textContent = `${progressPercentage}%`;
            document.getElementById('certificateDate').textContent = new Date().toLocaleDateString('ru-RU', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        function downloadCertificate() {
            const certificate = document.getElementById('certificateCanvas');
            const canvas = document.createElement('canvas');
            canvas.width = 800;
            canvas.height = 600;
            const ctx = canvas.getContext('2d');
            
            // Рисуем фон
            const gradient = ctx.createLinearGradient(0, 0, 800, 600);
            gradient.addColorStop(0, '#f5f7fa');
            gradient.addColorStop(1, '#c3cfe2');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 800, 600);
            
            // Рисуем рамку
            ctx.fillStyle = '#1a237e';
            ctx.fillRect(0, 0, 800, 20);
            ctx.fillRect(0, 0, 20, 600);
            ctx.fillRect(780, 0, 20, 600);
            ctx.fillRect(0, 580, 800, 20);
            
            // Заголовок
            ctx.fillStyle = '#1a237e';
            ctx.font = 'bold 48px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('C++ Visual Lab', 400, 80);
            
            // Название сертификата
            ctx.font = 'bold 32px Arial';
            ctx.fillText('СЕРТИФИКАТ ОБ ОБУЧЕНИИ', 400, 140);
            
            // Имя студента
            ctx.fillStyle = '#0d47a1';
            ctx.font = 'bold 42px Arial';
            ctx.fillText(appState.user.name, 400, 240);
            
            // Описание
            ctx.fillStyle = '#1a237e';
            ctx.font = '18px Arial';
            ctx.textAlign = 'center';
            const description = `Настоящим удостоверяется, что ${appState.user.name}\nуспешно завершил(а) курс "Основы C++"\nи достиг(ла) уровня "${appState.user.rank}"\nс результатом ${Math.round((Object.values(appState.progress).reduce((sum, module) => sum + module.completed, 0) / Object.values(appState.progress).reduce((sum, module) => sum + module.total, 0)) * 100)}%`;
            
            const lines = description.split('\n');
            lines.forEach((line, index) => {
                ctx.fillText(line, 400, 320 + index * 30);
            });
            
            // Дата
            ctx.font = '16px Arial';
            ctx.fillText(`Дата выдачи: ${new Date().toLocaleDateString('ru-RU')}`, 400, 480);
            
            // Печать
            ctx.save();
            ctx.translate(700, 500);
            ctx.rotate(-0.1);
            ctx.strokeStyle = '#d32f2f';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(0, 0, 60, 0, Math.PI * 2);
            ctx.stroke();
            
            ctx.fillStyle = '#d32f2f';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('УДОСТОВЕРЕНО', 0, -10);
            ctx.fillText('C++ Visual Lab', 0, 10);
            ctx.restore();
            
            // Скачивание
            const link = document.createElement('a');
            link.download = `Сертификат_${appState.user.name}_${Date.now()}.png`;
            link.href = canvas.toDataURL();
            link.click();
            
            showNotification("Сертификат скачан", "success");
        }

        function shareCertificate() {
            if (navigator.share) {
                navigator.share({
                    title: `Мой сертификат C++ Visual Lab`,
                    text: `Я получил(а) сертификат C++ Visual Lab уровня "${appState.user.rank}"!`,
                    url: window.location.href
                }).then(() => {
                    showNotification("Сертификат опубликован", "success");
                }).catch(error => {
                    showNotification("Ошибка публикации", "error");
                });
            } else {
                showNotification("Функция публикации недоступна в вашем браузере", "warning");
            }
        }

        // ================ УПРАВЛЕНИЕ ДАННЫМИ ================
        function exportAllData() {
            const data = {
                appState: appState,
                version: CONFIG.VERSION,
                exportDate: new Date().toISOString()
            };
            
            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            
            a.href = url;
            a.download = `cpp_visual_lab_backup_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification("Все данные экспортированы", "success");
            logActivity("Экспортировал все данные");
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json,application/json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const importedData = JSON.parse(event.target.result);
                        
                        // Проверяем версию
                        if (!importedData.appState || !importedData.version) {
                            throw new Error("Некорректный формат файла");
                        }
                        
                        if (confirm("Импортировать данные? Текущий прогресс будет заменен.")) {
                            appState = importedData.appState;
                            saveUserState();
                            location.reload(); // Перезагружаем страницу
                        }
                    } catch (error) {
                        showNotification(`Ошибка импорта: ${error.message}`, "error");
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        function resetProgress() {
            if (confirm("Вы уверены, что хотите сбросить весь прогресс? Это действие нельзя отменить.")) {
                // Создаем резервную копию
                const backup = JSON.parse(JSON.stringify(appState));
                appState.backups.push({
                    date: new Date().toISOString(),
                    data: backup
                });
                
                // Ограничиваем количество резервных копий
                if (appState.backups.length > 10) {
                    appState.backups.shift();
                }
                
                // Сбрасываем прогресс
                appState.user.level = 1;
                appState.user.xp = 0;
                appState.user.maxXp = CONFIG.BASE_XP;
                appState.user.rank = "Новичок";
                appState.user.streak = 0;
                appState.user.completedTopics = [];
                appState.user.completedLabs = 0;
                appState.user.completedTests = 0;
                appState.user.codeLines = 0;
                appState.user.achievements = [];
                appState.user.dailyGoals = {
                    lastCompleted: null,
                    streak: 0,
                    today: { topics: 0, labs: 0, code: 0, tests: 0 }
                };
                
                // Сбрасываем прогресс модулей
                appState.progress = {
                    basics: { completed: 0, total: 1000, percentage: 0 },
                    oop: { completed: 0, total: 1500, percentage: 0 },
                    algorithms: { completed: 0, total: 2000, percentage: 0 }
                };
                
                // Сбрасываем игры
                appState.user.games.highScores = {};
                appState.user.games.unlocked = ["memory_game"];
                
                saveUserState();
                location.reload();
            }
        }

        function clearAllData() {
            if (confirm("Вы уверены, что хотите удалить все данные? Это действие нельзя отменить.")) {
                localStorage.clear();
                location.reload();
            }
        }

        function exportUserData() {
            const userData = {
                user: appState.user,
                progress: appState.progress,
                certificates: appState.user.certificates,
                exportDate: new Date().toISOString()
            };
            
            const json = JSON.stringify(userData, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            
            a.href = url;
            a.download = `cpp_visual_lab_user_data_${appState.user.name}_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification("Данные пользователя экспортированы", "success");
            logActivity("Экспортировал данные пользователя");
        }

        // ================ СИСТЕМА ОПЫТА И УРОВНЕЙ ================
        function addXP(amount) {
            appState.user.xp += amount;
            
            // Проверяем повышение уровня
            while (appState.user.xp >= appState.user.maxXp) {
                appState.user.level++;
                appState.user.xp -= appState.user.maxXp;
                appState.user.maxXp = Math.floor(appState.user.maxXp * CONFIG.XP_MULTIPLIER);
                
                // Обновляем ранг
                if (appState.user.level >= 10) {
                    appState.user.rank = "Мастер";
                } else if (appState.user.level >= 5) {
                    appState.user.rank = "Знаток";
                } else if (appState.user.level >= 3) {
                    appState.user.rank = "Ученик";
                    // Разблокируем игры
                    GAMES_DATA[1].unlocked = true;
                }
                
                showNotification(`🎉 Поздравляем! Вы достигли ${appState.user.level} уровня!`, "success");
                
                // Проверяем достижения
                if (appState.user.level >= 10) {
                    unlockAchievement("cpp_master");
                }
            }
            
            updateUI();
            saveUserState();
        }

        function updateUI() {
            // Обновляем данные пользователя
            document.getElementById('userLevel').textContent = appState.user.level;
            document.getElementById('userXP').textContent = appState.user.xp;
            document.getElementById('userStreak').textContent = appState.user.streak;
            document.getElementById('userName').textContent = appState.user.name;
            document.getElementById('userRank').textContent = appState.user.rank;
            
            // Обновляем профиль
            document.getElementById('avatarLevel').textContent = appState.user.level;
            document.getElementById('profileName').textContent = appState.user.name;
            document.getElementById('profileRank').textContent = appState.user.rank;
            
            // Обновляем прогресс-бар
            const xpPercentage = (appState.user.xp / appState.user.maxXp) * 100;
            document.getElementById('xpBarFill').style.width = `${xpPercentage}%`;
            document.getElementById('xpText').textContent = `${appState.user.xp}/${appState.user.maxXp} XP`;
            
            // Обновляем статистику
            document.getElementById('completedTopics').textContent = appState.user.completedTopics.length;
            document.getElementById('completedLabs').textContent = appState.user.completedLabs;
            document.getElementById('codeLines').textContent = appState.user.codeLines;
            document.getElementById('achievementCount').textContent = appState.user.achievements.length;
        }

        // ================ ГОРЯЧИЕ КЛАВИШИ ================
        function initHotkeys() {
            document.addEventListener('keydown', function(e) {
                // F1 - Справка
                if (e.key === 'F1') {
                    e.preventDefault();
                    showNotification(`
                        <div style="padding: 15px;">
                            <h3 style="color: var(--accent-blue); margin-bottom: 15px;">Горячие клавиши:</h3>
                            <div style="line-height: 2;">
                                <div><strong>F1</strong> - Эта справка</div>
                                <div><strong>F5</strong> - Запустить код</div>
                                <div><strong>Ctrl+S</strong> - Сохранить файл</div>
                                <div><strong>Ctrl+Enter</strong> - Запустить код</div>
                                <div><strong>Ctrl+/</strong> - Закомментировать/раскомментировать</div>
                                <div><strong>Ctrl+F</strong> - Поиск в коде</div>
                                <div><strong>Ctrl+H</strong> - Замена в коде</div>
                            </div>
                        </div>
                    `, "info");
                }
                
                // F5 - Запуск кода
                if (e.key === 'F5') {
                    e.preventDefault();
                    if (appState.current.section === 'practice') {
                        runCode();
                    }
                }
                
                // Ctrl+S - Сохранение
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    if (appState.current.section === 'practice') {
                        saveCode();
                    }
                }
                
                // Ctrl+Enter - Запуск кода
                if (e.ctrlKey && e.key === 'Enter') {
                    e.preventDefault();
                    if (appState.current.section === 'practice') {
                        runCode();
                    }
                }
            });
        }

        // ================ АВТОСОХРАНЕНИЕ И РЕЗЕРВНЫЕ КОПИИ ================
        function initAutoSave() {
            if (appState.user.settings.autoSaveData && !autoSaveInterval) {
                autoSaveInterval = setInterval(() => {
                    saveUserState();
                    console.log('Автосохранение выполнено');
                }, CONFIG.AUTO_SAVE_INTERVAL);
            }
        }

        function initBackups() {
            if (appState.user.settings.backups && !backupInterval) {
                backupInterval = setInterval(() => {
                    createBackup();
                }, CONFIG.BACKUP_INTERVAL);
            }
        }

        function createBackup() {
            const backup = JSON.parse(JSON.stringify(appState));
            appState.backups.push({
                date: new Date().toISOString(),
                data: backup
            });
            
            // Ограничиваем количество резервных копий
            if (appState.backups.length > 10) {
                appState.backups.shift();
            }
            
            saveUserState();
            console.log('Резервная копия создана');
        }

        // ================ СОХРАНЕНИЕ И ЗАГРУЗКА СОСТОЯНИЯ ================
        function saveUserState() {
            try {
                localStorage.setItem('cpp_visual_lab_state_v3', JSON.stringify(appState));
            } catch (e) {
                console.error("Ошибка сохранения:", e);
                
                // Если localStorage полон, пытаемся очистить старые данные
                if (e.name === 'QuotaExceededError') {
                    try {
                        // Удаляем старые резервные копии
                        if (appState.backups.length > 5) {
                            appState.backups = appState.backups.slice(-5);
                            localStorage.setItem('cpp_visual_lab_state_v3', JSON.stringify(appState));
                            showNotification("Очищены старые резервные копии для освобождения места", "warning");
                        }
                    } catch (e2) {
                        console.error("Не удалось освободить место:", e2);
                        showNotification("Недостаточно места для сохранения. Попробуйте экспортировать данные.", "error");
                    }
                }
            }
        }

        function loadUserState() {
            try {
                const saved = localStorage.getItem('cpp_visual_lab_state_v3');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    
                    // Проверяем версию и обновляем при необходимости
                    if (parsed.version !== CONFIG.VERSION) {
                        console.log('Миграция данных с версии', parsed.version, 'на', CONFIG.VERSION);
                        appState = migrateData(parsed);
                    } else {
                        appState = parsed;
                    }
                }
            } catch (e) {
                console.error("Ошибка загрузки:", e);
                showNotification("Ошибка загрузки данных. Создан новый профиль.", "error");
            }
        }

        function migrateData(oldData) {
            // Простая миграция: сохраняем пользовательские данные, обновляем структуру
            const migrated = { ...appState };
            
            if (oldData.user) {
                migrated.user = { ...migrated.user, ...oldData.user };
            }
            
            if (oldData.current) {
                migrated.current = { ...migrated.current, ...oldData.current };
            }
            
            if (oldData.progress) {
                migrated.progress = { ...migrated.progress, ...oldData.progress };
            }
            
            migrated.version = CONFIG.VERSION;
            return migrated;
        }

        // ================ УТИЛИТЫ ================
        function copyCode(codeId) {
            const codeElement = document.getElementById(codeId);
            if (codeElement) {
                navigator.clipboard.writeText(codeElement.textContent);
                showNotification("Код скопирован в буфер обмена", "success");
            }
        }

        function runExample(codeId) {
            const codeElement = document.getElementById(codeId);
            if (codeElement) {
                codeEditor.setValue(codeElement.textContent);
                switchSection('practice');
                showNotification("Пример загружен в редактор", "success");
            }
        }

        function checkAnswer(button, answer, isCorrect) {
            if (isCorrect) {
                button.style.background = 'rgba(80, 250, 123, 0.2)';
                button.style.borderColor = 'var(--accent-green)';
                button.style.color = 'var(--accent-green)';
                showNotification("✅ Правильно!", "success");
            } else {
                button.style.background = 'rgba(255, 85, 85, 0.2)';
                button.style.borderColor = 'var(--accent-red)';
                button.style.color = 'var(--accent-red)';
                showNotification("❌ Неверно. Попробуйте еще раз!", "error");
            }
            
            setTimeout(() => {
                button.style.background = '';
                button.style.borderColor = '';
                button.style.color = '';
            }, 2000);
        }

        function toggleBookmark() {
            showNotification("Тема добавлена в закладки", "info");
        }

        function closeModal() {
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.classList.remove('active');
            });
        }

        function showNotification(message, type = "info") {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const icons = {
                success: "✅",
                error: "❌",
                warning: "⚠️",
                info: "ℹ️"
            };
            
            notification.innerHTML = `
                <div style="display: flex; align-items: flex-start; gap: 12px;">
                    <div style="font-size: 18px; flex-shrink: 0;">${icons[type] || icons.info}</div>
                    <div style="flex: 1;">${message}</div>
                </div>
            `;
            
            container.appendChild(notification);
            
            // Показываем уведомление
            setTimeout(() => notification.classList.add('show'), 10);
            
            // Убираем через 5 секунд
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 500);
            }, 5000);
        }

        // ================ ГЛОБАЛЬНЫЕ ФУНКЦИИ ================
        window.switchSection = switchSection;
        window.prevTopic = prevTopic;
        window.nextTopic = nextTopic;
        window.toggleBookmark = toggleBookmark;
        window.openProfileModal = openProfileModal;
        window.closeModal = closeModal;
        window.createNewFile = createNewFile;
        window.createNewFolder = createNewFolder;
        window.deleteFile = deleteFile;
        window.renameFile = renameFile;
        window.saveCode = saveCode;
        window.runCode = runCode;
        window.debugCode = debugCode;
        window.exportProject = exportProject;
        window.importProject = importProject;
        window.clearOutput = clearOutput;
        window.stepMemory = stepMemory;
        window.resetMemory = resetMemory;
        window.visualizeMemory = visualizeMemory;
        window.explainMemory = explainMemory;
        window.selectTestAnswer = selectTestAnswer;
        window.submitTest = submitTest;
        window.resetTest = resetTest;
        window.openLabModal = openLabModal;
        window.startLab = startLab;
        window.copyLabCode = copyLabCode;
        window.showLabSolution = showLabSolution;
        window.filterLabs = filterLabs;
        window.filterLabsByTag = filterLabsByTag;
        window.searchLabs = searchLabs;
        window.createNewLab = createNewLab;
        window.showAllGames = showAllGames;
        window.startGame = startGame;
        window.showLeaderboard = showLeaderboard;
        window.showAllProjects = showAllProjects;
        window.createNewProject = createNewProject;
        window.openProject = openProject;
        window.showAllAchievements = showAllAchievements;
        window.clearActivity = clearActivity;
        window.copyCode = copyCode;
        window.runExample = runExample;
        window.checkAnswer = checkAnswer;
        window.openAvatarEditor = openAvatarEditor;
        window.handleAvatarUpload = handleAvatarUpload;
        window.generateAvatar = generateAvatar;
        window.applyFilter = applyFilter;
        window.addFrame = addFrame;
        window.addSticker = addSticker;
        window.cropAvatar = cropAvatar;
        window.resetAvatar = resetAvatar;
        window.saveAvatar = saveAvatar;
        window.exportAvatar = exportAvatar;
        window.openSettings = openSettings;
        window.showSettingsSection = showSettingsSection;
        window.changeTheme = changeTheme;
        window.changeLanguage = changeLanguage;
        window.toggleAnimations = toggleAnimations;
        window.toggleCompactMode = toggleCompactMode;
        window.changeEditorFontSize = changeEditorFontSize;
        window.toggleAutocomplete = toggleAutocomplete;
        window.toggleAutosave = toggleAutosave;
        window.toggleSyntaxHighlighting = toggleSyntaxHighlighting;
        window.changeTabSize = changeTabSize;
        window.updateUserName = updateUserName;
        window.updateUserNickname = updateUserNickname;
        window.updateUserEmail = updateUserEmail;
        window.toggleAutoSaveData = toggleAutoSaveData;
        window.toggleBackups = toggleBackups;
        window.exportAllData = exportAllData;
        window.importData = importData;
        window.resetProgress = resetProgress;
        window.clearAllData = clearAllData;
        window.exportUserData = exportUserData;
        window.generateCertificate = generateCertificate;
        window.downloadCertificate = downloadCertificate;
        window.shareCertificate = shareCertificate;
        window.changeLeaderboardPeriod = changeLeaderboardPeriod;
        window.toggleProgressMap = toggleProgressMap;
        window.performSearch = performSearch;
        window.clearSearch = clearSearch;
        window.goToSearchResult = goToSearchResult;
        window.filterTopics = filterTopics;
        window.filterByTag = filterByTag;
        window.showHistory = showHistory;
        window.flipCard = flipCard;
        window.resetMemoryGame = resetMemoryGame;

        // Автосохранение при закрытии вкладки
        window.addEventListener('beforeunload', saveUserState);
        
        // Инициализация автосохранения
        initAutoSave();
        initBackups();
    </script>
</body>
</html>